{"version":3,"sources":["Json2Canvas.js"],"names":["define","poxp","Json2Canvas","[object Object]","can","this","canvas","data","width","height","ctx","getContext","bx","by","default","font","borderColor","textColor","class","km","tm","am","clearColor","clearRect","fillStyle","fillRect","v","i","length","d","classdef","style","lineWidth","boder","s","x","y","w","h","rect","undefined","save","shape","background","_ax","_ay","_aw","_ah","border","strokeStyle","strokeRect","radius","beginPath","moveTo","lineTo","arcTo","fill","stroke","color","align","textAlign","fillText","str","l","boxscan","lines","lh","lineHeight","ox","offsetx","oy","offsety","lx","ly","clip","img","loadImageAjax","src","drawImage","children","bbx","bby","draw","restore","id","c","getElementById","_str","match","char","n","slice","join","si","push","substr","measureText","ii","Promise","resolve","reject","loadAjax","type","then","b","timg","Image","url","URL","createObjectURL","onload","revokeObjectURL","catch","err","opt","req","XMLHttpRequest","open","responseType","status","response","statusText","onerror","send","name","path","document","fonts","f","FontFace","load","add"],"mappings":";;;;;;;AAAAA,QACI,UACF,SAASC,SASJC,EAELC,YAAYC,GACXC,KAAKC,OAASF,EACdC,KAAKE,KAAO,KACZF,KAAKG,MAAQJ,EAAII,MACjBH,KAAKI,OAASL,EAAIK,OAClBJ,KAAKK,IAAMN,EAAIO,WAAW,MAC1BN,KAAKO,GAAK,EACVP,KAAKQ,GAAK,EACVR,KAAKS,SACJC,KAAK,kBACLC,YAAY,QACZC,UAAU,SAGXZ,KAAKa,SACLb,KAAKc,GAAK,6FACVd,KAAKe,GAAK,sBACVf,KAAKgB,GAAK,aAGXlB,MAAMmB,GACLjB,KAAKK,IAAIa,UAAU,EAAE,EAAElB,KAAKC,OAAOE,MAAMH,KAAKC,OAAOG,QAClDa,IACFjB,KAAKK,IAAIc,UAAYF,EACrBjB,KAAKK,IAAIe,SAAS,EAAE,EAAEpB,KAAKC,OAAOE,MAAMH,KAAKC,OAAOG,SAGtDN,IAAIuB,GACH,OAAOA,EAAIrB,KAAKO,GAEjBT,IAAIuB,GACH,OAAOA,EAAIrB,KAAKQ,GAEjBV,IAAIuB,GACH,OAAOA,EAERvB,IAAIuB,GACH,OAAOA,EAGRvB,WAAWI,GACVF,KAAKE,KAAOA,EACZF,KAAKK,IAAIK,KAAOV,KAAKS,QAAQC,KAC7B,IAAI,IAAIY,EAAE,EAAEA,EAAEpB,EAAKqB,OAAOD,IAAK,CAC9B,MAAME,EAAItB,EAAKoB,GACf,GAAGE,EAAEC,SAAU,CACdzB,KAAKa,MAAMW,EAAEC,UAAYD,EAAEE,MAC3B,SAED,IAAIA,GAASC,UAAU,EAAEC,MAAM5B,KAAKS,QAAQE,aAC5C,GAAGa,EAAEX,MACJ,IAAI,IAAIgB,KAAK7B,KAAKa,MAAMW,EAAEX,OACzBa,EAAMG,GAAK7B,KAAKa,MAAMW,EAAEX,OAAOgB,GAGjC,GAAGL,EAAEE,MACJ,IAAI,IAAIG,KAAKL,EAAEE,MACdA,EAAMG,GAAKL,EAAEE,MAAMG,GAGrB,IAAIC,EAAI,EAAQC,EAAI,EAChBC,EAAE,GAAQC,EAAI,GAelB,OAdGT,EAAEU,OAAMR,EAAMQ,KAAOV,EAAEU,WAClBC,GAALX,EAAEM,IAAcJ,EAAMI,EAAIN,EAAEM,QACvBK,GAALX,EAAEO,IAAcL,EAAMK,EAAIP,EAAEO,QACnBI,GAATX,EAAErB,QAAkBuB,EAAMvB,MAAQqB,EAAErB,YAC1BgC,GAAVX,EAAEpB,SAAmBsB,EAAMtB,OAASoB,EAAEpB,QACtCsB,EAAMQ,OACRJ,EAAIJ,EAAMQ,KAAK,GAAIH,EAAEL,EAAMQ,KAAK,GAAGF,EAAEN,EAAMQ,KAAK,GAAGD,EAAEP,EAAMQ,KAAK,SAErDC,GAATT,EAAMI,IAAcA,EAAIJ,EAAMI,QACrBK,GAATT,EAAMK,IAAcA,EAAIL,EAAMK,QACjBI,GAAbT,EAAMvB,QAAkB6B,EAAIN,EAAMvB,YACpBgC,GAAdT,EAAMtB,SAAmB6B,EAAIP,EAAMtB,QAEtCJ,KAAKK,IAAI+B,OACFZ,EAAEa,OACR,IAAK,MACDX,EAAMC,YAAW3B,KAAKK,IAAIsB,UAAYD,EAAMC,WAC5CD,EAAMY,aACRtC,KAAKK,IAAIc,UAAYO,EAAMY,WAC3BtC,KAAKK,IAAIe,SAASpB,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,GAAG/B,KAAKyC,IAAIT,GAAGhC,KAAK0C,IAAIT,KAE7DP,EAAMiB,SACR3C,KAAKK,IAAIuC,YAAclB,EAAMiB,OAC7B3C,KAAKK,IAAIwC,WAAW7C,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,GAAG/B,KAAKyC,IAAIT,GAAGhC,KAAK0C,IAAIT,KAElE,MACD,IAAK,WACJ,MAAMa,EAAUpB,EAAY,OAAEA,EAAMoB,OAAO,GAC3C9C,KAAKK,IAAI0C,YACT/C,KAAKK,IAAI2C,OAAOhD,KAAKuC,IAAIT,EAAEgB,GAAQ9C,KAAKwC,IAAIT,IAC5C/B,KAAKK,IAAI4C,OAAOjD,KAAKuC,IAAIT,EAAEE,EAAEc,GAAQ9C,KAAKwC,IAAIT,IAC9C/B,KAAKK,IAAI6C,MAAMlD,KAAKuC,IAAIT,EAAEE,GAAGhC,KAAKwC,IAAIT,GAAG/B,KAAKuC,IAAIT,EAAEE,GAAGhC,KAAKwC,IAAIT,EAAEe,GAAQA,GAC1E9C,KAAKK,IAAI4C,OAAOjD,KAAKuC,IAAIT,EAAEE,GAAGhC,KAAKwC,IAAIT,EAAEE,EAAEa,IAC3C9C,KAAKK,IAAI6C,MAAMlD,KAAKuC,IAAIT,EAAEE,GAAGhC,KAAKwC,IAAIT,GAAGE,EAAEjC,KAAKuC,IAAIT,EAAEE,EAAEc,GAAQ9C,KAAKwC,IAAIT,EAAEE,GAAGa,GAC9E9C,KAAKK,IAAI4C,OAAOjD,KAAKuC,IAAIT,EAAEgB,GAAQ9C,KAAKwC,IAAIT,EAAEE,IAC9CjC,KAAKK,IAAI6C,MAAMlD,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,EAAEE,GAAGjC,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,EAAEE,EAAEa,GAAQA,GAC1E9C,KAAKK,IAAI4C,OAAOjD,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,EAAEe,IACvC9C,KAAKK,IAAI6C,MAAMlD,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,GAAG/B,KAAKuC,IAAIT,EAAEgB,GAAQ9C,KAAKwC,IAAIT,GAAGe,GACnEpB,EAAMC,YAAW3B,KAAKK,IAAIsB,UAAYD,EAAMC,WAC5CD,EAAMY,aACRtC,KAAKK,IAAIc,UAAYO,EAAMY,WAC3BtC,KAAKK,IAAI8C,QAEPzB,EAAMiB,SACR3C,KAAKK,IAAIuC,YAAclB,EAAMiB,OAC7B3C,KAAKK,IAAI+C,UAEV,MACD,IAAK,OAEJ,MACD,IAAK,OACD1B,EAAM2B,MAAOrD,KAAKK,IAAIc,UAAYO,EAAM2B,MAAYrD,KAAKK,IAAIc,UAAYnB,KAAKS,QAAQG,UACtFc,EAAMhB,OAAMV,KAAKK,IAAIK,KAAOgB,EAAMhB,MAClCgB,EAAM4B,MAAOtD,KAAKK,IAAIkD,UAAY7B,EAAM4B,MAAatD,KAAKK,IAAIkD,UAAa,OAC3E7B,EAAMvB,OACQ,SAAbuB,EAAM4B,QAAgBxB,GAAKE,GACd,UAAbN,EAAM4B,QAAiBxB,GAAKE,EAAE,IAC3BA,OAAIG,EACXnC,KAAKK,IAAImD,SAAShC,EAAEiC,IAAIzD,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,GAAGC,GAChD,MACD,IAAK,UACJ,IAAI0B,EACDlC,EAAEiC,KACJC,EAAI1D,KAAK2D,QAAQnC,EAAEE,GACnBxB,EAAKoB,GAAGsC,MAAQF,GACPlC,EAAEoC,QACXF,EAAIlC,EAAEoC,OAEP,IAAIC,OAAwB1B,GAAlBT,EAAMoC,WAAuBpC,EAAMoC,WAAW,GACrDpC,EAAM2B,MAAOrD,KAAKK,IAAIc,UAAYO,EAAM2B,MAAYrD,KAAKK,IAAIc,UAAYnB,KAAKS,QAAQG,UACtFc,EAAMhB,OAAMV,KAAKK,IAAIK,KAAOgB,EAAMhB,MAClCgB,EAAM4B,MAAOtD,KAAKK,IAAIkD,UAAY7B,EAAM4B,MAAatD,KAAKK,IAAIkD,UAAa,OAC9D,SAAb7B,EAAM4B,QAAgBxB,GAAKE,GACd,UAAbN,EAAM4B,QAAiBxB,GAAKE,EAAE,GACjC,MAAM+B,OAAsB5B,GAAfT,EAAMsC,QAAoBtC,EAAMsC,QAAQ,EAC/CC,OAAsB9B,GAAfT,EAAMwC,QAAoBxC,EAAMwC,QAAQ,EACrD,IAAIC,GAAQJ,EACRK,EAAMP,EAAKI,EACfjE,KAAKK,IAAI6B,KAAKlC,KAAKuC,IAAIT,GAAG9B,KAAKwC,IAAIT,GAAGC,EAAEC,GACxCjC,KAAKK,IAAIgE,OACT,IAAI,IAAI/C,EAAE,EAAEA,EAAEoC,EAAEnC,SACZ6C,EAAG,GACLpE,KAAKK,IAAImD,SAASE,EAAEpC,GAAGtB,KAAKuC,IAAI4B,EAAGrC,GAAG9B,KAAKwC,IAAI4B,EAAGrC,GAAGC,KACnDoC,EAAGnC,EAAE4B,IAHcvC,IAItB8C,GAAMP,EAEP,MACD,IAAK,MACJ,IAAIS,QAAYzE,EAAY0E,cAAc/C,EAAEgD,UAC5BrC,GAAbT,EAAMvB,YAAkCgC,GAAdT,EAAMtB,QAClC4B,EAAIN,EAAMvB,MAAQ8B,EAAIP,EAAMvB,MAAQmE,EAAIlE,OAASkE,EAAInE,YAEtCgC,GAAbT,EAAMvB,YAAkCgC,GAAdT,EAAMtB,QAClC6B,EAAIP,EAAMtB,OAAS4B,EAAIN,EAAMtB,OAASkE,EAAInE,MAAQmE,EAAIlE,aAEvC+B,GAAbT,EAAMvB,YAAkCgC,GAAdT,EAAMtB,QAClC4B,EAAIN,EAAMvB,MAAQ8B,EAAIP,EAAMtB,SACrB4B,EAAEsC,EAAInE,MAAM8B,EAAEqC,EAAIlE,QAC1BJ,KAAKK,IAAIoE,UAAUH,EAAIxC,EAAEC,EAAEC,EAAEC,GAG/B,GAAGT,EAAEkD,SAAU,CACd,MAAMC,EAAM3E,KAAKO,GAAWqE,EAAM5E,KAAKQ,GACvCR,KAAKO,GAAKuB,EAAI9B,KAAKQ,GAAKuB,EACxB/B,KAAK6E,KAAKrD,EAAEkD,UACZ1E,KAAKO,GAAKoE,EAAK3E,KAAKQ,GAAKoE,EAE1B5E,KAAKK,IAAIyE,WAIXhF,eAAeiF,EAAG7E,GACbA,IAAMA,EAAOF,KAAKE,MACtB,IAAI,IAAIoB,EAAE,EAAEA,EAAEpB,EAAKqB,OAAOD,IAAK,CAC9B,GAAGpB,EAAKoB,GAAGyD,IAAMA,EAChB,OAAO7E,EAAKoB,GAEb,GAAGpB,EAAKoB,GAAGoD,SAAU,CACpB,IAAIM,EAAKhF,KAAKiF,eAAeF,EAAG7E,EAAKoB,GAAGoD,UACxC,GAAGM,EAAG,OAAOA,GAGf,OAAO,KAERlF,QAAQ0B,EAAEE,GAWDF,EAAEU,KAAK,GAAUV,EAAEU,KAAK,GAAhC,IAAuCF,EAAER,EAAEU,KAAK,GAC5CuB,GADqDjC,EAAEU,KAAK,GACtD,UAVTpC,YAAY2D,GACXzD,KAAKkF,KAAOzB,EAAI0B,MAAM,wDAEvB5D,aAAe,OAAOvB,KAAKkF,KAAK3D,OAChC6D,WAAa,OAAOpF,KAAKkF,KACzBpF,OAAOwB,EAAE+D,GACR,OAAOrF,KAAKkF,KAAKI,MAAMhE,OAAMa,GAAHkD,OAAclD,EAAUb,EAAE+D,GAAGE,KAAK,MAIzC/D,EAAEiC,MACvBzD,KAAKK,IAAI+B,OACNV,EAAMhB,OAAMV,KAAKK,IAAIK,KAAOgB,EAAMhB,MACrC,IAAI8E,EAAI,EACJ5B,KAEJ,IAAI,IAAItC,EAAG,EAAGA,EAAEmC,EAAIlC,OAAOD,IAC1B,GAAkB,MAAfmC,EAAI2B,KAAK9D,GACXsC,EAAM6B,KAAKhC,EAAIiC,OAAOF,EAAGlE,EAAEkE,IAE3BA,IADAlE,OAGD,GAAGtB,KAAKK,IAAIsF,YAAYlC,EAAIiC,OAAOF,EAAGlE,EAAEkE,EAAG,IAAIrF,MAAQ6B,EAAG,CACzD,IAAI4D,EAAKtE,EACT,KAAMA,EAAEsE,EAAG,GAAKnC,EAAI2B,KAAK9D,EAAE,GAAG6D,MAAMnF,KAAKe,KAAKO,IAC9C,KAAMA,EAAEsE,EAAG,GAAKnC,EAAI2B,KAAK9D,GAAG6D,MAAMnF,KAAKc,KAAKQ,IAE5C,KAAMmC,EAAI2B,KAAK9D,EAAE,GAAG6D,MAAMnF,KAAKgB,KAAOyC,EAAI2B,KAAK9D,GAAG6D,MAAMnF,KAAKgB,KAE5D,KADAM,GACMkE,EAAI,CACTlE,EAAEsE,EAAK,MAGThC,EAAM6B,KAAKhC,EAAIiC,OAAOF,EAAGlE,EAAEkE,IAC3BA,EAAKlE,EAOP,OAJGkE,EAAG/B,EAAIlC,QACTqC,EAAM6B,KAAKhC,EAAIiC,OAAOF,IAEvBxF,KAAKK,IAAIyE,UACFlB,EAGR9D,2BAA2B0E,GAC1B,OAAO,IAAIqB,QAAQ,CAACC,EAAQC,KAC3BlG,EAAYmG,SAASxB,GAAKyB,KAAK,SAASC,KAAMC,IAC7C,MAAMC,EAAO,IAAIC,MACXC,EAAMC,IAAIC,gBAAgBL,GAChCC,EAAKK,OAAS,MACbF,IAAIG,gBAAgBJ,GACpBR,EAAQM,KAETA,EAAK5B,IAAM8B,IACTK,MAAOC,IACTd,EAAQ,UAIXhG,gBAAgB0E,EAAIqC,GACnB,OAAO,IAAIhB,QAAQ,CAACC,EAAQC,KAC3B,MAAMe,EAAM,IAAIC,eAChBD,EAAIE,KAAK,MAAMxC,GAAI,GACnBsC,EAAIG,aAAgBJ,GAAOA,EAAIZ,KAAMY,EAAIZ,KAAK,OAC9Ca,EAAIL,OAAS,MACG,KAAZK,EAAII,OACNpB,EAAQgB,EAAIK,UAEZpB,EAAO,cAAce,EAAIM,cAG3BN,EAAIO,QAAU,MACbtB,EAAO,cAAce,EAAIM,cAE1BN,EAAIQ,SAINxH,gBAAgByH,EAAKC,GACpB,OAAO,IAAI3B,QAAQ,CAACC,EAAQC,KAC3B,IAAI0B,SAASC,MAEZ,YADA5B,EAAQ,MAGT,IAAI6B,EAAI,IAAIC,SAASL,SAAYC,SAC7BG,EAIJA,EAAEE,OAAO3B,KAAMxF,IACd+G,SAASC,MAAMI,IAAIpH,GACnBoF,EAAQpF,KACNiG,MAAOC,IACTb,EAAOa,KAPPd,EAAQ,SAYZ,OAAOlG,EAAKC,YAAcA","file":"../Json2Canvas.js","sourcesContent":["define([\n    \"./poxp\"\n],function(poxp){\n\t//draw canvas from json data\n\t//\t\t\t\t2018 wakufactory \n\t//\n\t// shapes box,roundbox,text,textbox,img \n\t// property str,src ,rect,x,y,width,height \n\t// styles radius,color,border,background,lineWidth,font,lineHeight,align,offsetx,offsety\n\t//\n\t//export {Json2Canvas}\n\tclass Json2Canvas {\n\n\t\tconstructor(can) {\n\t\t\tthis.canvas = can \n\t\t\tthis.data = null \n\t\t\tthis.width = can.width\n\t\t\tthis.height = can.height \n\t\t\tthis.ctx = can.getContext(\"2d\");\n\t\t\tthis.bx = 0\n\t\t\tthis.by = 0 \n\t\t\tthis.default = {\n\t\t\t\tfont:\"20px sans-serif\",\n\t\t\t\tborderColor:\"black\",\n\t\t\t\ttextColor:\"black\",\n\t\t//\t\tbackgroundColor:\"white\"\n\t\t\t}\n\t\t\tthis.class = {}\n\t\t\tthis.km = /[。、\\.\\-,)\\]｝、〕〉》」』】〙〗〟’”｠»ゝゞーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇷ゚ㇺㇻㇼㇽㇾㇿ々〻‐゠–〜～?!‼⁇⁈⁉・:;\\/]/\n\t\t\tthis.tm = /[(\\[｛〔〈《「『【〘〖〝‘“｟«]/\n\t\t\tthis.am = /[a-zA-Z—―]/\n\t\t}\n\n\t\tclear(clearColor) {\n\t\t\tthis.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)\n\t\t\tif(clearColor) {\n\t\t\t\tthis.ctx.fillStyle = clearColor\n\t\t\t\tthis.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)\n\t\t\t}\n\t\t}\n\t\t_ax(v) {\n\t\t\treturn v + this.bx\n\t\t}\n\t\t_ay(v) {\n\t\t\treturn v + this.by \n\t\t}\n\t\t_aw(v) {\n\t\t\treturn v \n\t\t}\n\t\t_ah(v) {\n\t\t\treturn v  \n\t\t}\n\n\t\tasync draw(data){\n\t\t\tthis.data = data \n\t\t\tthis.ctx.font = this.default.font \n\t\t\tfor(let i=0;i<data.length;i++) {\n\t\t\t\tconst d = data[i]\n\t\t\t\tif(d.classdef) {\n\t\t\t\t\tthis.class[d.classdef] = d.style ;\n\t\t\t\t\tcontinue ;\n\t\t\t\t}\n\t\t\t\tlet style = {lineWidth:1,boder:this.default.borderColor}\n\t\t\t\tif(d.class) {\n\t\t\t\t\tfor(let s in this.class[d.class]) {\n\t\t\t\t\t\tstyle[s] = this.class[d.class][s]\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(d.style) {\n\t\t\t\t\tfor(let s in d.style) {\n\t\t\t\t\t\tstyle[s] = d.style[s]\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet x = 0 ; let y = 0 ;\n\t\t\t\tlet w=10; let h = 10 ;\n\t\t\t\tif(d.rect) style.rect = d.rect \n\t\t\t\tif(d.x!=undefined) style.x = d.x \n\t\t\t\tif(d.y!=undefined) style.y = d.y\n\t\t\t\tif(d.width!=undefined) style.width = d.width\n\t\t\t\tif(d.height!=undefined) style.height = d.height \n\t\t\t\tif(style.rect) {\n\t\t\t\t\tx = style.rect[0] ;y=style.rect[1];w=style.rect[2];h=style.rect[3]\n\t\t\t\t} \n\t\t\t\tif(style.x!=undefined) x = style.x \n\t\t\t\tif(style.y!=undefined) y = style.y \n\t\t\t\tif(style.width!=undefined) w = style.width\n\t\t\t\tif(style.height!=undefined) h = style.height\n\t\t\t\t\n\t\t\t\tthis.ctx.save()\n\t\t\t\tswitch(d.shape) {\n\t\t\t\t\tcase \"box\":\n\t\t\t\t\t\tif(style.lineWidth) this.ctx.lineWidth = style.lineWidth\n\t\t\t\t\t\tif(style.background) {\n\t\t\t\t\t\t\tthis.ctx.fillStyle = style.background \n\t\t\t\t\t\t\tthis.ctx.fillRect(this._ax(x),this._ay(y),this._aw(w),this._ah(h))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(style.border) {\n\t\t\t\t\t\t\tthis.ctx.strokeStyle = style.border\n\t\t\t\t\t\t\tthis.ctx.strokeRect(this._ax(x),this._ay(y),this._aw(w),this._ah(h))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"roundbox\":\n\t\t\t\t\t\tconst radius = (style.radius)?style.radius:20 \n\t\t\t\t\t\tthis.ctx.beginPath()\n\t\t\t\t\t\tthis.ctx.moveTo(this._ax(x+radius),this._ay(y))\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x+w-radius),this._ay(y))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x+w),this._ay(y),this._ax(x+w),this._ay(y+radius),radius)\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x+w),this._ay(y+h-radius))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x+w),this._ay(y)+h,this._ax(x+w-radius),this._ay(y+h),radius)\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x+radius),this._ay(y+h))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x),this._ay(y+h),this._ax(x),this._ay(y+h-radius),radius)\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x),this._ay(y+radius))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x),this._ay(y),this._ax(x+radius),this._ay(y),radius)\n\t\t\t\t\t\tif(style.lineWidth) this.ctx.lineWidth = style.lineWidth\n\t\t\t\t\t\tif(style.background) {\n\t\t\t\t\t\t\tthis.ctx.fillStyle = style.background \n\t\t\t\t\t\t\tthis.ctx.fill()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(style.border) {\n\t\t\t\t\t\t\tthis.ctx.strokeStyle = style.border\n\t\t\t\t\t\t\tthis.ctx.stroke()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"line\":\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"text\":\n\t\t\t\t\t\tif(style.color) this.ctx.fillStyle = style.color ;else this.ctx.fillStyle = this.default.textColor\n\t\t\t\t\t\tif(style.font) this.ctx.font = style.font \n\t\t\t\t\t\tif(style.align) this.ctx.textAlign = style.align ; else this.ctx.textAlign  = \"left\"\n\t\t\t\t\t\tif(style.width) {\n\t\t\t\t\t\t\tif(style.align==\"right\") x += w\n\t\t\t\t\t\t\tif(style.align==\"center\") x += w/2 \n\t\t\t\t\t\t} else w = undefined\n\t\t\t\t\t\tthis.ctx.fillText(d.str,this._ax(x),this._ay(y),w)\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"textbox\":\n\t\t\t\t\t\tlet l \n\t\t\t\t\t\tif(d.str) {\n\t\t\t\t\t\t\tl = this.boxscan(d,style)\n\t\t\t\t\t\t\tdata[i].lines = l\n\t\t\t\t\t\t} else if(d.lines) {\n\t\t\t\t\t\t\tl = d.lines \n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet lh = (style.lineHeight!=undefined)?style.lineHeight:20\n\t\t\t\t\t\tif(style.color) this.ctx.fillStyle = style.color ;else this.ctx.fillStyle = this.default.textColor\n\t\t\t\t\t\tif(style.font) this.ctx.font = style.font \n\t\t\t\t\t\tif(style.align) this.ctx.textAlign = style.align ; else this.ctx.textAlign  = \"left\"\n\t\t\t\t\t\tif(style.align==\"right\") x += w\n\t\t\t\t\t\tif(style.align==\"center\") x += w/2 \n\t\t\t\t\t\tconst ox = ((style.offsetx!=undefined)?style.offsetx:0)\n\t\t\t\t\t\tconst oy = ((style.offsety!=undefined)?style.offsety:0)\n\t\t\t\t\t\tlet lx =  - ox\n\t\t\t\t\t\tlet ly =  lh - oy\n\t\t\t\t\t\tthis.ctx.rect(this._ax(x),this._ay(y),w,h)\n\t\t\t\t\t\tthis.ctx.clip() \n\t\t\t\t\t\tfor(let i=0;i<l.length;i++) {\n\t\t\t\t\t\t\tif(ly>0)\n\t\t\t\t\t\t\t\tthis.ctx.fillText(l[i],this._ax(lx+x),this._ay(ly+y),w)\n\t\t\t\t\t\t\tif(ly>h+lh) break ;\n\t\t\t\t\t\t\tly += lh \n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase \"img\":\n\t\t\t\t\t\tlet img = await Json2Canvas.loadImageAjax(d.src)\n\t\t\t\t\t\tif(style.width!=undefined && style.height==undefined) {\n\t\t\t\t\t\t\tw = style.width ; h = style.width * img.height / img.width\n\t\t\t\t\t\t} else \n\t\t\t\t\t\tif(style.width==undefined && style.height!=undefined) {\n\t\t\t\t\t\t\th = style.height ; w = style.height * img.width / img.height\n\t\t\t\t\t\t} else\n\t\t\t\t\t\tif(style.width!=undefined && style.height!=undefined) {\n\t\t\t\t\t\t\tw = style.width ; h = style.height \n\t\t\t\t\t\t} else {w=img.width;h=img.height}\n\t\t\t\t\t\tthis.ctx.drawImage(img,x,y,w,h)\n\t\t\t\t\t\tbreak ;\n\t\t\t\t}\n\t\t\t\tif(d.children) {\n\t\t\t\t\tconst bbx = this.bx ; const bby = this.by \n\t\t\t\t\tthis.bx = x ; this.by = y \n\t\t\t\t\tthis.draw(d.children)\n\t\t\t\t\tthis.bx = bbx ;this.by = bby \n\t\t\t\t}\n\t\t\t\tthis.ctx.restore()\n\t\t\t}\n\t\t}\n\n\t\tgetElementById(id,data) {\n\t\t\tif(!data) data = this.data \t\n\t\t\tfor(let i=0;i<data.length;i++) {\n\t\t\t\tif(data[i].id == id) {\n\t\t\t\t\treturn data[i] ;\n\t\t\t\t}\n\t\t\t\tif(data[i].children) {\n\t\t\t\t\tvar c =  this.getElementById(id,data[i].children) ;\n\t\t\t\t\tif(c) return c ;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null\n\t\t}\n\t\tboxscan(d,style) {\n\t\t\tclass unistr {\n\t\t\t\tconstructor(str) {\n\t\t\t\t\tthis._str = str.match(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[^\\uD800-\\uDFFF]/g) || [];\n\t\t\t\t}\n\t\t\t\tget length() { return this._str.length }\n\t\t\t\tget char() { return this._str }\n\t\t\t\tsubstr(i,n) {\n\t\t\t\t\treturn this._str.slice(i,(n==undefined)?undefined:i+n).join(\"\")\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet x = d.rect[0] ;let y=d.rect[1];let w=d.rect[2];let h=d.rect[3]\n\t\t\tlet str = new unistr(d.str)\n\t\t\tthis.ctx.save()\n\t\t\tif(style.font) this.ctx.font = style.font \n\t\t\tlet si =0 \n\t\t\tlet lines = [] \n\n\t\t\tfor(let i =1 ;i<str.length;i++) {\n\t\t\t\tif(str.char[i] == \"\\n\") {\n\t\t\t\t\tlines.push(str.substr(si,i-si))\n\t\t\t\t\ti++\n\t\t\t\t\tsi = i \t\t\t\t\t\t\n\t\t\t\t} else \n\t\t\t\tif(this.ctx.measureText(str.substr(si,i-si+1)).width > w) {\n\t\t\t\t\tlet ii = i \n\t\t\t\t\twhile(i>ii-4 && str.char[i-1].match(this.tm)) i--\t//行末禁則追い出し\n\t\t\t\t\twhile(i<ii+4 && str.char[i].match(this.km)) i++\t\t//行頭禁則追い込み\n\n\t\t\t\t\twhile(str.char[i-1].match(this.am) && str.char[i].match(this.am)) { //分離禁止追い出し\n\t\t\t\t\t\ti-- \n\t\t\t\t\t\tif(i==si) {\n\t\t\t\t\t\t\ti=ii ; break ; \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlines.push(str.substr(si,i-si))\n\t\t\t\t\tsi = i\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(si<str.length) {\n\t\t\t\tlines.push(str.substr(si))\n\t\t\t}\n\t\t\tthis.ctx.restore()\n\t\t\treturn lines\n\t\t}\n\n\t\tstatic async loadImageAjax(src) {\n\t\t\treturn new Promise((resolve,reject)=>{\n\t\t\t\tJson2Canvas.loadAjax(src,{type:\"blob\"}).then((b)=>{\n\t\t\t\t\tconst timg = new Image ;\n\t\t\t\t\tconst url = URL.createObjectURL(b);\n\t\t\t\t\ttimg.onload = ()=> {\n\t\t\t\t\t\tURL.revokeObjectURL(url)\n\t\t\t\t\t\tresolve(timg) ;\n\t\t\t\t\t}\n\t\t\t\t\ttimg.src = url\n\t\t\t\t}).catch((err)=>{\n\t\t\t\t\tresolve(null) ;\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\tstatic loadAjax(src,opt) {\n\t\t\treturn new Promise((resolve,reject)=> {\n\t\t\t\tconst req = new XMLHttpRequest();\n\t\t\t\treq.open(\"get\",src,true) ;\n\t\t\t\treq.responseType = (opt && opt.type)?opt.type:\"text\" ;\n\t\t\t\treq.onload = ()=> {\n\t\t\t\t\tif(req.status==200) {\n\t\t\t\t\t\tresolve(req.response) ;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(\"Ajax error:\"+req.statusText) ;\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treq.onerror = ()=> {\n\t\t\t\t\treject(\"Ajax error:\"+req.statusText)\n\t\t\t\t}\n\t\t\t\treq.send() ;\n\t\t\t})\n\t\t}\n\n\t\tstatic loadFont(name,path) {\n\t\t\treturn new Promise((resolve,reject)=>{\n\t\t\t\tif(!document.fonts) {\n\t\t\t\t\tresolve(null)\n\t\t\t\t\treturn \n\t\t\t\t}\n\t\t\t\tlet f = new FontFace(name,`url(${path})`,{})\n\t\t\t\tif(!f) {\n\t\t\t\t\tresolve(null)\n\t\t\t\t\treturn \n\t\t\t\t}\n\t\t\t\tf.load().then((font)=>{\n\t\t\t\t\tdocument.fonts.add(font)\n\t\t\t\t\tresolve(font) \n\t\t\t\t}).catch((err)=> {\n\t\t\t\t\treject(err) \n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t}  //class Json2Canvas\n\treturn poxp.Json2Canvas = Json2Canvas;\n});"]}