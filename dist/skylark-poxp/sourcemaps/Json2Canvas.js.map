{"version":3,"sources":["Json2Canvas.js"],"names":["define","pox","Json2Canvas","[object Object]","can","this","canvas","data","width","height","ctx","getContext","bx","by","default","font","borderColor","textColor","backgroundColor","class","km","tm","am","clearColor","clearRect","fillStyle","fillRect","v","i","length","d","classdef","style","lineWidth","boder","s","x","y","w","h","rect","undefined","save","shape","background","_ax","_ay","_aw","_ah","border","strokeStyle","strokeRect","radius","beginPath","moveTo","lineTo","arcTo","fill","stroke","color","align","textAlign","fillText","str","l","boxscan","lines","lh","lineHeight","ox","offsetx","oy","offsety","lx","ly","clip","img","loadImageAjax","src","drawImage","children","bbx","bby","draw","restore","id","c","getElementById","_str","match","char","n","slice","join","si","push","substr","measureText","ii","Promise","resolve","reject","loadAjax","type","then","b","timg","Image","url","URL","createObjectURL","onload","revokeObjectURL","catch","err","opt","req","XMLHttpRequest","open","responseType","status","response","statusText","onerror","send","name","path","document","fonts","f","FontFace","load","add"],"mappings":"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","file":"../Json2Canvas.js","sourcesContent":["define([\n    \"./pox\"\n],function(pox){\n\t//draw canvas from json data\n\t//\t\t\t\t2018 wakufactory \n\t//\n\t// shapes box,roundbox,text,textbox,img \n\t// property str,src ,rect,x,y,width,height \n\t// styles radius,color,border,background,lineWidth,font,lineHeight,align,offsetx,offsety\n\t//\n\tclass Json2Canvas {\n\n\t\tconstructor(can) {\n\t\t\tthis.canvas = can \n\t\t\tthis.data = null \n\t\t\tthis.width = can.width\n\t\t\tthis.height = can.height \n\t\t\tthis.ctx = can.getContext(\"2d\");\n\t\t\tthis.bx = 0\n\t\t\tthis.by = 0 \n\t\t\tthis.default = {\n\t\t\t\tfont:\"20px sans-serif\",\n\t\t\t\tborderColor:\"black\",\n\t\t\t\ttextColor:\"black\",\n\t\t\t\tbackgroundColor:\"white\"\n\t\t\t}\n\t\t\tthis.class = {}\n\t\t\tthis.km = /[。、\\.\\-,)\\]｝、〕〉》」』】〙〗〟’”｠»ゝゞーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇷ゚ㇺㇻㇼㇽㇾㇿ々〻‐゠–〜～?!‼⁇⁈⁉・:;\\/]/\n\t\t\tthis.tm = /[(\\[｛〔〈《「『【〘〖〝‘“｟«]/\n\t\t\tthis.am = /[a-zA-Z—―]/\n\t\t}\n\n\t\tclear(clearColor) {\n\t\t\tthis.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)\n\t\t\tif(clearColor) {\n\t\t\t\tthis.ctx.fillStyle = clearColor\n\t\t\t\tthis.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)\n\t\t\t}\n\t\t}\n\t\t_ax(v) {\n\t\t\treturn v + this.bx\n\t\t}\n\t\t_ay(v) {\n\t\t\treturn v + this.by \n\t\t}\n\t\t_aw(v) {\n\t\t\treturn v \n\t\t}\n\t\t_ah(v) {\n\t\t\treturn v  \n\t\t}\n\n\t\tasync draw(data){\n\t\t\tthis.data = data \n\t\t\tthis.ctx.font = this.default.font \n\t\t\tfor(let i=0;i<data.length;i++) {\n\t\t\t\tconst d = data[i]\n\t\t\t\tif(d.classdef) {\n\t\t\t\t\tthis.class[d.classdef] = d.style ;\n\t\t\t\t\tcontinue ;\n\t\t\t\t}\n\t\t\t\tlet style = {lineWidth:1,boder:this.default.borderColor}\n\t\t\t\tif(d.class) {\n\t\t\t\t\tfor(let s in this.class[d.class]) {\n\t\t\t\t\t\tstyle[s] = this.class[d.class][s]\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(d.style) {\n\t\t\t\t\tfor(let s in d.style) {\n\t\t\t\t\t\tstyle[s] = d.style[s]\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet x = 0 ; let y = 0 ;\n\t\t\t\tlet w=10; let h = 10 ;\n\t\t\t\tif(d.rect) style.rect = d.rect \n\t\t\t\tif(d.x!=undefined) style.x = d.x \n\t\t\t\tif(d.y!=undefined) style.y = d.y\n\t\t\t\tif(d.width!=undefined) style.width = d.width\n\t\t\t\tif(d.height!=undefined) style.height = d.height \n\t\t\t\tif(style.rect) {\n\t\t\t\t\tx = style.rect[0] ;y=style.rect[1];w=style.rect[2];h=style.rect[3]\n\t\t\t\t} \n\t\t\t\tif(style.x!=undefined) x = style.x \n\t\t\t\tif(style.y!=undefined) y = style.y \n\t\t\t\tif(style.width!=undefined) w = style.width\n\t\t\t\tif(style.height!=undefined) h = style.height\n\t\t\t\t\n\t\t\t\tthis.ctx.save()\n\t\t\t\tswitch(d.shape) {\n\t\t\t\t\tcase \"box\":\n\t\t\t\t\t\tif(style.lineWidth) this.ctx.lineWidth = style.lineWidth\n\t\t\t\t\t\tif(style.background) {\n\t\t\t\t\t\t\tthis.ctx.fillStyle = style.background \n\t\t\t\t\t\t\tthis.ctx.fillRect(this._ax(x),this._ay(y),this._aw(w),this._ah(h))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(style.border) {\n\t\t\t\t\t\t\tthis.ctx.strokeStyle = style.border\n\t\t\t\t\t\t\tthis.ctx.strokeRect(this._ax(x),this._ay(y),this._aw(w),this._ah(h))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"roundbox\":\n\t\t\t\t\t\tconst radius = (style.radius)?style.radius:20 \n\t\t\t\t\t\tthis.ctx.beginPath()\n\t\t\t\t\t\tthis.ctx.moveTo(this._ax(x+radius),this._ay(y))\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x+w-radius),this._ay(y))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x+w),this._ay(y),this._ax(x+w),this._ay(y+radius),radius)\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x+w),this._ay(y+h-radius))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x+w),this._ay(y)+h,this._ax(x+w-radius),this._ay(y+h),radius)\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x+radius),this._ay(y+h))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x),this._ay(y+h),this._ax(x),this._ay(y+h-radius),radius)\n\t\t\t\t\t\tthis.ctx.lineTo(this._ax(x),this._ay(y+radius))\n\t\t\t\t\t\tthis.ctx.arcTo(this._ax(x),this._ay(y),this._ax(x+radius),this._ay(y),radius)\n\t\t\t\t\t\tif(style.lineWidth) this.ctx.lineWidth = style.lineWidth\n\t\t\t\t\t\tif(style.background) {\n\t\t\t\t\t\t\tthis.ctx.fillStyle = style.background \n\t\t\t\t\t\t\tthis.ctx.fill()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(style.border) {\n\t\t\t\t\t\t\tthis.ctx.strokeStyle = style.border\n\t\t\t\t\t\t\tthis.ctx.stroke()\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"line\":\n\t\t\t\t\t\t\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"text\":\n\t\t\t\t\t\tif(style.color) this.ctx.fillStyle = style.color ;else this.ctx.fillStyle = this.default.textColor\n\t\t\t\t\t\tif(style.font) this.ctx.font = style.font \n\t\t\t\t\t\tif(style.align) this.ctx.textAlign = style.align ; else this.ctx.textAlign  = \"left\"\n\t\t\t\t\t\tif(style.width) {\n\t\t\t\t\t\t\tif(style.align==\"right\") x += w\n\t\t\t\t\t\t\tif(style.align==\"center\") x += w/2 \n\t\t\t\t\t\t} else w = undefined\n\t\t\t\t\t\tthis.ctx.fillText(d.str,this._ax(x),this._ay(y),w)\n\t\t\t\t\t\tbreak ;\n\t\t\t\t\tcase \"textbox\":\n\t\t\t\t\t\tlet l \n\t\t\t\t\t\tif(d.str) {\n\t\t\t\t\t\t\tl = this.boxscan(d,style)\n\t\t\t\t\t\t\tdata[i].lines = l\n\t\t\t\t\t\t} else if(d.lines) {\n\t\t\t\t\t\t\tl = d.lines \n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet lh = (style.lineHeight!=undefined)?style.lineHeight:20\n\t\t\t\t\t\tif(style.color) this.ctx.fillStyle = style.color ;else this.ctx.fillStyle = this.default.textColor\n\t\t\t\t\t\tif(style.font) this.ctx.font = style.font \n\t\t\t\t\t\tif(style.align) this.ctx.textAlign = style.align ; else this.ctx.textAlign  = \"left\"\n\t\t\t\t\t\tif(style.align==\"right\") x += w\n\t\t\t\t\t\tif(style.align==\"center\") x += w/2 \n\t\t\t\t\t\tconst ox = ((style.offsetx!=undefined)?style.offsetx:0)\n\t\t\t\t\t\tconst oy = ((style.offsety!=undefined)?style.offsety:0)\n\t\t\t\t\t\tlet lx =  - ox\n\t\t\t\t\t\tlet ly =  lh - oy\n\t\t\t\t\t\tthis.ctx.rect(this._ax(x),this._ay(y),w,h)\n\t\t\t\t\t\tthis.ctx.clip() \n\t\t\t\t\t\tfor(let i=0;i<l.length;i++) {\n\t\t\t\t\t\t\tif(ly>0)\n\t\t\t\t\t\t\t\tthis.ctx.fillText(l[i],this._ax(lx+x),this._ay(ly+y),w)\n\t\t\t\t\t\t\tif(ly>h+lh) break ;\n\t\t\t\t\t\t\tly += lh \n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase \"img\":\n\t\t\t\t\t\tlet img = await Json2Canvas.loadImageAjax(d.src)\n\t\t\t\t\t\tif(style.width!=undefined && style.height==undefined) {\n\t\t\t\t\t\t\tw = style.width ; h = style.width * img.height / img.width\n\t\t\t\t\t\t} else \n\t\t\t\t\t\tif(style.width==undefined && style.height!=undefined) {\n\t\t\t\t\t\t\th = style.height ; w = style.height * img.width / img.height\n\t\t\t\t\t\t} else\n\t\t\t\t\t\tif(style.width!=undefined && style.height!=undefined) {\n\t\t\t\t\t\t\tw = style.width ; h = style.height \n\t\t\t\t\t\t} else {w=img.width;h=img.height}\n\t\t\t\t\t\tthis.ctx.drawImage(img,x,y,w,h)\n\t\t\t\t\t\tbreak ;\n\t\t\t\t}\n\t\t\t\tif(d.children) {\n\t\t\t\t\tconst bbx = this.bx ; const bby = this.by \n\t\t\t\t\tthis.bx = x ; this.by = y \n\t\t\t\t\tthis.draw(d.children)\n\t\t\t\t\tthis.bx = bbx ;this.by = bby \n\t\t\t\t}\n\t\t\t\tthis.ctx.restore()\n\t\t\t}\n\t\t}\n\n\t\tgetElementById(id,data) {\n\t\t\tif(!data) data = this.data \t\n\t\t\tfor(let i=0;i<data.length;i++) {\n\t\t\t\tif(data[i].id == id) {\n\t\t\t\t\treturn data[i] ;\n\t\t\t\t}\n\t\t\t\tif(data[i].children) {\n\t\t\t\t\tvar c =  this.getElementById(id,data[i].children) ;\n\t\t\t\t\tif(c) return c ;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null\n\t\t}\n\t\tboxscan(d,style) {\n\t\t\tclass unistr {\n\t\t\t\tconstructor(str) {\n\t\t\t\t\tthis._str = str.match(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[^\\uD800-\\uDFFF]/g) || [];\n\t\t\t\t}\n\t\t\t\tget length() { return this._str.length }\n\t\t\t\tget char() { return this._str }\n\t\t\t\tsubstr(i,n) {\n\t\t\t\t\treturn this._str.slice(i,(n==undefined)?undefined:i+n).join(\"\")\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet x = d.rect[0] ;let y=d.rect[1];let w=d.rect[2];let h=d.rect[3]\n\t\t\tlet str = new unistr(d.str)\n\t\t\tthis.ctx.save()\n\t\t\tif(style.font) this.ctx.font = style.font \n\t\t\tlet si =0 \n\t\t\tlet lines = [] \n\n\t\t\tfor(let i =1 ;i<str.length;i++) {\n\t\t\t\tif(str.char[i] == \"\\n\") {\n\t\t\t\t\tlines.push(str.substr(si,i-si))\n\t\t\t\t\ti++\n\t\t\t\t\tsi = i \t\t\t\t\t\t\n\t\t\t\t} else \n\t\t\t\tif(this.ctx.measureText(str.substr(si,i-si+1)).width > w) {\n\t\t\t\t\tlet ii = i \n\t\t\t\t\twhile(i>ii-4 && str.char[i-1].match(this.tm)) i--\t//行末禁則追い出し\n\t\t\t\t\twhile(i<ii+4 && str.char[i].match(this.km)) i++\t\t//行頭禁則追い込み\n\n\t\t\t\t\twhile(str.char[i-1].match(this.am) && str.char[i].match(this.am)) { //分離禁止追い出し\n\t\t\t\t\t\ti-- \n\t\t\t\t\t\tif(i==si) {\n\t\t\t\t\t\t\ti=ii ; break ; \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlines.push(str.substr(si,i-si))\n\t\t\t\t\tsi = i\t\t\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(si<str.length) {\n\t\t\t\tlines.push(str.substr(si))\n\t\t\t}\n\t\t\tthis.ctx.restore()\n\t\t\treturn lines\n\t\t}\n\n\t\tstatic async loadImageAjax(src) {\n\t\t\treturn new Promise((resolve,reject)=>{\n\t\t\t\tJson2Canvas.loadAjax(src,{type:\"blob\"}).then((b)=>{\n\t\t\t\t\tconst timg = new Image ;\n\t\t\t\t\tconst url = URL.createObjectURL(b);\n\t\t\t\t\ttimg.onload = ()=> {\n\t\t\t\t\t\tURL.revokeObjectURL(url)\n\t\t\t\t\t\tresolve(timg) ;\n\t\t\t\t\t}\n\t\t\t\t\ttimg.src = url\n\t\t\t\t}).catch((err)=>{\n\t\t\t\t\tresolve(null) ;\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\tstatic loadAjax(src,opt) {\n\t\t\treturn new Promise((resolve,reject)=> {\n\t\t\t\tconst req = new XMLHttpRequest();\n\t\t\t\treq.open(\"get\",src,true) ;\n\t\t\t\treq.responseType = (opt && opt.type)?opt.type:\"text\" ;\n\t\t\t\treq.onload = ()=> {\n\t\t\t\t\tif(req.status==200) {\n\t\t\t\t\t\tresolve(req.response) ;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(\"Ajax error:\"+req.statusText) ;\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treq.onerror = ()=> {\n\t\t\t\t\treject(\"Ajax error:\"+req.statusText)\n\t\t\t\t}\n\t\t\t\treq.send() ;\n\t\t\t})\n\t\t}\n\n\t\tstatic loadFont(name,path) {\n\t\t\treturn new Promise((resolve,reject)=>{\n\t\t\t\tif(!document.fonts) {\n\t\t\t\t\tresolve(null)\n\t\t\t\t\treturn \n\t\t\t\t}\n\t\t\t\tlet f = new FontFace(name,`url(${path})`,{})\n\t\t\t\tif(!f) {\n\t\t\t\t\tresolve(null)\n\t\t\t\t\treturn \n\t\t\t\t}\n\t\t\t\tf.load().then((font)=>{\n\t\t\t\t\tdocument.fonts.add(font)\n\t\t\t\t\tresolve(font) \n\t\t\t\t}).catch((err)=> {\n\t\t\t\t\treject(err) \n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t}  //class Json2Canvas\t\n\treturn pox.Json2Canvas = Json2Canvas;\n});"]}