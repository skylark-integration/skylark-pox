{"version":3,"sources":["PoxPlayer.js"],"names":["define","poxp","CanvasMatrix4","GPad","Pointer","PoxCamera","POXPDevice","PoxProfile","WBind","WWG","$","Mat4","Math","PI","PoxPlayer","[object Object]","can","opt","this","version","Promise","HTMLElement","document","querySelector","wwg","initopt","preserveDrawingBuffer","capture","antialias","xrCompatible","noWebGL2","init2","init","needWebGL2","Param","create","param","bindInput","ui","isStereo","autorot","pause","bindHtml","fps","camselect","pixRatio","pox","synth","setpox","eventListener","clearEvent","gPad","name","gPad2","pad","f","log","gp","hand","ev","callEvent","b","p","resize","window","addEventListener","setMouseEvent","checkVR","then","console","vrReady","scenes","cam0","createCamera","cam1","ccam","cb","el","active","frame","push","gpad","vrchange","filter","e","d","resolve","reject","req","XMLHttpRequest","open","responseType","onload","status","response","statusText","onerror","send","path","match","loadImageAjax","img","Image","src","POX","msg","errCb","loadImage","loadAjax","addEvent","exitVR","profile","err","setScene","async","scene","catch","stack","getModule","n","m1","getWorker","w1","loadModule","m","initModule","addModel","model","render","removeModel","getModelData","setModelData","data","matrix","mm","fs_uni","k","vs_uni","undefined","geo","updateModel","vtx","subdata","inst","setSceneData","env","addTex","tex","updateTex","removeTex","loading","style","display","sc","settings","setting","loadModuleSrc","js","mod","btoa","encodeURIComponent","replace","p1","String","fromCharCode","import","module","cancelAnimationFrame","loop","unload","clear","kind","rtime","ret","event","i","length","vrmode","dbtn","closeVR","leftPad","rightPad","primaryPad","secondaryPad","dom","uparam","input","size","type","step","tag","_tohex","v","s","toString","_setdisp","getElementById","innerHTML","map","substr","enum","floor","join","setFunc","set","scale","log10","min","max","get","parseInt","pow","key","value","sset","cam","vshader","text","vs","fshader","fs","r","createRender","isVR","self","bm","mMtx","mvMtx","vpMtx","iMtx","miMtx","setRender","renderStart","setCam","camMode","keyElelment","st","Date","getTime","ctime","ltime","tt","rt","ft","fc","loopf","timestamp","animationFrame","ct","camRY","rp","lp","pp","sp","xi","getInput","p2","emu","conn","setPad","update","camm","getMtx","xrinput","upd","updateTimer","time","sort","a","al","layer","bl","mtx2","models","load","multRight","parent","getParentMtx","group","g","gi","gg","ggi","getModelIdx","modelMtx","uni0","modelMatrix","getAsWebGLFloatArray","vpMatrix","camP","camVP","mvpMatrix","invMatrix","invert","transpose","minvMatrix","uni1","vpMatrix_l","vpMatrix_r","up","stereo","resolution","width","height","camMatirx","camV","eyevec","camX","camY","camZ","modelMtx2","vp","getViewport","viewport","isPresenting","gl","bindFramebuffer","FRAMEBUFFER","webGLLayer","framebuffer","leftViewport","x","y","draw","rightViewport","submitFrame","VRReady","presentVR","body","webkitRequestFullscreen","base","parentNode","ssize","offsetWidth","offsetHeight","webkitFullscreenElement","innerWidth","innerHeight","createElement","setAttribute","position","zIndex","top","left","padding","border","opacity","appendChild","focus","dragging","down","sx","sy","move","ox","oy","dx","dy","ex","ey","out","wheel","gesture","z","gyro","addev","querySelectorAll","forEach","o","target","id","getAttribute","preventDefault","devicePixelRatio","prototype","Camera","canvas","player","alert","setError","DeviceOrientationEvent","requestPermission","or","orientation","scrollTo","enterVR","padl","padr","clearpad","cpad","buttons","pressed","touched","axes","mover","tpad","tstart","mdown","mup","tend","query","location","search","split","random","shift","localStorage","getItem","JSON","parse","q","modules","workers","bb","Blob","Worker","URL","createObjectURL","title","copyright","gui","setParam","setsrc","renders","emsg"],"mappings":"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","file":"../PoxPlayer.js","sourcesContent":["define([\n\t\"./poxp\",\n\t\"./CanvasMatrix4\",\n\t\"./GPad\",\n\t\"./Pointer\",\n\t\"./PoxCamera\",\n\t\"./POXPDevice\",\n\t\"./PoxProfile\",\n\t\"./WBind\",\n\t\"./WWG\"\n],function(poxp,CanvasMatrix4,GPad,Pointer,PoxCamera,POXPDevice,PoxProfile,WBind,WWG){\n\t//poxplayer.js\n\t//  PolygonExplorer Player\n\t//   wakufactory.jp\n\t\"use strict\" ;\n\n\tvar $ = poxp.$;\n\n\tconst Mat4 = CanvasMatrix4 // alias\n\tconst RAD = Math.PI/180 ;\n\tclass PoxPlayer {\n\t\tconstructor(can,opt) {\n\t\t\tthis.version = \"3.0.0\" \n\t\t\tif(!Promise) {\n\t\t\t\tthrow \"This browser is not supported!!\"\t\n\t\t\t}\n\t\t\tif(!opt) opt = {} \n\t\t\tthis.can = (can instanceof HTMLElement)?can:document.querySelector(can)  ;\n\n\t\t\t// wwg initialize\n\t\t\tconst wwg = new WWG() ;\n\t\t\tconst initopt = {preserveDrawingBuffer: opt.capture,antialias:true, xrCompatible: true }\n\t\t\tconst useWebGL2 = !opt.noWebGL2\n\t\t\tif(!(useWebGL2 && wwg.init2(this.can,initopt)) && !wwg.init(this.can,initopt)) {\n\t\t\t\tthrow \"wgl not supported!\"\n\t\t\t}\n\t\t\tif(opt.needWebGL2 && wwg.version!=2) {\n\t\t\t\tthrow \"needs wgl2\"\n\t\t\t}\n\t\t\tthis.wwg = wwg ;\n\t\t//\tif(window.WAS!=undefined) this.synth = new WAS.synth() \n\t\t\t\n\t\t\tconst Param = WBind.create() ;\n\t\t\tthis.param = Param ;\n\t\t\tParam.bindInput(\"isStereo\",(opt.ui && opt.ui.isStereo)?opt.ui.isStereo:\"#isstereo\") ;\n\t\t\tParam.bindInput(\"autorot\",(opt.ui && opt.ui.autorot)?opt.ui.autorot:\"#autorot\") ;\n\t\t\tParam.bindInput(\"pause\",(opt.ui && opt.ui.pause)?opt.ui.pause:\"#pause\") ;\n\t\t\tParam.bindHtml(\"fps\",(opt.ui && opt.ui.fps)?opt.ui.fps:\"#fps\") ;\n\t\t\tParam.bindInput(\"camselect\",(opt.ui && opt.ui.camselect)?opt.ui.camselect:\"#camselect\") ;\n\t\t\t\n\t\t\tthis.pixRatio = 1 \n\t\t\tthis.pox = {can:this.can,wwg:this.wwg,synth:this.synth,poxp:this}\n\t\t\tthis.setpox(this.pox)\n\t\t\tthis.eventListener = {}\n\t\t\tthis.clearEvent() \n\n\t\t\tif(GPad) {\n\t\t\t\tthis.pox.gPad = new GPad()\n\t\t\t\tthis.pox.gPad.name = \"1\"\n\t\t\t\tthis.pox.gPad2 = new GPad()\n\t\t\t\tthis.pox.gPad2.name = \"2\"\n\t\t\t\tif(!this.pox.gPad.init(0,(pad,f)=>{\n\t\t\t\t\tif(f) {\n\t\t\t\t\t\tthis.pox.log(\"set 1\"+pad.gp.hand)\n\t\t\t\t\t}\n\t\t\t\t}))\n\t\t\t\tif(!this.pox.gPad2.init(1,(pad,f)=>{\n\t\t\t\t\tif(f) {\n\t\t\t\t\t\tthis.pox.log(\"set 2\"+pad.gp.hand)\n\t\t\t\t\t}\n\t\t\t\t}))\n\t\t//\t\tconsole.log(this.pox.gPad)\n\t\t\t\tthis.pox.gPad.ev = (pad)=> {\n\t\t\t\t\tthis.callEvent(\"gpad\",pad) ;\n\t\t\t\t}\n\t\t\t\tthis.pox.gPad2.ev = (pad,b,p)=> {\n\t\t\t\t\tthis.callEvent(\"gpad\",pad) ;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// canvas initialize\n\t\t\tthis.resize() ;\n\t\t\twindow.addEventListener(\"resize\",()=>{this.resize()}) ;\n\t\t\tthis.pause = true ;\n\n\t\t\tthis.setMouseEvent() ;\n\t\t\t// VR init \n\t\t\tPOXPDevice.checkVR(this).then(f=>{\n\t\t\t\tif(f) console.log(\"WebXR supported\")\n\t\t\t\tthis.vrReady = f \n\t\t\t})\n\t\t\tthis.scenes = []\n\t\t\t\n\t\t\t//create default camera\n\t\t\tthis.cam0 = this.createCamera()\n\t\t\tthis.cam1 = this.createCamera() ;\n\t\t\tthis.ccam = this.cam1 \n\t\t}\n\n\t\t//event handling\n\t\taddEvent(ev,cb) {\n\t\t\tlet el = null\n\t\t\tswitch(ev) {\n\t\t\t\tcase \"frame\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.frame.push(el)\n\t\t\t\t\tbreak \n\t\t\t\tcase \"gpad\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.gpad.push(el)\n\t\t\t\t\tbreak \n\t\t\t\tcase \"vrchange\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.vrchange.push(el)\n\t\t\t\t\tbreak \n\t\t\t\tcase \"param\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.param.push(el)\n\t\t\t\t\tbreak \n\t\t\t}\n\t\t\treturn el\n\t\t}\n\t\tremoveEvent (ev) {\n\t\t\tthis.eventListener.frame = this.eventListener.frame.filter((e)=>(e!==ev))\n\t\t\tthis.eventListener.gpad = this.eventListener.gpad.filter((e)=>(e!==ev))\n\t\t\tthis.eventListener.vrchange = this.eventListener.vrchange.filter((e)=>(e!==ev))\n\t\t\tthis.eventListener.param = this.eventListener.param.filter((e)=>(e!==ev))\n\t\t}\n\t\tclearEvent() {\n\t\t\tthis.eventListener.frame = []\n\t\t\tthis.eventListener.gpad = []\n\t\t\tthis.eventListener.vrchange = []\n\t\t\tthis.eventListener.param = []\n\t\t}\n\n\t\t// load soure jsonfile\n\t\tasync load(d) {\n\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\tif(typeof d == \"string\") {\n\t\t\t\t\tconst req = new XMLHttpRequest();\n\t\t\t\t\treq.open(\"get\",d,true) ;\n\t\t\t\t\treq.responseType = \"json\" ;\n\t\t\t\t\treq.onload = () => {\n\t\t\t\t\t\tif(req.status==200) {\n\t\t//\t\t\t\t\tconsole.log(req.response) ;\n\t\t\t\t\t\t\tresolve(req.response) ;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(\"Ajax error:\"+req.statusText) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treq.onerror = ()=> {\n\t\t\t\t\t\treject(\"Ajax error:\"+req.statusText)\n\t\t\t\t\t}\n\t\t\t\t\treq.send() ;\n\t\t\t\t} else resolve(d) ;\n\t\t\t})\n\t\t}\n\n\t\tloadImage(path) {\n\t\t\tif(path.match(/^https?:/)) {\n\t\t\t\treturn this.wwg.loadImageAjax(path)\n\t\t\t}else {\n\t\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\t\tconst img = new Image() ;\n\t\t\t\t\timg.onload = ()=> {\n\t\t\t\t\t\tresolve( img ) ;\n\t\t\t\t\t}\n\t\t\t\t\timg.onerror = ()=> {\n\t\t\t\t\t\treject(\"cannot load image\") ;\n\t\t\t\t\t}\n\t\t\t\t\timg.src = path ;\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tsetpox(POX) {\n\t\t\tPOX.log = (msg)=> {\n\t\t\t\tif(this.errCb) this.errCb(msg) ;\n\t\t\t}\n\t\t\tPOX.loadImage = this.loadImage \n\t\t\tPOX.loadAjax = this.wwg.loadAjax\n\t\t\tPOX.addEvent = (e,f) => this.addEvent(e,f)\n\t\t\tPOX.exitVR = this.exitVR \n\t\t\ttry {\n\t\t\t\tPOX.profile = new PoxProfile(this)\n\t\t\t} catch(err) {POX.profile=null }\n\t\t\t\n\t\t\tPOX.setScene = async (scene)=> {\n\t\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\t\tthis.setScene(scene).then( () => {\n\t\t\t\t\t\tresolve() ;\n\t\t\t\t\t}).catch((err)=>\t {\n\t\t\t\t\t\tconsole.log(\"render err\"+err.stack)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t\tPOX.getModule = (n)=>this.m1\n\t\t\tPOX.getWorker = (n)=>this.w1\n\t\t\tPOX.loadModule = (m)=>this.loadModule(m) \n\t\t\tPOX.initModule = (m)=>this.initModule(m) \n\n\t\t\tPOX.addModel = (model)=>{ if(this.render) return this.render.addModel(model) }\n\t\t\tPOX.removeModel = (model)=>{ if(this.render) return this.render.removeModel(model) }\n\t\t\tPOX.getModelData = (model)=>{ if(this.render) return this.render.getModelData(model) }\n\t\t\tPOX.setModelData = (model,data)=>{\n\t\t\t\tconst m = this.render.getModelData(model)\n\t\t\t\tif(data.matrix) m.mm = data.matrix\n\t\t\t\tif(data.fs_uni) {\n\t\t\t\t\tfor(let k in data.fs_uni) m.fs_uni[k] = data.fs_uni[k]  \n\t\t\t\t}\n\t\t\t\tif(data.vs_uni) {\n\t\t\t\t\tfor(let k in data.vs_uni) m.vs_uni[k] = data.vs_uni[k]  \n\t\t\t\t}\n\t\t\t\tfor(let k of [\"hide\",\"parent\",\"blend\",\"cull\"]) if(data[k]!==undefined) m[k] = data[k] \n\t\t\t\tif(data.geo) {\n\t\t\t\t\tthis.render.updateModel(model,\"vbo\",data.geo.vtx,data.geo.subdata)\n\t\t\t\t}\n\t\t\t\tif(data.inst) {\n\t\t\t\t\tthis.render.updateModel(model,\"inst\",data.inst.data,data.inst.subdata)\t\t\n\t\t\t\t}\n\t\t\t}\n\t\t\tPOX.setSceneData = (data) =>{\n\t\t\t\tif(data.fs_uni) {\n\t\t\t\t\tfor(let k in data.fs_uni) this.render.data.fs_uni[k] = data.fs_uni[k]  \n\t\t\t\t}\n\t\t\t\tif(data.vs_uni) {\n\t\t\t\t\tfor(let k in data.vs_uni) this.render.data.vs_uni[k] = data.vs_uni[k]  \n\t\t\t\t}\n\t\t\t\tif(data.env) {\n\t\t\t\t\tfor(let k in data.env) this.render.data.env[k] = data.env[k]  \n\t\t\t\t}\t\t\n\t\t\t}\n\t\t\tPOX.addTex = (tex)=>this.render.addTex(tex)\n\t\t\tPOX.updateTex = (tex,data)=>this.render.updateTex(tex,data)\n\t\t\tPOX.removeTex = (tex)=>this.render.removeTex(tex)\n\t\t\tPOX.loading = (f)=>{\n\t\t\t\tif($('loading')) $('loading').style.display = f?\"block\":\"none\"\n\t\t\t}\n\t\t}\n\t\tasync loadScene(scene) {\n\n\t\t\t\n\t\t}\n\t\t//set js soure and init \n\t\tasync setsrc(sc,settings) {\n\t\t\tthis.pox.src = sc \n\t\t\tthis.pox.setting = settings \n\t\t\tthis.loadModuleSrc(sc.js).then(mod=>{\n\t\t\t\tthis.initModule(mod)\n\t\t\t})\n\t\t}\n\n\t\t// load module from string source\n\t\tloadModuleSrc(src,param) {\n\t\t\tfunction b64EncodeUnicode(str) {\n\t\t\t    return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,\n\t\t\t        function toSolidBytes(match, p1) {\n\t\t\t            return String.fromCharCode('0x' + p1);\n\t\t\t    }));\n\t\t\t}\n\t\t\treturn this.loadModule(\"data:text/javascript;base64,\" \n\t\t\t\t+ b64EncodeUnicode(src),param)\n\t\t}\n\t\t// load module from path\n\t\tasync loadModule(path,param) {\n\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\timport(path).then((module)=> {\n\t\t\t\t\tresolve(module)\n\t\t\t\t}).catch((err)=>{\n\t\t\t\t\tthis.pox.log(\"module \"+err.stack )\n\t\t\t\t\treject([\"module\",err.stack])\n\t\t\t\t})\n\t\t\t})\t\n\t\t}\n\t\tinitModule(module) {\n\t\t\treturn new Promise(async (resolve,reject) => {\n\t\t\t\t\tif(module.init) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tawait module.init(this.pox)\n\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\tthis.pox.log(\"init \"+err.stack)\n\t\t\t\t\t\t\treject([\"init\",err.stack])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(module.frame) {\n\t\t\t\t\t\tthis.addEvent(\"frame\",module.frame )\n\t\t\t\t\t} \n\t\t\t\t\tresolve(module)\n\t\t\t})\t\n\t\t}\n\n\t\tstop() {\n\t\t\twindow.cancelAnimationFrame(this.loop) ; \n\t\t\tif(this.pox.unload) this.pox.unload() ;\n\t\t}\n\t\tcls() {\n\t\t\tif(this.render) this.render.clear() ;\n\t\t}\n\t\tsetError(err) {\n\t\t\tthis.errCb = err ;\n\t\t}\n\t\tcallEvent(kind,ev,opt) {\n\t\t\tif(typeof ev == \"object\") ev.rtime = this.rtime\n\t\t\tlet ret = true \n\t\t\tif(this.pox.event) {\n\t\t\t\ttry {\n\t\t\t\t\tret = this.pox.event(kind,ev,opt)\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.errCb(err.stack)\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(kind==\"vrchange\") {\n\t\t\t\tthis.cam1.vrchange(ev)\n\t\t\t\tfor(let i=0;i<this.eventListener.vrchange.length;i++) {\t//attached event\n\t\t\t\t\tconst f = this.eventListener.vrchange[i]\n\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\tf.cb({vrmode:ev})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(kind==\"gpad\") {\n\t\t\t\tif(ev.dbtn[5]==-1) POXPDevice.closeVR()\n\t\t\t\tfor(let i=0;i<this.eventListener.gpad.length;i++) {\t//attached event\n\t\t\t\t\tconst f = this.eventListener.gpad[i]\n\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\tlet p = {gpad:ev}\n\t\t\t\t\t\tif(ev.hand==\"left\") p.leftPad = ev\n\t\t\t\t\t\tif(ev.hand==\"right\") p.rightPad = ev\n\t\t\t\t\t\tif(this.pox.setting.primaryPad == ev.hand) p.primaryPad = ev\n\t\t\t\t\t\telse p.secondaryPad = ev \n\t\t\t\t\t\tf.cb(p)\n\t\t\t\t\t}\n\t\t\t\t}\t\t\n\t\t\t}\n\t\t\tif(kind==\"param\") {\n\t\t\t\tfor(let i=0;i<this.eventListener.param.length;i++) {\t//attached event\n\t\t\t\t\tconst f = this.eventListener.param[i]\n\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\tf.cb(ev)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn ret \n\t\t}\n\t\tsetParam(param,dom) {\n\t\t\tif(param===undefined) return ;\n\t\t\tthis.uparam = WBind.create()\n\t\t\tconst input = [] ;\n\t\t\tfor(let i in param) {\n\t\t\t\tconst p = param[i] ;\n\t\t\t\tconst name = (p.name)?p.name:i ;\n\t\t\t\tlet size = \"\"\n\t\t\t\tif(!p.type) p.type = \"range\" \n\t\t\t\tif(!p.step) p.step = 100 ;\n\t\t\t\tif(p.size) size = \"size=\"+p.size\n\t\t\t\tlet tag = `<div class=b><div class=t>${name}</div> <input type=${p.type} id=\"_p_${i}\" ${size} min=0 max=${p.step} style=\"${(p.type==\"disp\")?\"display:none\":\"\"}\"  /><div class=v id=${\"_p_d_\"+i}></div></div>`\n\t\t\t\tinput.push(tag)\n\t\t\t}\n\t\t\tdom.innerHTML = input.join(\"\") \n\t\t\tfunction _tohex(v) {\n\t\t\t\tlet s = (v*255).toString(16) ;\n\t\t\t\tif(s.length==1) s = \"0\"+s ;\n\t\t\t\treturn s ;\n\t\t\t}\n\t\t\tfunction _setdisp(i,v) {\n\t\t\t\tif(v===undefined || param[i].type==\"file\"|| param[i].type==\"text\"|| param[i].type==\"button\") return \n\t\t\t\tif(param[i].type==\"color\" && v ) {\n\t\t\t\t\tdocument.getElementById('_p_d_'+i).innerHTML = v.map((v)=>v.toString().substr(0,5)) ;\n\t\t\t\t} else if(param[i].type==\"range\")  {\n\t\t\t\t\tif(param[i].enum) {\n\t\t\t\t\t\tdocument.getElementById('_p_d_'+i).innerHTML = param[i].enum[Math.floor(v)]\n\t\t\t\t\t} else document.getElementById('_p_d_'+i).innerHTML = v.toString().substr(0,5) ;\t\n\t\t\t\t} else document.getElementById('_p_d_'+i).innerHTML = v\n\t\t\t}\n\t\t\tfor(let i in param) {\n\t\t\t\tlet p = param[i]\n\t\t\t\tthis.uparam.bindInput(i,\"#_p_\"+i)\n\t\t\t\tthis.uparam.setFunc(i,{\n\t\t\t\t\tset:(v)=> {\n\t\t\t\t\t\tlet ret = v ;\n\t\t\t\t\t\tif(p.type==\"color\") {\n\t\t\t\t\t\t\tret = \"#\"+_tohex(v[0])+_tohex(v[1])+_tohex(v[2])\n\t\t\t\t\t\t} else if(p.type==\"range\") {\n\t\t\t\t\t\t\tif(p.scale==\"log10\") ret = Math.log10(v/p.min)/Math.log10(p.max/p.min)*p.step\n\t\t\t\t\t\t\telse ret = (v - p.min)*(p.step)/(p.max - p.min)\n\t\t\t\t\t\t}\n\t\t//\t\t\t\tconsole.log(ret)\n\t\t\t\t\t\t_setdisp(i,ret)\n\t\t\t\t\t\treturn ret \t\n\t\t\t\t\t},\n\t\t\t\t\tget:(v)=> {\n\t\t\t\t\t\tlet ret = v ;\n\t\t\t\t\t\tif(p.type==\"color\" ) {\n\t\t\t\t\t\t\tif(typeof v ==\"string\" && v.match(/#[0-9A-F]+/i)) {\n\t\t\t\t\t\t\t\tret =[parseInt(v.substr(1,2),16)/255,parseInt(v.substr(3,2),16)/255,parseInt(v.substr(5,2),16)/255] ;\n\t\t\t\t\t\t\t} else ret = v ;\n\t\t\t\t\t\t} else if(p.type==\"range\" ) {\n\t\t\t\t\t\t\tif(p.scale==\"log10\") ret = Math.pow(10,Math.log10(p.min)+Math.log10(p.max/p.min)*v/p.step)\n\t\t\t\t\t\t\telse ret = v*(p.max-p.min)/(p.step)+p.min \n\t\t\t\t\t\t}\t\t\n\t\t\t\t\t\treturn ret ;\n\t\t\t\t\t},\n\t\t\t\t\tinput:(v)=>{\n\t\t\t\t\t\t_setdisp(i,this.uparam[i])\n\t\t//\t\t\t\tthis.keyElelment.focus()\n\t\t\t\t\t\tthis.callEvent(\"param\",{key:i,value:v})\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.uparam[i] = p.value ;\n\t\t\t}\n\t\t\tthis.pox.param = this.uparam ;\n\t\t}\n\n\n\t\tsetScene(sc) {\n\t\t\tconst wwg = this.wwg ;\n\t\t\tconst pox = this.pox ;\n\t\t\tconst can = this.can ;\n\n\t\t\tconst pixRatio = this.pixRatio\n\t\t\tconst Param = this.param ;\n\t\t\tconst sset = pox.setting || {} ;\n\t\t\tif(!sset.scale) sset.scale = 1.0 ;\n\t\t\tif(!sset.primaryPad) sset.primaryPad = \"right\";\n\t\t\t\n\t\t\tif(sc.cam) pox.setting.cam = sc.cam\n\t\t\tif(sc.param) pox.param = sc.param\n\t\t\tsc.vshader = {text:pox.src.vs} ;\n\t\t\tsc.fshader = {text:pox.src.fs} ;\n\t\t\tpox.scene = sc ;\n\n\t\t\t//create render unit\n\t\t\tconst r = wwg.createRender() ;\n\t\t\tthis.render = r ;\n\t\t\tpox.render = r ;\n\n\t\t\tlet ccam = this.ccam\n\t\t\t\n\t\t\tthis.isVR = false \n\t\t\tconst self = this \n\t\t\tconst bm = new CanvasMatrix4()\n\t\t\tconst mMtx = []\n\t\t\tconst vMtx = []\n\t\t\tconst mvMtx = []\n\t\t\tconst vpMtx = []\n\t\t\tconst iMtx = []\n\t\t\tconst miMtx = []\t\n\t\t\treturn new Promise((resolve,reject) => {\n\t\t\tr.setRender(sc).then(()=> {\t\n\t\t\t\tif(this.errCb) this.errCb(\"scene set ok\") ;\n\t\t\t\tif(this.renderStart) this.renderStart() ;\n\n\t\t\t\tif(pox.setting && pox.setting.pixRatio) { \n\t\t\t\t\tthis.pixRatio = pox.setting.pixRatio ;\n\t\t\t\t} else {\n\t\t\t\t\tthis.pixRatio = 1 ;\n\t\t\t\t}\n\t\t\t\tthis.resize();\n\t\t\t\t\n\t\t\t\tif(pox.setting.cam) {\n\t\t\t\t\tthis.cam0.setCam(pox.setting.cam)\n\t\t\t\t\tthis.cam0.setCam({camMode:\"bird\"})\n\t\t\t\t\tthis.cam1.setCam(pox.setting.cam)\n\t\t\t\t}\n\t\t//\t\tif(ccam.cam.camMode==\"walk\") this.keyElelment.focus() ;\n\t\t\t\tthis.keyElelment.value = \"\" ;\n\t\t\t\tthis.clearEvent()\n\t\t\t\t\n\t\t\t\tresolve()\n\t\t\t\t//draw loop\n\t\t\t\tlet st = new Date().getTime() ;\n\t\t\t\tthis.ctime = st \n\t\t\t\tthis.ltime = st \n\t\t\t\tlet tt = 0 ;\n\t\t\t\tlet rt = 0 ;\n\t\t\t\tlet ft = st ;\n\t\t\t\tlet fc = 0 ;\n\t\t\t\tlet gpad \n\t\t\t\tconst loopf = (timestamp,frame) => {\n\t\t//\t\t\tconsole.log(\"************loop\")\n\t\t\t\t\tPOXPDevice.animationFrame(this,loopf,frame)\n\n\t\t\t\t\tconst ct = new Date().getTime() ;\n\t\t\t\t\tthis.ctime = ct \n\t\t\t\t\tif(Param.pause) {\n\t\t\t\t\t\tParam.fps=0;\n\t\t\t\t\t\ttt = rt ;\n\t\t\t\t\t\tst = ct ;\n\t\t\t\t\t\treturn ;\n\t\t\t\t\t}\n\t\t\t\t\trt = tt + ct-st ;\n\t\t\t\t\tfc++ ;\n\t\t\t\t\tif(ct-ft>=500) {\n\t\t//\t\t\t\tif(this.isVR) console.log(fc)\n\t\t\t\t\t\tParam.fps = Math.floor(fc*1000/(ct-ft)+0.5) ;\n\t\t\t\t\t\tfc = 0 ;\n\t\t\t\t\t\tft = ct ; \n\t\t\t\t\t}\n\t\t\t\t\tthis.ccam = (Param.camselect && !this.isVR)?this.cam0:this.cam1\n\t\t\t\t\tccam = this.ccam \n\t\t\t\t\tpox.cam = ccam.cam ;\n\n\t\t\t\t\tif(Param.autorot) ccam.setCam({camRY:(rt/100)%360}) ;\n\t\t\t\t\tlet rp=null,lp=null,pp=null,sp=null\n\t\t\t\t\tconst xi = POXPDevice.getInput() \n\t\t\t\t\tif(0) {\n\t\t\t\t\t\t//rp = xi.gamepad?.right?.gamepad\n\t\t\t\t\t\trp = xi.gamepad && xi.gamepad.right && xi.gamepad.right.gamepad; // modified by lwf\n\n\t\t\t\t\t\t//lp= xi.gamepad?.left?.gamepad\n\t\t\t\t\t\tlp= xi.gamepad && xi.gamepad.left && xi.gamepad.left.gamepad;\n\t\t\t\t\t} else if(pox.gPad) {\n\t\t\t\t\t\tlet p1 = pox.gPad.get()\n\t\t\t\t\t\tlet p2 = pox.gPad2.get() \n\t\t\t\t\t\tif(this.isVR) {\n\t\t\t\t\t\t\tif(!p1.emu && p1.hand == \"right\") rp = p1 ;\n\t\t\t\t\t\t\tif(!p1.emu && p1.hand == \"left\") lp = p1 ;\n\t\t\t\t\t\t\tif(!p2.emu && p2.hand == \"right\") rp = p2 ;\n\t\t\t\t\t\t\tif(!p2.emu && p2.hand == \"left\") lp = p2 \n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(p1.hand == \"right\" ) rp = p1\n\t\t\t\t\t\t\tif(p2.hand == \"right\" ) rp = p2\t\t\t\t\n\t\t\t\t\t\t\tif(p1.hand == \"left\" ) lp = p1\n\t\t\t\t\t\t\tif(p2.hand == \"left\" ) lp = p2\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(sset.primaryPad==\"left\") pp = lp,sp = rp\n\t\t\t\t\telse pp=rp,sp=lp\n\t\t\t\t\tif(!pp || !pp.conn) pp = sp, sp = null \n\t\t//\t\t\t\tconsole.log(pp)\n\t\t//\t\t\t\tconsole.log(sp)\n\t\t\t\t\tif(ccam.cam.gPad) ccam.setPad(pp,sp)\n\n\t\t\t\t\tccam.update()\t// camera update\n\t\t\t\t\tlet camm = ccam.getMtx(sset.scale,(Param.isStereo || self.isVR)?1:0) ;\n\t\t\t\t\t\n\t\t\t\t\tfor(let i=0;i<this.eventListener.frame.length;i++) {\t//attached event\n\t\t\t\t\t\tconst f = this.eventListener.frame[i]\n\t\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tf.cb({render:r,pox:pox,ccam:ccam,cam:ccam.cam,rtime:rt/1000,\n\t\t\t\t\t\t\t\txrinput:xi,\n\t\t\t\t\t\t\t\trightPad:rp,leftPad:lp,\n\t\t\t\t\t\t\t\tprimaryPad:pp,secondaryPad:sp})\n\t\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\t\tthis.pox.log(err.stack)\n\t\t\t\t\t\t\t\tParam.pause = true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet upd = {}\n\t\t\t\t\tif(pox.update)  upd = pox.update(r,ccam.cam,rt,-1)\n\t\t\t\t\tParam.updateTimer() ;\n\t\t\t\t\tupdate(r,pox,camm,rt,upd) ; // scene update \n\t\t\t\t\tPOXPDevice.submitFrame(this)\n\t\t\t\t\tthis.ltime = ct \n\t\t\t\t\tthis.rtime = rt\n\t\t\t\t}\n\t\t\t\tloopf() ;\t\t\n\t\t\t}).catch((err)=>{\n\t\t\t\tconsole.log(err) ;\n\t\t\t\tif(this.errCb) this.errCb(err.stack?err.stack:err) ;\n\t\t\t\treject(err) \n\t\t\t})\n\t\t\t}) // promise\n\t\t\t\n\t\t\tfunction getParentMtx(render,parent) {\n\t\t\t\tlet p = render.getModelData(parent) \n\t\t\t\tif(!p) return new Mat4() \n\t\t\t\tlet mm = new Mat4(p.bm)\n\t\t\t\tif(!mm) mm = new Mat4() \n\t\t\t\tif(p.mm) mm.multRight(p.mm)\n\t\t\t\tif(p.parent!==undefined) {\n\t\t\t\t\tmm.multRight( getParentMtx(render,p.parent)) \n\t\t\t\t} \n\t\t\t\treturn mm \n\t\t\t}\n\t\t\t// calc model matrix\n\t\t\tfunction modelMtx2(render,camm) {\n\n\t\t\t\t// calc each mvp matrix and invert matrix\n\t\t\t\tconst mod = [[],[]] ;\t\n\t\t\t\tconst models = render.data.model \t\n\t\t\t\tfor(let i=0;i<models.length;i++) {\n\t\t\t\t\tlet d = models[i] ;\n\t\t\t\t\tif(!d) continue \n\t\t\t\t\tbm.load(d.bm)\n\t\t\t\t\tif(d.mm) bm.multRight(d.mm) ;\n\t\t\t\t\tif(d.parent!==undefined) {\n\t\t\t\t\t\tbm.multRight( getParentMtx(render,d.parent ))\n\t\t\t\t\t}\n\t\t\t\t\tif(render.data.group) {\n\t\t\t\t\t\tlet g = render.data.group ;\n\t\t\t\t\t\tfor(let gi = 0 ;gi < g.length;gi++) {\n\t\t\t\t\t\t\tlet gg = g[gi] ;\n\t\t\t\t\t\t\tif(!gg.bm) continue ;\n\t\t\t\t\t\t\tfor(let ggi=0;ggi<gg.model.length;ggi++) {\n\t\t\t\t\t\t\t\tif(render.getModelIdx(gg.model[ggi])==i) bm.multRight(gg.bm) ;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(!mMtx[i]) mMtx[i] = new CanvasMatrix4()\n\t\t\t\t\tif(!iMtx[i]) iMtx[i] = new CanvasMatrix4()\n\t\t\t\t\tif(!miMtx[i]) miMtx[i] = new CanvasMatrix4()\n\t\t\t\t\tif(!mvMtx[i]) mvMtx[i] = [new CanvasMatrix4(),new CanvasMatrix4()]\t\t\t\n\t\t\t\t\tif(!vpMtx[i]) vpMtx[i] = [new CanvasMatrix4(),new CanvasMatrix4()]\t\t\t\n\t\t\t\t\td.modelMtx = mMtx[i]\n\t\t\t\t\tconst uni0 = {\n\t\t\t\t\t\tvs_uni:{\n\t\t\t\t\t\t\tmodelMatrix:mMtx[i].load(bm).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tvpMatrix:vpMtx[i][0].load((d.camFix)?camm[0].camP:camm[0].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tmvpMatrix:mvMtx[i][0].load(bm).multRight( (d.camFix)?camm[0].camP:camm[0].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tinvMatrix:iMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().transpose().getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tminvMatrix:miMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().getAsWebGLFloatArray()}\n\t\t\t\t\t}\n\t\t\t\t\tconst uni1 = {\n\t\t\t\t\t\tvs_uni:{\n\t\t\t\t\t\t\tmodelMatrix:mMtx[i].load(bm).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tvpMatrix:vpMtx[i][1].load((d.camFix)?camm[1].camP:camm[1].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tmvpMatrix:mvMtx[i][1].load(bm).multRight( (d.camFix)?camm[1].camP:camm[1].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tinvMatrix:iMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().transpose().getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tminvMatrix:miMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().getAsWebGLFloatArray()}\n\t\t\t\t\t}\n\t\t\t\t\tuni0.fs_uni = uni0.vs_uni\n\t\t\t\t\tuni1.fs_uni = uni1.vs_uni\n\t\t\t\t\tuni0.fs_uni.vpMatrix_l = uni0.fs_uni.vpMatrix \n\t\t\t\t\tuni0.fs_uni.vpMatrix_r = uni1.fs_uni.vpMatrix \n\t\t\t\t\tuni1.fs_uni.vpMatrix_l = uni0.fs_uni.vpMatrix \n\t\t\t\t\tuni1.fs_uni.vpMatrix_r = uni1.fs_uni.vpMatrix \t\t\t\n\t\t\t\t\tmod[0][i] = uni0 \n\t\t\t\t\tmod[1][i] = uni1 \n\t\t\t\t\t\n\t\t\t\t\td.modelMtx = mMtx[i]\n\t\t\t\t}\n\t\t\t\tlet up = [{model:mod[0],fs_uni:{},vs_uni:{}},\n\t\t\t\t\t{model:mod[1],fs_uni:{},vs_uni:{}}]\n\n\t\t\t\tup[0].fs_uni.stereo = 1 ;\n\t\t\t\tup[0].fs_uni.resolution = [can.width,can.height]\n\t\t\t\tup[0].fs_uni.camMatirx = camm[0].camV.getAsWebGLFloatArray()\n\t\t\t\tup[0].fs_uni.eyevec = [camm[0].camX,camm[0].camY,camm[0].camZ]\n\t\t\t\tup[0].vs_uni.stereo = 1 ;\n\t\t\t\tup[0].vs_uni.camMatirx = up[0].fs_uni.camMatirx\n\t\t\t\tup[0].vs_uni.eyevec = up[0].fs_uni.eyevec \n\t\t\t\n\t\t\t\tup[1].fs_uni.stereo = 2  ;\n\t\t\t\tup[1].fs_uni.resolution = up[0].fs_uni.resolution\n\t\t\t\tup[1].fs_uni.camMatirx = camm[1].camV.getAsWebGLFloatArray()\n\t\t\t\tup[1].fs_uni.eyevec = [camm[1].camX,camm[1].camY,camm[1].camZ]\n\t\t\t\tup[1].vs_uni.stereo = 2  ;\t\n\t\t\t\tup[1].vs_uni.camMatirx = up[1].fs_uni.camMatirx\n\t\t\t\tup[1].vs_uni.eyevec = up[1].fs_uni.eyevec \t\n\t\t\t\treturn up ;\t\t\n\t\t\t}\n\t\t\t// update scene\n\n\t\t\tfunction update(render,pox,camm,time,update) {\n\t\t\t\t// draw call \n\n\t\t\t\trender.data.model.sort((a,b)=>{\n\t\t\t\t\tif(a===null) return -1\n\t\t\t\t\tif(b===null) return 1\n\t\t\t\t\tlet al = a.layer, bl = b.layer \n\t\t\t\t\tif(al===undefined) al = 0 \n\t\t\t\t\tif(bl===undefined) bl = 0 \n\t\t\t\t\treturn al- bl  \n\t\t\t\t}) \n\t\t\t\tlet mtx2 = modelMtx2(render,camm) ;\n\t\t\t\tif(Param.isStereo || self.isVR) {\n\t\t\t\t\tlet vp = POXPDevice.getViewport(can)\n\t\t\t\t\trender.viewport = vp \n\t\t\t\t\tif(POXPDevice.isPresenting) {\n\t\t//\t\t\t\tconsole.log(\"fbs\")\n\t\t\t\t\t\trender.gl.bindFramebuffer(render.gl.FRAMEBUFFER, \n\t\t\t\t\t\t\tPOXPDevice.webGLLayer.framebuffer)\n\t\t\t\t\t}\n\t\t\t\n\t\t\t\t\tif(update.vs_uni===undefined) update.vs_uni = {} ;\n\t\t\t\t\tif(update.fs_uni===undefined) update.fs_uni = {} ;\n\t\t\t\t\tupdate.fs_uni.rtime = time/1000 ;\n\t\t\t\t\tupdate.fs_uni.time = update.fs_uni.rtime\n\t\t\t\t\tupdate.vs_uni.rtime = time/1000 ;\t\t\n\t\t\t\t\tupdate.vs_uni.time = update.vs_uni.rtime\n\t\t\t\t\trender.gl.viewport(vp.leftViewport.x,vp.leftViewport.y, vp.leftViewport.width,vp.leftViewport.height) ;\n\t\t\t\t\trender.draw([update,mtx2[0]],false) ;\n\t\t\t\t\trender.gl.viewport(vp.rightViewport.x,vp.rightViewport.y, vp.rightViewport.width,vp.rightViewport.height) ;\n\t\t\t\t\trender.draw([update,mtx2[1]],true) ;\n\t\t\t\t\tif(POXPDevice.isPresenting) {\n\t\t//\t\t\t\tconsole.log(\"fbe\")\n\t\t\t\t\t\trender.gl.bindFramebuffer(render.gl.FRAMEBUFFER,null)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif(update.vs_uni===undefined) update.vs_uni = {} ;\n\t\t\t\t\tif(update.fs_uni===undefined) update.fs_uni = {} ;\n\t\t\t\t\tmtx2[0].vs_uni.stereo = 0 ;\n\t\t\t\t\tupdate.fs_uni.rtime = time/1000 ;\n\t\t\t\t\tupdate.fs_uni.time = update.fs_uni.rtime\n\t\t\t\t\tupdate.vs_uni.rtime = time/1000 ;\t\n\t\t\t\t\tupdate.vs_uni.time = update.vs_uni.rtime\n\t\t\t\t\trender.gl.viewport(0,0,can.width,can.height) ;\n\t\t\t\t\trender.draw([update,mtx2[0]],false) ;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t//----------------------------------\n\t\t//device dependent\n\t\tenterVR() {\n\t\t\tlet ret = true\n\t\t\tif(POXPDevice.VRReady) {\n\t\t\t\tconsole.log(\"enter VR\")\n\t\t\t\tPOXPDevice.presentVR(this)\n\t\t\t} else if(document.body.webkitRequestFullscreen) {\n\t\t\t\tconsole.log(\"fullscreen\")\n\t\t\t\tconst base = this.can.parentNode\n\t\t\t\tthis.ssize = {width:base.offsetWidth,height:base.offsetHeight}\n\t\t\t\tdocument.addEventListener(\"webkitfullscreenchange\",(ev)=>{\n\t\t\t\t\tif( document.webkitFullscreenElement) {\n\t\t\t\t\t\tbase.style.width = window.innerWidth + \"px\"\n\t\t\t\t\t\tbase.style.height = window.innerHeight + \"px\"\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase.style.width = this.ssize.width + \"px\"\n\t\t\t\t\t\tbase.style.height = this.ssize.height + \"px\"\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tbase.webkitRequestFullscreen()\n\t\t\t} else ret = false \n\t\t\treturn ret \n\t\t}\n\t\texitVR() {\n\t\t\tif(POXPDevice.VRReady) {\n\t\t\t\tPOXPDevice.closeVR(this)\n\t\t\t}\n\t\t}\n\t\tsetMouseEvent() {\n\t\t\t//set key capture dummy input\n\t\t\tconst e = document.createElement(\"input\") ;\n\t\t\te.setAttribute(\"type\",\"checkbox\") ;\n\t\t\te.style.position = \"absolute\" ; e.style.zIndex = -100 ;\n\t\t\te.style.top = 0 ;e.style.left = \"-20px\"\n\t\t\te.style.width = \"10px\" ; e.style.height =\"10px\" ; e.style.padding = 0 ; e.style.border = \"none\" ; e.style.opacity = 0 ;\n\t\t\tthis.can.parentNode.appendChild(e) ;\n\t\t\tthis.keyElelment = e ;\n\t\t\tthis.keyElelment.focus() ;\n\t\t\t\n\t\t\t// mouse and key intaraction\n\t\t\tlet dragging = false ;\n\t\t\tconst Param = this.param ;\n\t\t\tconst can = this.can ;\n\n\t\t\t//mouse intraction\n\t\t\tconst m = new Pointer(can,{\n\t\t\t\tdown:(d)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"down\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,sx:d.sx*this.pixRatio,sy:d.sy*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"down\",d)\n\t\t\t\t\tdragging = true ;\n\t\t\t\t\tif(this.ccam.cam.camMode==\"walk\") this.keyElelment.focus() ;\n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tmove:(d)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"move\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,ox:d.ox*this.pixRatio,oy:d.oy*this.pixRatio,dx:d.dx*this.pixRatio,dy:d.dy*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"move\",d) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tup:(d)=> {\n\t\t\t\t\tif(!this.ccam) return true ;\n\t\t\t\t\tdragging = false ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"up\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,dx:d.dx*this.pixRatio,dy:d.dy*this.pixRatio,ex:d.ex*this.pixRatio,ey:d.ey*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"up\",d)\n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tout:(d)=> {\n\t\t\t\t\tif(!this.ccam) return true ;\n\t\t\t\t\tdragging = false ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"out\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,dx:d.dx*this.pixRatio,dy:d.dy*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"out\",d) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\twheel:(d)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"wheel\",d) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"wheel\",d) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tgesture:(z,r)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"gesture\",{z:z,r:r}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"gesture\",{z:z,r:r}) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tgyro:(ev)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause || POXPDevice.VRReady ) return true;\n\t\t\t\t\tif(dragging) return true ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"gyro\",ev) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"gyro\",ev) \n\t\t\t\t\treturn false ;\n\t\t\t\t}\n\t\t\t})\n\t\t\tWBind.addev(this.keyElelment,\"keydown\", (ev)=>{\n\t\t//\t\tconsole.log(\"key:\"+ev.key);\n\t\t\t\tif( Param.pause) return true ;\n\t\t\t\tif(this.pox.event) {\n\t\t\t\t\tif(!this.callEvent(\"keydown\",ev)) return true ;\n\t\t\t\t}\n\t\t\t\tif(this.ccam) this.ccam.event(\"keydown\",ev) \n\t\t\t\treturn false ;\n\t\t\t})\n\t\t\tWBind.addev(this.keyElelment,\"keyup\", (ev)=>{\n\t\t//\t\tconsole.log(\"key up:\"+ev.key);\n\t\t\t\tif(Param.pause) return true ;\n\t\t\t\tif(this.pox.event) {\n\t\t\t\t\tif(!this.callEvent(\"keyup\",ev)) return true ;\n\t\t\t\t}\n\t\t\t\tif(this.ccam) this.ccam.event(\"keyup\",ev)\n\t\t\t\treturn false ;\n\t\t\t})\t\t\n\t\t\tdocument.querySelectorAll(\"#bc button\").forEach((o)=>{\n\t\t\t\to.addEventListener(\"mousedown\", (ev)=>{\n\t\t\t\t\tthis.callEvent(\"btndown\",ev.target.id) ;\n\t\t\t\t\tthis.ccam.event(\"keydown\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t\to.addEventListener(\"touchstart\", (ev)=>{\n\t\t\t\t\tthis.callEvent(\"touchstart\",ev.target.id) ;\n\t\t\t\t\tthis.ccam.event(\"keydown\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t\to.addEventListener(\"mouseup\", (ev)=>{\n\t\t\t\t\tthis.callEvent(\"btnup\",ev.target.id) ;\n\t\t\t\t\tthis.ccam.event(\"keyup\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tthis.keyElelment.focus() ;\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t\to.addEventListener(\"touchend\", (ev)=>{\n\t\t\t\t\tlet ret = true; \n\t\t\t\t\tret = this.callEvent(\"touchend\",ev.target.id) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"keyup\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t})\n\n\t\t}\n\t\tresize() {\n\t\t//\tconsole.log(\"wresize:\"+document.body.offsetWidth+\" x \"+document.body.offsetHeight);\n\t\t\tif(this.can.offsetWidth < 300 || \n\t\t\t\t(POXPDevice.isPresenting)) return \n\t\t\tthis.can.width= this.can.offsetWidth*this.pixRatio*window.devicePixelRatio  ;\n\t\t\tthis.can.height = this.can.offsetHeight*this.pixRatio*window.devicePixelRatio  ;\n\t\t//\tconsole.log(\"canvas:\"+this.can.width+\" x \"+this.can.height);\t\t\n\t\t}\n\n\t} //class PoxPlayer\n\n\t// poxplayercamera object\n\tPoxPlayer.prototype.createCamera = function(cam) {\n\t\treturn new this.Camera(this,cam) ;\n\t}\n\tPoxPlayer.prototype.Camera = PoxCamera;\n\n\tpoxp.init= function(canvas=null) {\n\t\tlet player \n\t\ttry {\n\t\t\tplayer = new PoxPlayer(canvas?canvas:'#screen1', \n\t\t\t{capture:true,noWebGL2:false}) ;\n\t\t} catch(err) {\n\t\t\tconsole.log(err)\n\t\t\talert (err) \n\t\t\treturn \n\t\t}\n\t\tconsole.log(player);\n\t\tpoxp.player = player; \n\t\tplayer.setError( poxp.msg) ;\n\n\t\t$(\"vrbtn\").addEventListener(\"click\", (ev)=>{\n\t\t  if (\n\t\t    window.DeviceOrientationEvent &&\n\t\t    DeviceOrientationEvent.requestPermission &&\n\t\t    typeof DeviceOrientationEvent.requestPermission === 'function'\n\t\t  ) {\n\t\t    DeviceOrientationEvent.requestPermission();\n\t\t  }\n\t\t\twindow.addEventListener(\"deviceorientation\", function(ev) {\n\t\t\t\tvar or = window.orientation ;\n\t\t\t\tvar d = (or==90||or==-90) ;\n\t\t\t\tplayer.param.isStereo = d ;\n\t\t\t\t$(\"cc\").style.opacity = d?0.:0.4 ;\n\t\t\t\t$(\"footer\").style.display = d?\"none\":\"block\" ;\n\t\t\t\t$(\"vrbtn\").style.display = d?\"none\":\"block\" ;\n\t\t\t\t$(\"padl\").style.opacity = d?0.:0.4 ;\n\t\t\t\t$(\"padr\").style.opacity = d?0.:0.4 ;\n\t\t\t\twindow.scrollTo(0,1000)\n\t\t\t})\n\t\t\tplayer.enterVR()\n\t\t}) \n\t\t$(\"screen1\").addEventListener(\"mousedown\", (ev)=>{\n\t\t\tplayer.keyElelment.focus()\n\t\t}) \n\t\tlet padl={},padr={} \n\t\tfunction clearpad(cpad,left) {\n\t\t\t cpad.buttons = [{pressed:false,touched:false},{pressed:false,touched:false},{pressed:false,touched:false},{pressed:false,touched:false},{pressed:false,touched:false},{pressed:false,touched:false}]\n\t\t\t cpad.axes=[0,0]\n\t\t\t cpad.hand = left?\"left\":\"right\"\n\t\t}\t\n\t\tclearpad(padl,true)\n\t\tplayer.pox.gPad.set(padl)\n\t\tclearpad(padr,false)\n\t\tplayer.pox.gPad2.set(padr)\n\n\t\tfunction mover(pad,tpad,ev) {\n\t\t\tconst id = ev.target.getAttribute(\"data-key\")\n\t\t\tif(id==2) {\n\t\t\t\tconst d = ev.target.getAttribute(\"data-dir\")\n\t\t\t\tpad.axes[2] = 0 ; pad.axes[3] = 0\n\t\t\t\tpad.axes[(d&2)?1:0] =  (d&1)?0.8:-0.8\n\t\t\t\tpad.axes[(d&2)?3:2] =  (d&1)?0.8:-0.8\n\t\t\t} \n\t\t\tpad.buttons[id].touched = true \n\t\t\tif(tpad) tpad.set(pad) \n\t\t\tev.preventDefault()\t\t\n\t\t}\n\t\tfunction tstart(pad,tpad,ev){\n\t\t\tconst id = ev.target.getAttribute(\"data-key\")\n\t\t\tif(id==2) {\n\t\t\t\tconst d = ev.target.getAttribute(\"data-dir\")\n\t\t\t\tpad.axes[2] = 0 ; pad.axes[3] = 0\n\t\t\t\tpad.axes[(d&2)?1:0] =  (d&1)?0.8:-0.8 \t\n\t\t\t\tpad.axes[(d&2)?3:2] =  (d&1)?0.8:-0.8\t\t\n\t\t\t} \n\t\t\tpad.buttons[id].touched = true \n\t\t\tpad.buttons[id].pressed = true \n\t\t\tif(tpad) tpad.set(pad) \n\t\t\tev.preventDefault()\t\t\n\t\t}\n\t\tfunction mdown(pad,tpad,ev){\n\t\t\tconst id = ev.target.getAttribute(\"data-key\") \n\t\t\tpad.buttons[id].pressed = true \n\t\t\tif(tpad) tpad.set(pad)  \n\t\t\tev.preventDefault()\t\t\n\t\t}\n\t\tfunction mup(pad,tpad,ev) {\n\t\t\tconst id = ev.target.getAttribute(\"data-key\") \n\t\t\tpad.buttons[id].pressed = false  \n\t\t\tif(tpad) tpad.set(pad) \n\t\t\tev.preventDefault()\t\t\n\t\t}\n\t\tfunction tend(pad,tpad,left,ev){\n\t\t\tconst id = ev.target.getAttribute(\"data-key\") \n\t\t\tpad.buttons[id].touched = false \n\t\t\tpad.buttons[id].pressed = false \n\t\t\tclearpad(pad,left)\n\t\t\tif(tpad) tpad.set(pad) \n\t\t\tev.preventDefault()\t\t\n\t\t}\n\t\tfunction clear(pad,tpad,left,ev) {\n\t\t\tclearpad(pad,left)\n\t\t\tif(tpad) tpad.set(pad)  \n\t\t\tev.preventDefault()\t\t\n\t\t}\n\n\t\tdocument.querySelectorAll(\"#padl button\").forEach((o)=>{\n\t\t\to.addEventListener(\"mouseover\", (ev)=>{\tmover(padl,player.pox.leftPad,ev)})\n\t\t\to.addEventListener(\"touchstart\", (ev)=>{tstart(padl,player.pox.leftPad,ev)})\n\t\t\to.addEventListener(\"mousedown\", (ev)=>{mdown(padl,player.pox.leftPad,ev)})\n\t\t\to.addEventListener(\"mouseup\", (ev)=>{mup(padl,player.pox.leftPad,ev)})\n\t\t\to.addEventListener(\"touchend\", (ev)=>{tend(padl,player.pox.leftPad,true,ev)})\n\t\t\to.addEventListener(\"mouseout\", (ev)=>{clear(padl,player.pox.leftPad,true,ev)})\n\t\t\to.addEventListener(\"touchcancel\", (ev)=>{clear(padl,player.pox.leftPad,true,ev)})\n\t\t})\n\n\t\tdocument.querySelectorAll(\"#padr button\").forEach((o)=>{\n\t\t\to.addEventListener(\"mouseover\", (ev)=>{\tmover(padr,player.pox.rightPad,ev)})\n\t\t\to.addEventListener(\"touchstart\", (ev)=>{tstart(padr,player.pox.rightPad,ev)})\n\t\t\to.addEventListener(\"mousedown\", (ev)=>{mdown(padr,player.pox.rightPad,ev)})\n\t\t\to.addEventListener(\"mouseup\", (ev)=>{mup(padr,player.pox.rightPad,ev)})\n\t\t\to.addEventListener(\"touchend\", (ev)=>{tend(padr,player.pox.rightPad,false,ev)})\n\t\t\to.addEventListener(\"mouseout\", (ev)=>{clear(padr,player.pox.rightPad,false,ev)})\n\t\t\to.addEventListener(\"touchcancel\", (ev)=>{clear(padr,player.pox.rightPad,false,ev)})\n\t\t})\t\n\t}\n\tpoxp.load = function(src,query=null) {\n\t\tconst player = this.player \n\t\treturn new Promise(async (resolve,reject)=>{\n\n\t\tif(query==null) query = location.search.substr(1).split(\"&\")\n\t\tif(query[0].match(/.+\\.json/)) {\n\t\t\tplayer.load(query[0]+\"?\"+ Math.random()).then((src)=>{\n\t\t\t\tquery.shift()\n\t\t\t\tresolve({src:src,query:query})\n\t\t\t})\n\t\t} else if(typeof src ==\"string\") {\n\t\t\tplayer.load(src+\"?\"+ Math.random()).then((src)=>{\n\t\t\t\tresolve({src:src,query:query})\n\t\t\t})\t\n\t\t} else if(src!==null) {\t\n\t\t\tresolve({src:src,query:query})\n\t\t} else {\n\t\t\tvar s = localStorage.getItem(\"poxe_save\") ;\n\t\t\tvar data ;\n\t\t\tif(s) data = JSON.parse(s)\n\t\t\tplayer.load(data).then((src)=>{\n\t\t\t\tresolve({src:src,query:query})\n\t\t\t}).catch((err)=>{\n\t\t\t\treject(\"cannot load source\")\n\t\t\t})\n\t\t}\n\t\t})\n\t}\n\tpoxp.set = function(src,q) {\n\n\t\treturn new Promise(async (resolve,reject)=>{\n\t\t\tif(src.modules) {\n\t\t\t\ttry {\n\t\t\t\t\tconst m1 = await poxp.player.loadModuleSrc(src.modules[0])\n\t\t\t\t\tpoxp.player.m1 = m1 \n\t\t\t\t\tfor(k in m1) console.log(k)\n\t\t\t\t} catch(err) {}\n\t\t\t}\n\t\t\tif(src.workers) {\n\t\t\t\ttry {\n\t\t\t\t\tconst bb = new Blob( [src.workers[0]]);\n\t\t\t\t\tpoxp.player.w1 = new Worker(window.URL.createObjectURL(bb))\n\t\t\t\t} catch(err) {}\n\t\t\t}\n\n\t\t\tpoxp.setting = src.settings\n\t\t\tif(document.title==\"\") document.title = `PoExE:${poxp.setting.name}`\n\t\t\tif(src.settings.copyright) $(\"footer\").innerHTML = poxp.setting.copyright\n\t\t\t\n\t\t\tif(src.settings.gui) {\n\t\t\t\tpoxp.player.setParam(src.settings.gui,$('pui'))\n\t\t\t}\n\t\t\t// only one render \n\t\t\tpoxp.player.setsrc(src.renders[0],src.settings).then((pox)=>{\n\t\t\t\tpoxp.msg(\"init ok\")\t\t\t\n\t\t\t}).catch((err)=>{\n\t\t\t\tconsole.log(err)\n\t\t\t\tconsole.log(\"catch\")\n\t\t\t\tpoxp.msg(poxp.player.emsg);\n\t\t\t\treject()\n\t\t\t})\t\n\t\t})\n\t}\n\n\treturn poxp.PoxPlayer = PoxPlayer;\n});\n\n"]}