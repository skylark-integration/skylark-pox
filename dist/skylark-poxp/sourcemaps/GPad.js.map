{"version":3,"sources":["GPad.js"],"names":["define","poxp","GPad","this","idx","conn","gpadcount","navigator","getGamepads","gamepads","length","prototype","init","cb","undefined","ret","console","log","axes","egp","addEventListener","e","gamepad","index","get","lastGp","buttons","pressed","touched","pad","gp","POXPDevice","emu","isPresenting","session","inputSources","is","i","mapping","hand","handedness","lgp","bf","pf","tf","dbtn","dpad","dtouch","stick","eaxes","Math","abs","ev","set","clear","cf"],"mappings":"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","file":"../GPad.js","sourcesContent":["define([\n    \"./poxp\"\n],function(poxp){\n\t/**\n\t *\tgamepad object \n\t *\t@constructor \n\t */\n\tvar GPad = function() {\n\t\tthis.idx = 0 \n\t\tthis.conn = false \n\t\tthis.gpadcount = 0 \n\t\tif(!navigator.getGamepads) return false ;\n\t\tgamepads = navigator.getGamepads();\n\t\tthis.gpadcount = gamepads.length\n\t\treturn this.gpadcount > 0  \n\t}\n\n\tGPad.prototype.init = function(idx,cb) {\n\t\tif(idx==undefined) idx = 0 \n\t\tthis.idx = idx \n\t\tif(!navigator.getGamepads) return false ;\n\t\tlet ret = true \n\t\tgamepads = navigator.getGamepads();\n\t//\tconsole.log(gamepads)\n\t\tif(gamepads[this.idx]) {\n\t\t\tconsole.log(\"gpad init \"+this.idx) ;\n\t\t\tthis.axes =gamepads[this.idx].axes \n\t\t\tthis.conn = false ;\n\t\t\tthis.egp = null ;\n\t\t} else {\n\t\t\tthis.conn = false \n\t\t\tret = false \n\t\t}\n\t\taddEventListener(\"gamepadconnected\", (e)=> {\n\t\t\tif(e.gamepad.index != this.idx ) return \n\t\t\tconsole.log(\"gpad reconnected \"+e.gamepad.index) ;\n\t//\t\tconsole.log(e.gamepad) ;\n\t\t\tthis.axes = e.gamepad.axes \n\t\t\tthis.conn = true; \n\t\t\tthis.get()\n\t\t\tif(cb) cb(this,true) \n\t\t})\t\n\t\taddEventListener(\"gamepaddisconnected\", (e)=> {\n\t\t\tif(e.gamepad.index != this.idx ) return \n\t\t\tconsole.log(\"gpad disconnected \"+e.gamepad.index) ;\n\t\t\tthis.conn = false ;\n\t\t\tif(cb) cb(this,false) \n\t\t})\n\t\tthis.lastGp = {\n\t\t\tbuttons:[\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false}\n\t\t\t],\n\t\t\taxes:[0,0,0,0]\n\t\t}\n\t\tthis.egp = {\n\t\t\tbuttons:[\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false}\n\t\t\t],\n\t\t\taxes:[0,0,0,0]\n\t\t}\n\t\treturn ret ;\n\t}\n\tGPad.prototype.get = function(pad) {\n\t\tvar gp \n\t\tif(POXPDevice) {\n\t\t\tthis.emu = false \n\t\t\tif(POXPDevice.isPresenting && POXPDevice.session.inputSources) {\n\t\t\tconst is = POXPDevice.session.inputSources\n\t//\t\tif(is.length>1) {\n\t//\t\t\tconsole.log(is[0])}\n\t\t\tfor (let i=0;i<=is.length-1;i++) {\n\t\t\t\tif (is[i].gamepad && is[i].gamepad.mapping==\"xr-standard\") {\n\t\t\t\t\tis[i].gamepad.hand = is[i].handedness\n\t\t\t\t\tif (is[i].handedness==\"left\" && this.idx==1) {gp=is[i].gamepad }\n\t\t\t\t\tif (is[i].handedness==\"right\" && this.idx==0) {gp=is[i].gamepad }\n\t\t\t\t\tif(gp) {\n\t\t\t\t\t\tthis.conn = true \n\t\t\t\t\t\tbreak \n\t\t\t\t\t} else this.conn = false \t\t\t\t\t\n\t\t\t\t}\t\n\t\t\t}\n\t\t\t} else this.conn = false \n\t\t} \n\t\tif(!gp) {\n\t\t\tif(this.egp==null) return null ;\t\n\t\t\tthis.conn = true \n\t\t\tgp = this.egp\n\t\t\tthis.emu = true \n\t\t} \n\t\tvar lgp = this.lastGp \n\t\tgp.conn = this.conn \n\t\tgp.emu = this.emu \n\t\tgp.bf = false \n\t\tgp.pf = false \n\t\tgp.tf = false \n\t\tgp.dbtn = [] \n\t\tgp.dpad = []\n\t\tgp.dtouch = [] \n\n\t//\tif(lgp) console.log(lgp.buttons[1].pressed +\" \"+ gp.buttons[1].pressed)\n\t\tfor(var i=0;i<gp.buttons.length;i++) {\n\t\t\tgp.dbtn[i] = 0 \n\t\t\tgp.dtouch[i] = 0 \n\t\t\tif(lgp && lgp.buttons[i]) {\n\t\t\t\tif(!lgp.buttons[i].pressed && gp.buttons[i].pressed) {gp.dbtn[i] = 1; gp.bf=true} \n\t\t\t\tif(lgp.buttons[i].pressed && !gp.buttons[i].pressed) {gp.dbtn[i] = -1;gp.bf=true}\n\t\t\t\tif(!lgp.buttons[i].touched && gp.buttons[i].touched) {gp.dtouch[i] = 1; gp.tf=true} \n\t\t\t\tif(lgp.buttons[i].touched && !gp.buttons[i].touched) {gp.dtouch[i] = -1;gp.tf=true}\n\t\t\t}\n\t\t\tlgp.buttons[i] = {pressed:gp.buttons[i].pressed,\n\t\t\t\t\t\t\t\t\t\t\t\ttouched:gp.buttons[i].touched}\n\t\t}\n\t\tconst th = 0.5 \n\t\tconst eps = 0.001 \n\t\tlet axes = [gp.axes[0],gp.axes[1],gp.axes[2],gp.axes[3]]\n\t\tif(gp.axes[2]!==undefined && gp.axes[3]!==undefined) {\n\t\t\t axes[0] = gp.axes[2]\n\t\t\t axes[1] = gp.axes[3]\n\t\t\t gp.stick = true ;\n\t\t} else gp.stick = false ;\n\t\t\n\t\tgp.eaxes = axes \n\t\tfor(var i=0;i<axes.length;i++) {\n\t\t\tif(Math.abs(axes[i]) < eps ) gp.axes[i] = 0 \n\t\t\tgp.dpad[i] = 0 \n\t\t\tif(lgp) {\n\t\t\t\tif(Math.abs(lgp.axes[i])<th && Math.abs(axes[i])>=th) {gp.dpad[i] = 1;gp.pf=true}\n\t\t\t\tif(Math.abs(lgp.axes[i])>=th && Math.abs(axes[i])<th) {gp.dpad[i] = -1;gp.pf=true}\n\t\t\t}\n\t\t\tlgp.axes[i] = axes[i]\n\t\t}\n\t\tthis.gp = gp \n\n\t\tif(this.ev && (gp.bf || gp.pf || gp.tf)){\n\t\t\tthis.ev(gp) \n\t\t}\n\t//\tconsole.log(gp)\n\t\treturn gp ;\t\n\t}\n\tGPad.prototype.set = function(gp) {//for emulation\n\t\tthis.egp = gp ;\t\n\t}\n\tGPad.prototype.clear = function(gp) {//for emulation\n\t\tif(gp==undefined ) gp = {\n\t\t\tbuttons:[\n\t\t\t\t{pressed:false,touched:false},\n\t\t\t\t{pressed:false,touched:false}\n\t\t\t],\n\t\t\taxes:[0,0,0,0]\n\t\t}\n\t\tthis.egp = gp\n\t\tthis.cf = true ;\t\n\t}\n\n\treturn poxp.GPad = GPad;\n});"]}