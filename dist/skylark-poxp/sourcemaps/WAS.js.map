{"version":3,"sources":["WAS.js"],"names":["define","poxp","WAS","synth","opt","AC","window","AudioContext","webkitAudioContext","this","ctx","mg","createGain","gain","value","outnode","analyse","analyser","createAnalyser","connect","tone","bass","createBiquadFilter","type","frequency","treble","comp","createDynamicsCompressor","destination","error","ongen","prototype","close","createongen","o","init","copyobj","s","d","k","undefined","param","e1","f1","o1","createOscillator","waveform","n1","createScriptProcessor","onaudioprocess","ev","buf0","outputBuffer","getChannelData","buf1","i","Math","random","tune","sf","lfo_osc","l1","l1g","level","lfo_flt","l2","l2g","lfo_amp","l3","l3g","lag","eg","attack","decay","sustain","release","maxvalue","minvalue","setopt","cutoff","resonance","Q","ftype","self","onended","disconnect","call","start","note","f","len","time","note2freq","now","currentTime","endtime","console","log","cancelScheduledValues","setValueAtTime","setenv","eg_osc","continuous","stop","tgt","linearRampToValueAtTime","sv","match","n","c","e","g","a","b","RegExp","$1","toLowerCase","m","$2","$3","pow","showwave","can","intv","getContext","strokeStyle","fillStyle","w","canvas","width","hw","h","height","ad","Uint8Array","setInterval","getByteTimeDomainData","fillRect","beginPath","moveTo","lineTo","getByteFrequencyData","am","an","stroke"],"mappings":"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","file":"../WAS.js","sourcesContent":["define([\n    \"./poxp\"\n],function(poxp){\n\t//WabAudio wrapper\n\t//  by wakufactory \n\tvar WAS = {\n\t\tsynth:function(opt) {\n\t\t\tvar AC = window.AudioContext ||window.webkitAudioContext;\n\t\t\tif(!AC) {\n\t\t\t\tthis.error = true; \n\t\t\t\treturn ;\n\t\t\t}\n\t\t\tthis.ctx = new AC() ;\n\t\t\tthis.mg = this.ctx.createGain() ;\n\t\t\tthis.mg.gain.value = 0.2 ;\n\t\t\tthis.outnode = this.mg ;\n\t\t\tif(opt && opt.analyse) {\n\t\t\t\tthis.analyser = this.ctx.createAnalyser() ;\t\n\t\t\t\tthis.analyser.connect(this.mg) ;\n\t\t\t\tthis.outnode = this.analyser\n\t\t\t}\n\t\t\tif(opt && opt.tone) {\n\t\t\t\tthis.bass = this.ctx.createBiquadFilter() ;\n\t\t\t\tthis.bass.type = \"lowshelf\" ;\n\t\t\t\tthis.bass.frequency.value = 500 ;\n\t\t\t\tthis.bass.gain.value = 5.0 ;\n\t\t\t\tthis.treble = this.ctx.createBiquadFilter() ;\n\t\t\t\tthis.treble.type = \"highshelf\" ;\n\t\t\t\tthis.treble.frequency.value = 2000 ;\n\t\t\t\tthis.treble.gain.value = 5.0 ;\n\t\t\t\tthis.bass.connect(this.treble) ;\n\t\t\t\tthis.treble.connect(this.outnode) ;\n\t\t\t\tthis.outnode = this.bass ;\n\t\t\t}\n\t\t\tif(opt && opt.comp) {\n\t\t\t\tthis.comp = this.ctx.createDynamicsCompressor();\n\t\t\t\tthis.comp.connect(this.outnode) ;\n\t\t\t\tthis.outnode = this.comp ;\n\t\t\t}\n\t\t\tthis.mg.connect(this.ctx.destination) ;\n\t\t},\n\t\tongen:function(synth) {\n\t\t\tthis.synth = synth ;\n\t\t\tthis.ctx = synth.ctx ;\n\t\t}\n\t}\n\tWAS.synth.prototype.close = function() {\n\t\tthis.ctx.close() ;\n\t}\n\tWAS.synth.prototype.createongen = function(opt) {\n\t\tvar o = new WAS.ongen(this) ;\n\t\to.init(opt) ;\n\t\treturn o ;\n\t}\n\tWAS.synth.prototype.copyobj = function(s,d) {\n\t\tfor(var k in s) {\n\t\t\tif(s[k]!==null && typeof s[k]==\"object\") {\n\t\t\t\tif(d[k]===undefined) d[k] = {} ;\n\t\t\t\tthis.copyobj(s[k],d[k]) ;\n\t\t\t}\n\t\t\telse d[k]=s[k] ;\n\t\t}\n\t}\n\n\tWAS.ongen.prototype.init = function(param) {\n\t\tthis.e1 = this.ctx.createGain() ;\n\t\tthis.f1 = this.ctx.createBiquadFilter() ;\n\t\tthis.o1 = this.ctx.createOscillator() ;\n\t\tif(param.waveform==\"noise\") {\n\t\t\tvar bufsize = 1024 ;\n\t\t\tthis.n1 = this.ctx.createScriptProcessor(bufsize) ;\n\t\t\tthis.n1.onaudioprocess = function(ev) {\n\t\t\t\tvar buf0 = ev.outputBuffer.getChannelData(0);\n\t\t\t\tvar buf1 = ev.outputBuffer.getChannelData(1);\n\t\t\t\tfor(var i = 0; i < bufsize; ++i) {\n\t\t\t\t\tbuf0[i] = buf1[i] = (Math.random() - 0.5) ;\n\t\t\t\t}\n\t//\t\t\tconsole.log(\"p\") ;\n\t\t\t}\n\t\t\tthis.o1.connect(this.n1) ;\n\t\t\tthis.n1.connect(this.f1) ;\n\t\t} else {\n\t\t\tthis.o1.connect(this.f1) ;\n\t\t}\n\t\tthis.f1.connect(this.e1) ;\n\t\tthis.e1.connect(this.synth.outnode) ;\n\t\tthis.f1.frequency.value = 20000 ;\n\t\tthis.e1.gain.value = 0 ;\n\t\tthis.tune = 440 ;\n\t\tthis.sf = false ;\n\t\t\n\t\tif(param.lfo_osc) {\n\t\t\tthis.l1 = this.ctx.createOscillator() ;\n\t\t\tthis.l1g = this.ctx.createGain() ;\n\t\t\tthis.l1.connect(this.l1g) ;\n\t\t\tthis.l1g.connect(this.o1.frequency) ;\n\t\t\tthis.l1.frequency.value = param.lfo_osc.frequency ;\n\t\t\tthis.l1.type = param.lfo_osc.waveform ;\n\t\t\tthis.l1g.gain.value = param.lfo_osc.level ;\n\t\t}\n\t\tif(param.lfo_flt) {\n\t\t\tthis.l2 = this.ctx.createOscillator() ;\n\t\t\tthis.l2g = this.ctx.createGain() ;\n\t\t\tthis.l2.connect(this.l2g) ;\n\t\t\tthis.l2g.connect(this.f1.frequency) ;\n\t\t\tthis.l2.frequency.value = param.lfo_flt.frequency ;\n\t\t\tthis.l2.type = param.lfo_flt.waveform ;\n\t\t\tthis.l2g.gain.value = param.lfo_flt.level ;\n\t\t}\n\t\tif(param.lfo_amp) {\n\t\t\tthis.l3 = this.ctx.createOscillator() ;\n\t\t\tthis.l3g = this.ctx.createGain() ;\n\t\t\tthis.lag = this.ctx.createGain() ;\n\t\t\tthis.l3.connect(this.l3g) ;\n\t\t\tthis.l3g.connect(this.lag.gain) ;\n\t\t\tthis.l3.frequency.value = param.lfo_amp.frequency ;\n\t\t\tthis.l3.type = param.lfo_amp.waveform ;\n\t\t\tthis.l3g.gain.value = param.lfo_amp.level ;\n\t\t\tthis.f1.connect(this.lag);\n\t\t\tthis.lag.connect(this.e1) ;\n\t\t}\n\t\tthis.opt = {\n\t\t\t'eg':{\n\t\t\t\t'attack':0.1,\n\t\t\t\t'decay':0.1,\n\t\t\t\t'sustain':0.5,\n\t\t\t\t'release':1.0,\n\t\t\t\t'maxvalue':1.0,\n\t\t\t\t'minvalue':0\n\t\t\t}\n\t\t};\n\t\tthis.setopt(param) ;\n\t}\n\n\tWAS.ongen.prototype.setopt = function(param) {\n\t\tif(param) {\n\t\t\tthis.synth.copyobj(param,this.opt) ;\n\t\t}\n\t//\tconsole.log(this.opt) ;\n\t\tif(this.opt.waveform && this.opt.waveform!=\"noise\") this.o1.type = this.opt.waveform ;\n\t\tif(this.opt.cutoff) this.f1.frequency.value = this.opt.cutoff ;\n\t\tif(this.opt.resonance) this.f1.Q.value = this.opt.resonance ;\n\t\tif(this.opt.ftype) this.f1.type = this.opt.ftype ;\n\t\tvar self = this ;\n\t\tthis.o1.onended =function(){\n\t\t\tif(self.opt.waveform==\"noise\") self.n1.disconnect() ;\n\t\t\tif(self.opt.onended)  self.opt.onended.call(self) ;\n\t\t}\n\t}\n\n\tWAS.ongen.prototype.start = function() {\n\t\tif(!this.sf) {\n\t\t\tthis.o1.start(0) ;\n\t\t\tif(this.l1) this.l1.start(0) ;\n\t\t\tif(this.l2) this.l2.start(0) ;\n\t\t\tif(this.l3) this.l3.start(0) ;\n\t\t\tthis.sf = true ;\n\t\t}\n\t}\n\n\tWAS.ongen.prototype.note = function(f,len,time) {\n\t\tthis.start() ;\n\t\tif(time==undefined) time = 0 ;\n\t\tif(typeof f ==\"string\") f = this.note2freq(f) ;\n\t\tvar now=this.ctx.currentTime ;\n\t\tif(this.endtime>now) {\n\t\t\tconsole.log(\"over\") ;\n\t//\t\treturn ;\n\t\t}\n\t//\tconsole.log(this.opt) ;\n\t\t\n\t\tthis.e1.gain.cancelScheduledValues(0);  // スケジュールを全て解除\n\t\tthis.o1.frequency.setValueAtTime(f, now) ;\n\t\tnow = now + time + 0.01;\n\t\tthis.endtime = this.setenv(this.e1.gain,now,len,this.opt.eg) ;\n\t\t\n\t\tif(this.opt.eg_osc) {\n\t\t\tthis.opt.eg.minvalue = f;\n\t\t\tthis.opt.eg.maxvalue = this.opt.eg_osc.minvalue+100 ;\n\t\t\tthis.setenv(this.o1.frequency,now,len,this.opt.eg_osc) ;\n\t\t}\n\n\t\tif(!this.opt.continuous) {\n\t\t\tthis.o1.stop(this.endtime) ;\t\n\t\t}\n\t}\n\tWAS.ongen.prototype.setenv = function(tgt,now,len,param) {\n\t\ttgt.setValueAtTime(param.minvalue, now);\n\t\ttgt.linearRampToValueAtTime(param.maxvalue, now + param.attack);\n\t\tvar sv = (param.maxvalue-param.minvalue)*param.sustain+param.minvalue ;\n\t\ttgt.linearRampToValueAtTime(sv, now + param.attack+param.decay);\n\t\ttgt.setValueAtTime(sv, now + len);\n\t\tendtime = now + len+param.release  ;\n\t\ttgt.linearRampToValueAtTime(param.minvalue, endtime );\n\t\treturn endtime ;\n\t}\n\tWAS.ongen.prototype.note2freq = function(note) {\n\t\tvar na = {'c':0,'d':2,'e':4,'f':5,'g':7,'a':9,'b':11} ;\n\t\tif(note.match(/([CDEFGAB])([#\\+\\-]*)([0-9]+)/i)) {\n\t\t\tvar n = na[RegExp.$1.toLowerCase()] ;\n\t\t\tvar m = RegExp.$2 ;\n\t\t\tvar o = RegExp.$3 ;\n\t\t\tif(m==\"#\"||m==\"+\") n += 1 ;\n\t\t\tif(m==\"-\") n -= 1 ;\n\t\t\tn = o*12+n ;\n\t\t\tvar f = Math.pow(2,(n-57)/12)*this.tune ;\n\t//\t\tconsole.log(f) ;\n\t\t\treturn f ;\n\t\t} \n\t\treturn null  ;\n\t}\n\n\tWAS.synth.prototype.showwave = function(can,intv) {\n\t\tcan = can.getContext('2d') ;\n\t\tcan.strokeStyle=\"#fff\" ;\n\t\tcan.fillStyle=\"#486\";\n\t\tvar w = can.canvas.width ;\n\t\tvar hw = w/2 ;\n\t\tvar h = can.canvas.height ;\n\t\tvar ad = new Uint8Array(512) ;\n\t\tvar self = this ;\n\t\tsetInterval(function() {\n\t\t\tself.analyser.getByteTimeDomainData(ad) ;\t//波形取得\n\t\t\tcan.fillRect(0,0,w,h);\n\t\t\tcan.beginPath();\n\t\t\tcan.moveTo(0,h/2);\n\t\t\tfor(i=0;i<512;i++) {\n\t\t\t\tcan.lineTo(i*hw/512,h-ad[i]*h/256);\n\t\t\t}\n\t\t\tself.analyser.getByteFrequencyData(ad);\t//周波数スペクトル取得\n\t\t\tcan.moveTo(hw,h);\n\t\t\tvar am =0,an= 512 ;\n\t\t\tfor(i=0;i<512;i++) {\n\t\t\t\tif(am<ad[i]) am = ad[i];\n\t\t\t\tif(an>ad[i]) an = ad[i] ;\n\t\t\t\tcan.moveTo(i*hw/512+hw,h);\n\t\t\t\tcan.lineTo(i*hw/512+hw,h-ad[i]*h/256);\n\t\t\t}\n\t\t\tcan.stroke() ;\n\t\t},intv);\t\n\t}\n\n\treturn poxp.WAS = WAS;\n});"]}