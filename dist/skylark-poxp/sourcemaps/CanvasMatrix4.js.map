{"version":3,"sources":["CanvasMatrix4.js"],"names":["define","pox","CanvasMatrix4","m","undefined","name","this","buf","Float32Array","matrix","length","load","makeIdentity","RAD","prototype","arguments","getAsArray","getAsWebGLFloatArray","initmatrix","transpose","tmp","invert","det","_determinant4x4","Math","abs","_makeAdjoint","translate","x","y","z","Array","isArray","scale","rotate","angle","sinA","sin","cosA","cos","sinA2","hypot","x2","y2","z2","multRight","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","multLeft","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","A","B","C","D","perspective","fovy","aspect","zNear","zFar","tan","PI","pallarel","width","lookat","eyex","eyey","eyez","centerx","centery","centerz","upx","upy","upz","zx","zy","zz","mag","xx","xy","xz","yx","yy","yz","_determinant2x2","a","b","c","d","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","V3add","i","V3sub","V3inv","v","V3len","V3norm","s","l","V3mult","V3dot","v1","v2","V3cross","multVec4","w","rotAndTrans","rx","ry","rz","q2m","v2q","rot","sqrt","sr","e2q","s1","s2","s3","qMult","q1","q2"],"mappings":"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","file":"../CanvasMatrix4.js","sourcesContent":["define([\n    \"./pox\"\n],function(pox){\n    /*\n     * Copyright (C) 2009 Apple Inc. All Rights Reserved.\n     *\n     * Redistribution and use in source and binary forms, with or without\n     * modification, are permitted provided that the following conditions\n     * are met:\n     * 1. Redistributions of source code must retain the above copyright\n     *    notice, this list of conditions and the following disclaimer.\n     * 2. Redistributions in binary form must reproduce the above copyright\n     *    notice, this list of conditions and the following disclaimer in the\n     *    documentation and/or other materials provided with the distribution.\n     *\n     * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n     * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n     * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n     * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n     * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n     * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n     * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n     * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n     * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n     * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. \n     */\n    /* modified by wakufactory */\n    /*\n        CanvasMatrix4 class\n        \n        This class implements a 4x4 matrix. It has functions which\n        duplicate the functionality of the OpenGL matrix stack and\n        glut functions.\n        \n        IDL:\n        \n        [\n            Constructor(in CanvasMatrix4 matrix),           // copy passed matrix into new CanvasMatrix4\n            Constructor(in sequence<float> array)           // create new CanvasMatrix4 with 16 floats (row major)\n            Constructor()                                   // create new CanvasMatrix4 with identity matrix\n        ]\n        interface CanvasMatrix4 {\n            attribute float buf[16]\n\n            void load(in CanvasMatrix4 matrix);                 // copy the values from the passed matrix\n            void load(in sequence<float> array);                // copy 16 floats into the matrix\n            sequence<float> getAsArray();                       // return the matrix as an array of 16 floats\n            WebGLFloatArray getAsWebGLFloatArray();           // return the matrix as a WebGLFloatArray with 16 values\n            void makeIdentity();                                // replace the matrix with identity\n            void transpose();                                   // replace the matrix with its transpose\n            void invert();                                      // replace the matrix with its inverse\n            \n            void translate(in float x, in float y, in float z); // multiply the matrix by passed translation values on the right\n            void scale(in float x, in float y, in float z);     // multiply the matrix by passed scale values on the right\n            void rotate(in float angle,                         // multiply the matrix by passed rotation values on the right\n                        in float x, in float y, in float z);    // (angle is in degrees)\n            void multRight(in CanvasMatrix matrix);             // multiply the matrix by the passed matrix on the right\n            void multLeft(in CanvasMatrix matrix);              // multiply the matrix by the passed matrix on the left\n            void ortho(in float left, in float right,           // multiply the matrix by the passed ortho values on the right\n                       in float bottom, in float top, \n                       in float near, in float far);\n            void frustum(in float left, in float right,         // multiply the matrix by the passed frustum values on the right\n                         in float bottom, in float top, \n                         in float near, in float far);\n            void perspective(in float fovy, in float aspect,    // multiply the matrix by the passed perspective values on the right\n                             in float zNear, in float zFar);\n            void lookat(in float eyex, in float eyey, in float eyez,    // multiply the matrix by the passed lookat \n                        in float ctrx, in float ctry, in float ctrz,    // values on the right\n                        in float upx, in float upy, in float upz);\n        }\n    */\n\n    var CanvasMatrix4 = function(m) {\n        if(m!=undefined && m.name == \"Float32Array\") {\n            this.buf = m ;\n            return this ;\n        }\n        this.buf = new Float32Array(16)\n        this.matrix = null\n        if (typeof m == 'object') {\n            if (\"length\" in m && m.length >= 16) {\n                this.load(m);\n                return this;\n            }\n            else if (m instanceof CanvasMatrix4) {\n                this.load(m);\n                return this;\n            }\n        }\n        this.makeIdentity();\n        return this ;\n    }\n    CanvasMatrix4.RAD = pox.RAD;\n\n    CanvasMatrix4.prototype.load = function()\n    {\n        if (arguments.length == 1 && typeof arguments[0] == 'object') {\n            var matrix = arguments[0];\n            \n            if (\"length\" in matrix && matrix.length == 16) {\n                this.buf[0] = matrix[0];\n                this.buf[1] = matrix[1];\n                this.buf[2] = matrix[2];\n                this.buf[3] = matrix[3];\n\n                this.buf[4] = matrix[4];\n                this.buf[5] = matrix[5];\n                this.buf[6] = matrix[6];\n                this.buf[7] = matrix[7];\n\n                this.buf[8] = matrix[8];\n                this.buf[9] = matrix[9];\n                this.buf[10] = matrix[10];\n                this.buf[11] = matrix[11];\n\n                this.buf[12] = matrix[12];\n                this.buf[13] = matrix[13];\n                this.buf[14] = matrix[14];\n                this.buf[15] = matrix[15];\n                return this ;\n            }\n                \n            if (arguments[0] instanceof CanvasMatrix4) {\n            \n                this.buf[0] = matrix.buf[0];\n                this.buf[1] = matrix.buf[1];\n                this.buf[2] = matrix.buf[2];\n                this.buf[3] = matrix.buf[3];\n\n                this.buf[4] = matrix.buf[4];\n                this.buf[5] = matrix.buf[5];\n                this.buf[6] = matrix.buf[6];\n                this.buf[7] = matrix.buf[7];\n\n                this.buf[8] = matrix.buf[8];\n                this.buf[9] = matrix.buf[9];\n                this.buf[10] = matrix.buf[10];\n                this.buf[11] = matrix.buf[11];\n\n                this.buf[12] = matrix.buf[12];\n                this.buf[13] = matrix.buf[13];\n                this.buf[14] = matrix.buf[14];\n                this.buf[15] = matrix.buf[15];\n                return this ;\n            }\n        }\n        \n        this.makeIdentity();\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.getAsArray = function()\n    {\n        return [\n            this.buf[0], this.buf[1], this.buf[2], this.buf[3], \n            this.buf[4], this.buf[5], this.buf[6], this.buf[7], \n            this.buf[8], this.buf[9], this.buf[10], this.buf[11], \n            this.buf[12], this.buf[13], this.buf[14], this.buf[15]\n        ];\n    }\n\n    CanvasMatrix4.prototype.getAsWebGLFloatArray = function()\n    {\n        return this.buf\n    }\n    CanvasMatrix4.prototype.initmatrix = function() {\n        if(!this.matrix) this.matrix = new CanvasMatrix4 \n        this.matrix.makeIdentity() \n        return this ;\n    }\n    CanvasMatrix4.prototype.makeIdentity = function()\n    {\n        this.buf[0] = 1;\n        this.buf[1] = 0;\n        this.buf[2] = 0;\n        this.buf[3] = 0;\n        \n        this.buf[4] = 0;\n        this.buf[5] = 1;\n        this.buf[6] = 0;\n        this.buf[7] = 0;\n        \n        this.buf[8] = 0;\n        this.buf[9] = 0;\n        this.buf[10] = 1;\n        this.buf[11] = 0;\n        \n        this.buf[12] = 0;\n        this.buf[13] = 0;\n        this.buf[14] = 0;\n        this.buf[15] = 1;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.transpose = function()\n    {\n        var tmp = this.buf[1];\n        this.buf[1] = this.buf[4];\n        this.buf[4] = tmp;\n        \n        tmp = this.buf[2];\n        this.buf[2] = this.buf[8];\n        this.buf[8] = tmp;\n        \n        tmp = this.buf[3];\n        this.buf[3] = this.buf[12];\n        this.buf[12] = tmp;\n        \n        tmp = this.buf[6];\n        this.buf[6] = this.buf[9];\n        this.buf[9] = tmp;\n        \n        tmp = this.buf[7];\n        this.buf[7] = this.buf[13];\n        this.buf[13] = tmp;\n        \n        tmp = this.buf[11];\n        this.buf[11] = this.buf[14];\n        this.buf[14] = tmp;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.invert = function()\n    {\n        // Calculate the 4x4 determinant\n        // If the determinant is zero, \n        // then the inverse matrix is not unique.\n        var det = this._determinant4x4();\n\n        if (Math.abs(det) < 1e-8)\n            return null;\n\n        this._makeAdjoint();\n\n        // Scale the adjoint matrix to get the inverse\n        this.buf[0] /= det;\n        this.buf[1] /= det;\n        this.buf[2] /= det;\n        this.buf[3] /= det;\n        \n        this.buf[4] /= det;\n        this.buf[5] /= det;\n        this.buf[6] /= det;\n        this.buf[7] /= det;\n        \n        this.buf[8] /= det;\n        this.buf[9] /= det;\n        this.buf[10] /= det;\n        this.buf[11] /= det;\n        \n        this.buf[12] /= det;\n        this.buf[13] /= det;\n        this.buf[14] /= det;\n        this.buf[15] /= det;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.translate = function(x,y,z)\n    {\n        if(Array.isArray(x)|| x instanceof Float32Array) {\n            y = x[1]; z = x[2]; x = x[0];\n        }\n        if (x == undefined)\n            x = 0;\n            if (y == undefined)\n                y = 0;\n        if (z == undefined)\n            z = 0;\n        \n    //    this.initmatrix()\n    //    this.matrix.buf[12] = x;\n    //    this.matrix.buf[13] = y;\n    //    this.matrix.buf[14] = z;\n    //    this.multRight(this.matrix);\n        this.buf[12] += x;\n        this.buf[13] += y;\n        this.buf[14] += z;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.scale = function(x,y,z)\n    {\n        if(Array.isArray(x)|| x instanceof Float32Array) {\n            y = x[1]; z = x[2]; x = x[0];\n        }\n        if (x == undefined)\n            x = 1;\n        if (z == undefined) {\n            if (y == undefined) {\n                y = x;\n                z = x;\n            }\n            else\n                z = 1;\n        }\n        else if (y == undefined)\n            y = x;\n        \n    //    this.initmatrix()\n    //    this.matrix.buf[0] = x;\n    //    this.matrix.buf[5] = y;\n    //    this.matrix.buf[10] = z;\n    //    this.multRight(this.matrix);\n        \n        this.buf[0] *= x ; this.buf[1] *= x ; this.buf[2] *= x ;\n        this.buf[4] *= y ; this.buf[5] *= y ; this.buf[6] *= y ;\n        this.buf[8] *= z ; this.buf[9] *= z ; this.buf[10] *= z ;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.rotate = function(angle,x,y,z)\n    {\n        if(angle==0) return this \n        if(Array.isArray(x)|| x instanceof Float32Array) {\n            y = x[1]; z = x[2]; x = x[0];\n        }\n        // angles are in degrees. Switch to radians\n        angle = angle * CanvasMatrix4.RAD ;\n        \n        angle /= 2;\n        var sinA = Math.sin(angle);\n        var cosA = Math.cos(angle);\n        var sinA2 = sinA * sinA;\n     \n        this.initmatrix()\n\n        // optimize case where axis is along major axis\n        if (x == 1 && y == 0 && z == 0) {\n            this.matrix.buf[5] = 1 - 2 * sinA2;\n            this.matrix.buf[6] = 2 * sinA * cosA;\n            this.matrix.buf[9] = -2 * sinA * cosA;\n            this.matrix.buf[10] = 1 - 2 * sinA2;\n        } else if (x == 0 && y == 1 && z == 0) {\n            this.matrix.buf[0] = 1 - 2 * sinA2;\n            this.matrix.buf[2] = -2 * sinA * cosA;\n            this.matrix.buf[8] = 2 * sinA * cosA;\n            this.matrix.buf[10] = 1 - 2 * sinA2;\n        } else if (x == 0 && y == 0 && z == 1) {\n            this.matrix.buf[0] = 1 - 2 * sinA2;\n            this.matrix.buf[1] = 2 * sinA * cosA;\n            this.matrix.buf[4] = -2 * sinA * cosA;\n            this.matrix.buf[5] = 1 - 2 * sinA2;\n        } else {\n            // normalize\n            var length = Math.hypot(x,y,z);\n            if (length == 0) {\n                // bad vector, just use something reasonable\n                x = 0;\n                y = 0;\n                z = 1;\n            } else if (length != 1) {\n                x /= length;\n                y /= length;\n                z /= length;\n            }\n            var x2 = x*x;\n            var y2 = y*y;\n            var z2 = z*z;\n        \n            this.matrix.buf[0] = 1 - 2 * (y2 + z2) * sinA2;\n            this.matrix.buf[1] = 2 * (x * y * sinA2 + z * sinA * cosA);\n            this.matrix.buf[2] = 2 * (x * z * sinA2 - y * sinA * cosA);\n            this.matrix.buf[4] = 2 * (y * x * sinA2 - z * sinA * cosA);\n            this.matrix.buf[5] = 1 - 2 * (z2 + x2) * sinA2;\n            this.matrix.buf[6] = 2 * (y * z * sinA2 + x * sinA * cosA);\n            this.matrix.buf[8] = 2 * (z * x * sinA2 + y * sinA * cosA);\n            this.matrix.buf[9] = 2 * (z * y * sinA2 - x * sinA * cosA);\n            this.matrix.buf[10] = 1 - 2 * (x2 + y2) * sinA2;\n        }\n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.multRight = function(matrix)\n    {\n        var m11 = (this.buf[0] * matrix.buf[0] + this.buf[1] * matrix.buf[4]\n                   + this.buf[2] * matrix.buf[8] + this.buf[3] * matrix.buf[12]);\n        var m12 = (this.buf[0] * matrix.buf[1] + this.buf[1] * matrix.buf[5]\n                   + this.buf[2] * matrix.buf[9] + this.buf[3] * matrix.buf[13]);\n        var m13 = (this.buf[0] * matrix.buf[2] + this.buf[1] * matrix.buf[6]\n                   + this.buf[2] * matrix.buf[10] + this.buf[3] * matrix.buf[14]);\n        var m14 = (this.buf[0] * matrix.buf[3] + this.buf[1] * matrix.buf[7]\n                   + this.buf[2] * matrix.buf[11] + this.buf[3] * matrix.buf[15]);\n\n        var m21 = (this.buf[4] * matrix.buf[0] + this.buf[5] * matrix.buf[4]\n                   + this.buf[6] * matrix.buf[8] + this.buf[7] * matrix.buf[12]);\n        var m22 = (this.buf[4] * matrix.buf[1] + this.buf[5] * matrix.buf[5]\n                   + this.buf[6] * matrix.buf[9] + this.buf[7] * matrix.buf[13]);\n        var m23 = (this.buf[4] * matrix.buf[2] + this.buf[5] * matrix.buf[6]\n                   + this.buf[6] * matrix.buf[10] + this.buf[7] * matrix.buf[14]);\n        var m24 = (this.buf[4] * matrix.buf[3] + this.buf[5] * matrix.buf[7]\n                   + this.buf[6] * matrix.buf[11] + this.buf[7] * matrix.buf[15]);\n\n        var m31 = (this.buf[8] * matrix.buf[0] + this.buf[9] * matrix.buf[4]\n                   + this.buf[10] * matrix.buf[8] + this.buf[11] * matrix.buf[12]);\n        var m32 = (this.buf[8] * matrix.buf[1] + this.buf[9] * matrix.buf[5]\n                   + this.buf[10] * matrix.buf[9] + this.buf[11] * matrix.buf[13]);\n        var m33 = (this.buf[8] * matrix.buf[2] + this.buf[9] * matrix.buf[6]\n                   + this.buf[10] * matrix.buf[10] + this.buf[11] * matrix.buf[14]);\n        var m34 = (this.buf[8] * matrix.buf[3] + this.buf[9] * matrix.buf[7]\n                   + this.buf[10] * matrix.buf[11] + this.buf[11] * matrix.buf[15]);\n\n        var m41 = (this.buf[12] * matrix.buf[0] + this.buf[13] * matrix.buf[4]\n                   + this.buf[14] * matrix.buf[8] + this.buf[15] * matrix.buf[12]);\n        var m42 = (this.buf[12] * matrix.buf[1] + this.buf[13] * matrix.buf[5]\n                   + this.buf[14] * matrix.buf[9] + this.buf[15] * matrix.buf[13]);\n        var m43 = (this.buf[12] * matrix.buf[2] + this.buf[13] * matrix.buf[6]\n                   + this.buf[14] * matrix.buf[10] + this.buf[15] * matrix.buf[14]);\n        var m44 = (this.buf[12] * matrix.buf[3] + this.buf[13] * matrix.buf[7]\n                   + this.buf[14] * matrix.buf[11] + this.buf[15] * matrix.buf[15]);\n        \n        this.buf[0] = m11;\n        this.buf[1] = m12;\n        this.buf[2] = m13;\n        this.buf[3] = m14;\n        \n        this.buf[4] = m21;\n        this.buf[5] = m22;\n        this.buf[6] = m23;\n        this.buf[7] = m24;\n        \n        this.buf[8] = m31;\n        this.buf[9] = m32;\n        this.buf[10] = m33;\n        this.buf[11] = m34;\n        \n        this.buf[12] = m41;\n        this.buf[13] = m42;\n        this.buf[14] = m43;\n        this.buf[15] = m44;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.multLeft = function(matrix)\n    {\n        var m11 = (matrix.buf[0] * this.buf[0] + matrix.buf[1] * this.buf[4]\n                   + matrix.buf[2] * this.buf[8] + matrix.buf[3] * this.buf[12]);\n        var m12 = (matrix.buf[0] * this.buf[1] + matrix.buf[1] * this.buf[5]\n                   + matrix.buf[2] * this.buf[9] + matrix.buf[3] * this.buf[13]);\n        var m13 = (matrix.buf[0] * this.buf[2] + matrix.buf[1] * this.buf[6]\n                   + matrix.buf[2] * this.buf[10] + matrix.buf[3] * this.buf[14]);\n        var m14 = (matrix.buf[0] * this.buf[3] + matrix.buf[1] * this.buf[7]\n                   + matrix.buf[2] * this.buf[11] + matrix.buf[3] * this.buf[15]);\n\n        var m21 = (matrix.buf[4] * this.buf[0] + matrix.buf[5] * this.buf[4]\n                   + matrix.buf[6] * this.buf[8] + matrix.buf[7] * this.buf[12]);\n        var m22 = (matrix.buf[4] * this.buf[1] + matrix.buf[5] * this.buf[5]\n                   + matrix.buf[6] * this.buf[9] + matrix.buf[7] * this.buf[13]);\n        var m23 = (matrix.buf[4] * this.buf[2] + matrix.buf[5] * this.buf[6]\n                   + matrix.buf[6] * this.buf[10] + matrix.buf[7] * this.buf[14]);\n        var m24 = (matrix.buf[4] * this.buf[3] + matrix.buf[5] * this.buf[7]\n                   + matrix.buf[6] * this.buf[11] + matrix.buf[7] * this.buf[15]);\n\n        var m31 = (matrix.buf[8] * this.buf[0] + matrix.buf[9] * this.buf[4]\n                   + matrix.buf[10] * this.buf[8] + matrix.buf[11] * this.buf[12]);\n        var m32 = (matrix.buf[8] * this.buf[1] + matrix.buf[9] * this.buf[5]\n                   + matrix.buf[10] * this.buf[9] + matrix.buf[11] * this.buf[13]);\n        var m33 = (matrix.buf[8] * this.buf[2] + matrix.buf[9] * this.buf[6]\n                   + matrix.buf[10] * this.buf[10] + matrix.buf[11] * this.buf[14]);\n        var m34 = (matrix.buf[8] * this.buf[3] + matrix.buf[9] * this.buf[7]\n                   + matrix.buf[10] * this.buf[11] + matrix.buf[11] * this.buf[15]);\n\n        var m41 = (matrix.buf[12] * this.buf[0] + matrix.buf[13] * this.buf[4]\n                   + matrix.buf[14] * this.buf[8] + matrix.buf[15] * this.buf[12]);\n        var m42 = (matrix.buf[12] * this.buf[1] + matrix.buf[13] * this.buf[5]\n                   + matrix.buf[14] * this.buf[9] + matrix.buf[15] * this.buf[13]);\n        var m43 = (matrix.buf[12] * this.buf[2] + matrix.buf[13] * this.buf[6]\n                   + matrix.buf[14] * this.buf[10] + matrix.buf[15] * this.buf[14]);\n        var m44 = (matrix.buf[12] * this.buf[3] + matrix.buf[13] * this.buf[7]\n                   + matrix.buf[14] * this.buf[11] + matrix.buf[15] * this.buf[15]);\n        \n        this.buf[0] = m11;\n        this.buf[1] = m12;\n        this.buf[2] = m13;\n        this.buf[3] = m14;\n\n        this.buf[4] = m21;\n        this.buf[5] = m22;\n        this.buf[6] = m23;\n        this.buf[7] = m24;\n\n        this.buf[8] = m31;\n        this.buf[9] = m32;\n        this.buf[10] = m33;\n        this.buf[11] = m34;\n\n        this.buf[12] = m41;\n        this.buf[13] = m42;\n        this.buf[14] = m43;\n        this.buf[15] = m44;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.ortho = function(left, right, bottom, top, near, far)\n    {\n        var tx = (left + right) / (right - left);\n        var ty = (top + bottom) / (top - bottom);\n        var tz = (far + near) / (far - near);\n        \n        this.initmatrix()\n        this.matrix.buf[0] = 2 / (right - left);\n        this.matrix.buf[5] = 2 / (top - bottom);\n        this.matrix.buf[10] = -2 / (far - near);\n        this.matrix.buf[12] = tx;\n        this.matrix.buf[13] = ty;\n        this.matrix.buf[14] = -tz;\n        \n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.frustum = function(left, right, bottom, top, near, far)\n    {\n        this.initmatrix()\n        var A = (right + left) / (right - left);\n        var B = (top + bottom) / (top - bottom);\n        var C = -(far + near) / (far - near);\n        var D = -(2 * far * near) / (far - near);\n        \n        this.matrix.buf[0] = (2 * near) / (right - left);\n        \n        this.matrix.buf[5] = 2 * near / (top - bottom);\n        \n        this.matrix.buf[8] = A;\n        this.matrix.buf[9] = B;\n        this.matrix.buf[10] = C;\n        this.matrix.buf[11] = -1;\n        \n        this.matrix.buf[14] = D;\n        this.matrix.buf[15] = 0;\n        \n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.perspective = function(fovy, aspect, zNear, zFar)\n    {\n        var top = Math.tan(fovy * Math.PI / 360) * zNear;\n        var bottom = -top;\n        var left = aspect * bottom;\n        var right = aspect * top;\n        this.frustum(left, right, bottom, top, zNear, zFar);\n        return this ;\n    }\n    CanvasMatrix4.prototype.pallarel = function(width, aspect, zNear, zFar)\n    {\n        var right = width/2;\n        var left = -right;\n        var top = right / aspect ;\n        var bottom = -top ;\n        this.ortho(left, right, bottom, top, zNear, zFar);\n        return this ;\n    }\n    CanvasMatrix4.prototype.lookat = function(eyex, eyey, eyez, centerx, centery, centerz, upx, upy, upz)\n    {\n        this.initmatrix()\n        \n        // Make rotation matrix\n\n        // Z vector\n        var zx = eyex - centerx;\n        var zy = eyey - centery;\n        var zz = eyez - centerz;\n        var mag = Math.hypot(zx,zy,zz);\n        if (mag) {\n            zx /= mag;\n            zy /= mag;\n            zz /= mag;\n        }\n\n        // X vector = Y cross Z\n        xx =  upy * zz - upz * zy;\n        xy = -upx * zz + upz * zx;\n        xz =  upx * zy - upy * zx;\n\n        // Recompute Y = Z cross X\n        yx = zy * xz - zz * xy;\n        yy = -zx * xz + zz * xx;\n        yz = zx * xy - zy * xx;\n\n        // cross product gives area of parallelogram, which is < 1.0 for\n        // non-perpendicular unit-length vectors; so normalize x, y here\n\n        mag = Math.hypot(xx,xy,xz);\n        if (mag) {\n            xx /= mag;\n            xy /= mag;\n            xz /= mag;\n        }\n\n        mag = Math.hypot(yx,yy,yz);\n        if (mag) {\n            yx /= mag;\n            yy /= mag;\n            yz /= mag;\n        }\n\n        this.matrix.buf[0] = xx;\n        this.matrix.buf[1] = yx;\n        this.matrix.buf[2] = zx;\n        \n        this.matrix.buf[4] = xy;\n        this.matrix.buf[5] = yy;\n        this.matrix.buf[6] = zy;\n        \n        this.matrix.buf[8] = xz;\n        this.matrix.buf[9] = yz;\n        this.matrix.buf[10] = zz;\n        \n        this.matrix.buf[12] = -(xx * eyex + xy * eyey + xz * eyez);\n        this.matrix.buf[13] = -(yx * eyex + yy * eyey + yz * eyez);\n        this.matrix.buf[14] = -(zx * eyex + zy * eyey + zz * eyez);\n     //   matrix.translate(-eyex, -eyey, -eyez);\n        \n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    // Support functions\n    CanvasMatrix4.prototype._determinant2x2 = function(a, b, c, d)\n    {\n        return a * d - b * c;\n    }\n\n    CanvasMatrix4.prototype._determinant3x3 = function(a1, a2, a3, b1, b2, b3, c1, c2, c3)\n    {\n        return a1 * this._determinant2x2(b2, b3, c2, c3)\n             - b1 * this._determinant2x2(a2, a3, c2, c3)\n             + c1 * this._determinant2x2(a2, a3, b2, b3);\n    }\n\n    CanvasMatrix4.prototype._determinant4x4 = function()\n    {\n        var a1 = this.buf[0];\n        var b1 = this.buf[1]; \n        var c1 = this.buf[2];\n        var d1 = this.buf[3];\n\n        var a2 = this.buf[4];\n        var b2 = this.buf[5]; \n        var c2 = this.buf[6];\n        var d2 = this.buf[7];\n\n        var a3 = this.buf[8];\n        var b3 = this.buf[9]; \n        var c3 = this.buf[10];\n        var d3 = this.buf[11];\n\n        var a4 = this.buf[12];\n        var b4 = this.buf[13]; \n        var c4 = this.buf[14];\n        var d4 = this.buf[15];\n\n        return a1 * this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4)\n             - b1 * this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4)\n             + c1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4)\n             - d1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\n    }\n\n    CanvasMatrix4.prototype._makeAdjoint = function()\n    {\n        var a1 = this.buf[0];\n        var b1 = this.buf[1]; \n        var c1 = this.buf[2];\n        var d1 = this.buf[3];\n\n        var a2 = this.buf[4];\n        var b2 = this.buf[5]; \n        var c2 = this.buf[6];\n        var d2 = this.buf[7];\n\n        var a3 = this.buf[8];\n        var b3 = this.buf[9]; \n        var c3 = this.buf[10];\n        var d3 = this.buf[11];\n\n        var a4 = this.buf[12];\n        var b4 = this.buf[13]; \n        var c4 = this.buf[14];\n        var d4 = this.buf[15];\n\n        // Row column labeling reversed since we transpose rows & columns\n        this.buf[0]  =   this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\n        this.buf[4]  = - this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\n        this.buf[8]  =   this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\n        this.buf[12]  = - this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\n            \n        this.buf[1]  = - this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\n        this.buf[5]  =   this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\n        this.buf[9]  = - this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\n        this.buf[13]  =   this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\n            \n        this.buf[2]  =   this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\n        this.buf[6]  = - this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\n        this.buf[10]  =   this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\n        this.buf[14]  = - this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\n            \n        this.buf[3]  = - this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\n        this.buf[7]  =   this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\n        this.buf[11]  = - this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\n        this.buf[15]  =   this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\n    }\n\n    ////utils \n    //vec3 operations\n        CanvasMatrix4.V3add = function() {\n            let x=0,y=0,z=0 ;\n            for(let i=0;i<arguments.length;i++) {\n                x += arguments[i][0] ;y += arguments[i][1] ;z += arguments[i][2] ;\n            }\n            return [x,y,z] ;\n        }\n        CanvasMatrix4.V3sub = function() {\n            let x=arguments[0][0],y=arguments[0][1],z=arguments[0][2] ;\n            for(let i=1;i<arguments.length;i++) {\n                x -= arguments[i][0] ;y -= arguments[i][1] ;z -= arguments[i][2] ;\n            }\n            return [x,y,z] ;\n        }\n        CanvasMatrix4.V3inv = function(v) {\n            return [-v[0],-v[1],-v[2]] ;\n        }\n        CanvasMatrix4.V3len = function(v) {\n            return Math.hypot(v[0],v[1],v[2]) ;\n        }\n        CanvasMatrix4.V3norm = function(v,s) {\n            const l = CanvasMatrix4.V3len(v) ;\n            if(s===undefined) s = 1 ;\n            return (l==0)?[0,0,0]:[v[0]*s/l,v[1]*s/l,v[2]*s/l] ;\n        }\n        CanvasMatrix4.V3mult = function(v,s) {\n            return [v[0]*s,v[1]*s,v[2]*s] ;\n        }\n        CanvasMatrix4.V3dot = function(v1,v2) {\n            return v1[0]*v2[0]+v1[1]*v2[1]+v1[2]*v2[2] ;\n        }\n        CanvasMatrix4.V3cross = function(v1,v2) {\n            return [    \n                v1[1]*v2[2] - v1[2] * v2[1],\n                v1[2]*v2[0] - v1[0] * v2[2],\n                v1[0]*v2[1] - v1[1] * v2[0] \n            ]\n        }\n\n    //multiple vector\n    CanvasMatrix4.prototype.multVec4 = function(x,y,z,w) {\n        if(Array.isArray(x)|| x instanceof Float32Array) {\n            y = x[1]; z = x[2];w=x[3]; x = x[0];\n        }\n        var xx = this.buf[0]*x + this.buf[4]*y + this.buf[8]*z + this.buf[12]*w ;\n        var yy = this.buf[1]*x + this.buf[5]*y + this.buf[9]*z + this.buf[13]*w ;\n        var zz = this.buf[2]*x + this.buf[6]*y + this.buf[10]*z + this.buf[14]*w ;\n        var ww = this.buf[3]*x + this.buf[7]*y + this.buf[11]*z + this.buf[15]*w ;\n        return [xx,yy,zz,ww] ;\n    }\n\n    //shorthand class method \n    CanvasMatrix4.rotAndTrans = function(rx,ry,rz,tx,ty,tz) {\n        var m = new CanvasMatrix4()\n        if(rx!=0) m.rotate(rx,1,0,0) \n        if(ry!=0) m.rotate(ry,0,1,0)\n        if(rz!=0) m.rotate(rz,0,0,1)\n        m.translate(tx,ty,tz)\n        return m \n    }\n\n    //quaternion to matrix\n    CanvasMatrix4.prototype.q2m = function(x,y,z,w) {\n        if(Array.isArray(x) || x instanceof Float32Array) {\n            y = x[1]; z = x[2];w=x[3]; x = x[0];\n        }\n        var x2 = x*x; var y2=y*y; var z2=z*z ;\n        this.buf[0] = 1- 2*(y2 + z2) ;\n        this.buf[1] = 2*(x*y + w*z) ;\n        this.buf[2] = 2*(x*z - w*y) ;\n        this.buf[3] = 0 ;\n        this.buf[4] = 2*(x*y - w*z) ;\n        this.buf[5] = 1-2*(x2 + z2) ;\n        this.buf[6] = 2*(y*z + w*x) ;\n        this.buf[7] = 0 ;\n        this.buf[8] = 2*(x*z + w*y) ;\n        this.buf[9] = 2*(y*z - w*x) ;\n        this.buf[10] = 1-2*(x2 + y2) ;\n        this.buf[11] = 0 ; this.buf[12]=0; this.buf[13]=0; this.buf[14]=0;this.buf[15]=1;\n        return this \n    }\n    CanvasMatrix4.v2q = function(rot,x,y,z) {\n        if(Array.isArray(x) || x instanceof Float32Array) {\n            y = x[1]; z = x[2]; x = x[0];\n        }\n        let l = x*x + y*y + z*z \n        if(l==0) return [0,0,0,1]\n        if(l!=1) {\n            l = Math.sqrt(l) \n            x /= l ; y /=l ; z /= l\n        }\n        rot = rot *CanvasMatrix4.RAD /2 \n        let sr = Math.sin(rot) \n        return [x*sr,y*sr,z*sr,Math.cos(rot)]\n    }\n    CanvasMatrix4.e2q = function(x,y,z) {\n        if(Array.isArray(x) || x instanceof Float32Array) {\n            y = x[1]; z = x[2]; x = x[0];\n        }\n        x *= CanvasMatrix4.RAD*0.5\n        y *= CanvasMatrix4.RAD*0.5\n        z *= CanvasMatrix4.RAD*0.5\n        let c1 = Math.cos(x),c2=Math.cos(y),c3=Math.cos(z)\n        let s1 = Math.sin(x),s2=Math.sin(y),s3=Math.sin(z)\n        // order YXZ\n        let qx = s1 * c2 * c3 + c1 * s2 * s3;\n        let qy = c1 * s2 * c3 - s1 * c2 * s3;\n        let qz = c1 * c2 * s3 - s1 * s2 * c3;\n        let qw = c1 * c2 * c3 + s1 * s2 * s3;\n        return [qx,qy,qz,qw]\n    }\n    CanvasMatrix4.qMult = function(q1,q2) {\n        let w = q1[3] * q2[3] -(q1[0]*q2[0]+q1[1]*q2[1]+q1[2]*q2[2])\n        let x = q1[1]*q2[2] - q1[2] * q2[1] + q1[3]*q2[0] + q2[3]*q1[0]\n        let y = q1[2]*q2[0] - q1[0] * q2[2] + q1[3]*q2[1] + q2[3]*q1[1]\n        let z = q1[0]*q2[1] - q1[1] * q2[0] + q1[3]*q2[2] + q2[3]*q1[2]\n        return [x,y,z,w]    \n    }\n\n    return pox.CanvasMatrix4 = CanvasMatrix4;\n});\n    \t\n\n"]}