{"version":3,"sources":["CanvasMatrix4.js"],"names":["define","poxp","CanvasMatrix4","m","undefined","name","this","buf","Float32Array","matrix","length","load","makeIdentity","RAD","Math","PI","prototype","arguments","getAsArray","getAsWebGLFloatArray","initmatrix","transpose","tmp","invert","det","_determinant4x4","abs","_makeAdjoint","translate","x","y","z","Array","isArray","scale","rotate","angle","sinA","sin","cosA","cos","sinA2","hypot","x2","y2","z2","multRight","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","multLeft","ortho","left","right","bottom","top","near","far","tx","ty","tz","frustum","A","B","C","D","perspective","fovy","aspect","zNear","zFar","tan","pallarel","width","lookat","eyex","eyey","eyez","centerx","centery","centerz","upx","upy","upz","zx","zy","zz","mag","xx","xy","xz","yx","yy","yz","_determinant2x2","a","b","c","d","_determinant3x3","a1","a2","a3","b1","b2","b3","c1","c2","c3","d1","d2","d3","a4","b4","c4","d4","V3add","i","V3sub","V3inv","v","V3len","V3norm","s","l","V3mult","V3dot","v1","v2","V3cross","multVec4","w","rotAndTrans","rx","ry","rz","q2m","v2q","rot","sqrt","sr","e2q","s1","s2","s3","qMult","q1","q2"],"mappings":"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","file":"../CanvasMatrix4.js","sourcesContent":["define([\n    \"./poxp\"\n],function(poxp){\n    /*\n     * Copyright (C) 2009 Apple Inc. All Rights Reserved.\n     *\n     * Redistribution and use in source and binary forms, with or without\n     * modification, are permitted provided that the following conditions\n     * are met:\n     * 1. Redistributions of source code must retain the above copyright\n     *    notice, this list of conditions and the following disclaimer.\n     * 2. Redistributions in binary form must reproduce the above copyright\n     *    notice, this list of conditions and the following disclaimer in the\n     *    documentation and/or other materials provided with the distribution.\n     *\n     * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY\n     * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n     * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n     * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR\n     * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n     * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n     * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n     * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n     * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n     * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n     * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. \n     */\n    /* modified by wakufactory */\n    /*\n        CanvasMatrix4 class\n        \n        This class implements a 4x4 matrix. It has functions which\n        duplicate the functionality of the OpenGL matrix stack and\n        glut functions.\n        \n        IDL:\n        \n        [\n            Constructor(in CanvasMatrix4 matrix),           // copy passed matrix into new CanvasMatrix4\n            Constructor(in sequence<float> array)           // create new CanvasMatrix4 with 16 floats (row major)\n            Constructor()                                   // create new CanvasMatrix4 with identity matrix\n        ]\n        interface CanvasMatrix4 {\n            attribute float buf[16]\n\n            void load(in CanvasMatrix4 matrix);                 // copy the values from the passed matrix\n            void load(in sequence<float> array);                // copy 16 floats into the matrix\n            sequence<float> getAsArray();                       // return the matrix as an array of 16 floats\n            WebGLFloatArray getAsWebGLFloatArray();           // return the matrix as a WebGLFloatArray with 16 values\n            void makeIdentity();                                // replace the matrix with identity\n            void transpose();                                   // replace the matrix with its transpose\n            void invert();                                      // replace the matrix with its inverse\n            \n            void translate(in float x, in float y, in float z); // multiply the matrix by passed translation values on the right\n            void scale(in float x, in float y, in float z);     // multiply the matrix by passed scale values on the right\n            void rotate(in float angle,                         // multiply the matrix by passed rotation values on the right\n                        in float x, in float y, in float z);    // (angle is in degrees)\n            void multRight(in CanvasMatrix matrix);             // multiply the matrix by the passed matrix on the right\n            void multLeft(in CanvasMatrix matrix);              // multiply the matrix by the passed matrix on the left\n            void ortho(in float left, in float right,           // multiply the matrix by the passed ortho values on the right\n                       in float bottom, in float top, \n                       in float near, in float far);\n            void frustum(in float left, in float right,         // multiply the matrix by the passed frustum values on the right\n                         in float bottom, in float top, \n                         in float near, in float far);\n            void perspective(in float fovy, in float aspect,    // multiply the matrix by the passed perspective values on the right\n                             in float zNear, in float zFar);\n            void lookat(in float eyex, in float eyey, in float eyez,    // multiply the matrix by the passed lookat \n                        in float ctrx, in float ctry, in float ctrz,    // values on the right\n                        in float upx, in float upy, in float upz);\n        }\n    */\n\n    var CanvasMatrix4 = function(m) {\n    \tif(m!=undefined && m.name == \"Float32Array\") {\n    \t\tthis.buf = m ;\n    \t\treturn this ;\n    \t}\n    \tthis.buf = new Float32Array(16)\n    \tthis.matrix = null\n        if (typeof m == 'object') {\n            if (\"length\" in m && m.length >= 16) {\n                this.load(m);\n                return this;\n            }\n            else if (m instanceof CanvasMatrix4) {\n                this.load(m);\n                return this;\n            }\n        }\n        this.makeIdentity();\n        return this ;\n    }\n    CanvasMatrix4.RAD = Math.PI / 180 \n    CanvasMatrix4.prototype.load = function()\n    {\n        if (arguments.length == 1 && typeof arguments[0] == 'object') {\n            var matrix = arguments[0];\n            \n            if (\"length\" in matrix && matrix.length == 16) {\n                this.buf[0] = matrix[0];\n                this.buf[1] = matrix[1];\n                this.buf[2] = matrix[2];\n                this.buf[3] = matrix[3];\n\n                this.buf[4] = matrix[4];\n                this.buf[5] = matrix[5];\n                this.buf[6] = matrix[6];\n                this.buf[7] = matrix[7];\n\n                this.buf[8] = matrix[8];\n                this.buf[9] = matrix[9];\n                this.buf[10] = matrix[10];\n                this.buf[11] = matrix[11];\n\n                this.buf[12] = matrix[12];\n                this.buf[13] = matrix[13];\n                this.buf[14] = matrix[14];\n                this.buf[15] = matrix[15];\n                return this ;\n            }\n                \n            if (arguments[0] instanceof CanvasMatrix4) {\n            \n                this.buf[0] = matrix.buf[0];\n                this.buf[1] = matrix.buf[1];\n                this.buf[2] = matrix.buf[2];\n                this.buf[3] = matrix.buf[3];\n\n                this.buf[4] = matrix.buf[4];\n                this.buf[5] = matrix.buf[5];\n                this.buf[6] = matrix.buf[6];\n                this.buf[7] = matrix.buf[7];\n\n                this.buf[8] = matrix.buf[8];\n                this.buf[9] = matrix.buf[9];\n                this.buf[10] = matrix.buf[10];\n                this.buf[11] = matrix.buf[11];\n\n                this.buf[12] = matrix.buf[12];\n                this.buf[13] = matrix.buf[13];\n                this.buf[14] = matrix.buf[14];\n                this.buf[15] = matrix.buf[15];\n                return this ;\n            }\n        }\n        \n        this.makeIdentity();\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.getAsArray = function()\n    {\n        return [\n            this.buf[0], this.buf[1], this.buf[2], this.buf[3], \n            this.buf[4], this.buf[5], this.buf[6], this.buf[7], \n            this.buf[8], this.buf[9], this.buf[10], this.buf[11], \n            this.buf[12], this.buf[13], this.buf[14], this.buf[15]\n        ];\n    }\n\n    CanvasMatrix4.prototype.getAsWebGLFloatArray = function()\n    {\n        return this.buf\n    }\n    CanvasMatrix4.prototype.initmatrix = function() {\n    \tif(!this.matrix) this.matrix = new CanvasMatrix4 \n    \tthis.matrix.makeIdentity() \n        return this ;\n    }\n    CanvasMatrix4.prototype.makeIdentity = function()\n    {\n        this.buf[0] = 1;\n        this.buf[1] = 0;\n        this.buf[2] = 0;\n        this.buf[3] = 0;\n        \n        this.buf[4] = 0;\n        this.buf[5] = 1;\n        this.buf[6] = 0;\n        this.buf[7] = 0;\n        \n        this.buf[8] = 0;\n        this.buf[9] = 0;\n        this.buf[10] = 1;\n        this.buf[11] = 0;\n        \n        this.buf[12] = 0;\n        this.buf[13] = 0;\n        this.buf[14] = 0;\n        this.buf[15] = 1;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.transpose = function()\n    {\n        var tmp = this.buf[1];\n        this.buf[1] = this.buf[4];\n        this.buf[4] = tmp;\n        \n        tmp = this.buf[2];\n        this.buf[2] = this.buf[8];\n        this.buf[8] = tmp;\n        \n        tmp = this.buf[3];\n        this.buf[3] = this.buf[12];\n        this.buf[12] = tmp;\n        \n        tmp = this.buf[6];\n        this.buf[6] = this.buf[9];\n        this.buf[9] = tmp;\n        \n        tmp = this.buf[7];\n        this.buf[7] = this.buf[13];\n        this.buf[13] = tmp;\n        \n        tmp = this.buf[11];\n        this.buf[11] = this.buf[14];\n        this.buf[14] = tmp;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.invert = function()\n    {\n        // Calculate the 4x4 determinant\n        // If the determinant is zero, \n        // then the inverse matrix is not unique.\n        var det = this._determinant4x4();\n\n        if (Math.abs(det) < 1e-32)\n            return null;\n\n        this._makeAdjoint();\n\n        // Scale the adjoint matrix to get the inverse\n        this.buf[0] /= det;\n        this.buf[1] /= det;\n        this.buf[2] /= det;\n        this.buf[3] /= det;\n        \n        this.buf[4] /= det;\n        this.buf[5] /= det;\n        this.buf[6] /= det;\n        this.buf[7] /= det;\n        \n        this.buf[8] /= det;\n        this.buf[9] /= det;\n        this.buf[10] /= det;\n        this.buf[11] /= det;\n        \n        this.buf[12] /= det;\n        this.buf[13] /= det;\n        this.buf[14] /= det;\n        this.buf[15] /= det;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.translate = function(x,y,z)\n    {\n    \tif(Array.isArray(x)|| x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2]; x = x[0];\n    \t}\n        if (x == undefined)\n            x = 0;\n            if (y == undefined)\n                y = 0;\n        if (z == undefined)\n            z = 0;\n        \n    //    this.initmatrix()\n    //    this.matrix.buf[12] = x;\n    //    this.matrix.buf[13] = y;\n    //    this.matrix.buf[14] = z;\n    //    this.multRight(this.matrix);\n        this.buf[12] += x;\n        this.buf[13] += y;\n        this.buf[14] += z;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.scale = function(x,y,z)\n    {\n    \tif(Array.isArray(x)|| x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2]; x = x[0];\n    \t}\n        if (x == undefined)\n            x = 1;\n        if (z == undefined) {\n            if (y == undefined) {\n                y = x;\n                z = x;\n            }\n            else\n                z = 1;\n        }\n        else if (y == undefined)\n            y = x;\n        \n    //    this.initmatrix()\n    //    this.matrix.buf[0] = x;\n    //    this.matrix.buf[5] = y;\n    //    this.matrix.buf[10] = z;\n    //    this.multRight(this.matrix);\n        \n        this.buf[0] *= x ; this.buf[1] *= x ; this.buf[2] *= x ;\n        this.buf[4] *= y ; this.buf[5] *= y ; this.buf[6] *= y ;\n        this.buf[8] *= z ; this.buf[9] *= z ; this.buf[10] *= z ;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.rotate = function(angle,x,y,z)\n    {\n        if(angle==0) return this \n     \tif(Array.isArray(x)|| x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2]; x = x[0];\n    \t}\n        // angles are in degrees. Switch to radians\n        angle = angle * CanvasMatrix4.RAD ;\n        \n        angle /= 2;\n        var sinA = Math.sin(angle);\n        var cosA = Math.cos(angle);\n        var sinA2 = sinA * sinA;\n     \n        this.initmatrix()\n\n        // optimize case where axis is along major axis\n        if (x == 1 && y == 0 && z == 0) {\n            this.matrix.buf[5] = 1 - 2 * sinA2;\n            this.matrix.buf[6] = 2 * sinA * cosA;\n            this.matrix.buf[9] = -2 * sinA * cosA;\n            this.matrix.buf[10] = 1 - 2 * sinA2;\n        } else if (x == 0 && y == 1 && z == 0) {\n            this.matrix.buf[0] = 1 - 2 * sinA2;\n            this.matrix.buf[2] = -2 * sinA * cosA;\n            this.matrix.buf[8] = 2 * sinA * cosA;\n            this.matrix.buf[10] = 1 - 2 * sinA2;\n        } else if (x == 0 && y == 0 && z == 1) {\n            this.matrix.buf[0] = 1 - 2 * sinA2;\n            this.matrix.buf[1] = 2 * sinA * cosA;\n            this.matrix.buf[4] = -2 * sinA * cosA;\n            this.matrix.buf[5] = 1 - 2 * sinA2;\n        } else {\n    \t    // normalize\n    \t    var length = Math.hypot(x,y,z);\n    \t    if (length == 0) {\n    \t        // bad vector, just use something reasonable\n    \t        x = 0;\n    \t        y = 0;\n    \t        z = 1;\n    \t    } else if (length != 1) {\n    \t        x /= length;\n    \t        y /= length;\n    \t        z /= length;\n    \t    }\n            var x2 = x*x;\n            var y2 = y*y;\n            var z2 = z*z;\n        \n            this.matrix.buf[0] = 1 - 2 * (y2 + z2) * sinA2;\n            this.matrix.buf[1] = 2 * (x * y * sinA2 + z * sinA * cosA);\n            this.matrix.buf[2] = 2 * (x * z * sinA2 - y * sinA * cosA);\n            this.matrix.buf[4] = 2 * (y * x * sinA2 - z * sinA * cosA);\n            this.matrix.buf[5] = 1 - 2 * (z2 + x2) * sinA2;\n            this.matrix.buf[6] = 2 * (y * z * sinA2 + x * sinA * cosA);\n            this.matrix.buf[8] = 2 * (z * x * sinA2 + y * sinA * cosA);\n            this.matrix.buf[9] = 2 * (z * y * sinA2 - x * sinA * cosA);\n            this.matrix.buf[10] = 1 - 2 * (x2 + y2) * sinA2;\n        }\n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.multRight = function(matrix)\n    {\n        var m11 = (this.buf[0] * matrix.buf[0] + this.buf[1] * matrix.buf[4]\n                   + this.buf[2] * matrix.buf[8] + this.buf[3] * matrix.buf[12]);\n        var m12 = (this.buf[0] * matrix.buf[1] + this.buf[1] * matrix.buf[5]\n                   + this.buf[2] * matrix.buf[9] + this.buf[3] * matrix.buf[13]);\n        var m13 = (this.buf[0] * matrix.buf[2] + this.buf[1] * matrix.buf[6]\n                   + this.buf[2] * matrix.buf[10] + this.buf[3] * matrix.buf[14]);\n        var m14 = (this.buf[0] * matrix.buf[3] + this.buf[1] * matrix.buf[7]\n                   + this.buf[2] * matrix.buf[11] + this.buf[3] * matrix.buf[15]);\n\n        var m21 = (this.buf[4] * matrix.buf[0] + this.buf[5] * matrix.buf[4]\n                   + this.buf[6] * matrix.buf[8] + this.buf[7] * matrix.buf[12]);\n        var m22 = (this.buf[4] * matrix.buf[1] + this.buf[5] * matrix.buf[5]\n                   + this.buf[6] * matrix.buf[9] + this.buf[7] * matrix.buf[13]);\n        var m23 = (this.buf[4] * matrix.buf[2] + this.buf[5] * matrix.buf[6]\n                   + this.buf[6] * matrix.buf[10] + this.buf[7] * matrix.buf[14]);\n        var m24 = (this.buf[4] * matrix.buf[3] + this.buf[5] * matrix.buf[7]\n                   + this.buf[6] * matrix.buf[11] + this.buf[7] * matrix.buf[15]);\n\n        var m31 = (this.buf[8] * matrix.buf[0] + this.buf[9] * matrix.buf[4]\n                   + this.buf[10] * matrix.buf[8] + this.buf[11] * matrix.buf[12]);\n        var m32 = (this.buf[8] * matrix.buf[1] + this.buf[9] * matrix.buf[5]\n                   + this.buf[10] * matrix.buf[9] + this.buf[11] * matrix.buf[13]);\n        var m33 = (this.buf[8] * matrix.buf[2] + this.buf[9] * matrix.buf[6]\n                   + this.buf[10] * matrix.buf[10] + this.buf[11] * matrix.buf[14]);\n        var m34 = (this.buf[8] * matrix.buf[3] + this.buf[9] * matrix.buf[7]\n                   + this.buf[10] * matrix.buf[11] + this.buf[11] * matrix.buf[15]);\n\n        var m41 = (this.buf[12] * matrix.buf[0] + this.buf[13] * matrix.buf[4]\n                   + this.buf[14] * matrix.buf[8] + this.buf[15] * matrix.buf[12]);\n        var m42 = (this.buf[12] * matrix.buf[1] + this.buf[13] * matrix.buf[5]\n                   + this.buf[14] * matrix.buf[9] + this.buf[15] * matrix.buf[13]);\n        var m43 = (this.buf[12] * matrix.buf[2] + this.buf[13] * matrix.buf[6]\n                   + this.buf[14] * matrix.buf[10] + this.buf[15] * matrix.buf[14]);\n        var m44 = (this.buf[12] * matrix.buf[3] + this.buf[13] * matrix.buf[7]\n                   + this.buf[14] * matrix.buf[11] + this.buf[15] * matrix.buf[15]);\n        \n        this.buf[0] = m11;\n        this.buf[1] = m12;\n        this.buf[2] = m13;\n        this.buf[3] = m14;\n        \n        this.buf[4] = m21;\n        this.buf[5] = m22;\n        this.buf[6] = m23;\n        this.buf[7] = m24;\n        \n        this.buf[8] = m31;\n        this.buf[9] = m32;\n        this.buf[10] = m33;\n        this.buf[11] = m34;\n        \n        this.buf[12] = m41;\n        this.buf[13] = m42;\n        this.buf[14] = m43;\n        this.buf[15] = m44;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.multLeft = function(matrix)\n    {\n        var m11 = (matrix.buf[0] * this.buf[0] + matrix.buf[1] * this.buf[4]\n                   + matrix.buf[2] * this.buf[8] + matrix.buf[3] * this.buf[12]);\n        var m12 = (matrix.buf[0] * this.buf[1] + matrix.buf[1] * this.buf[5]\n                   + matrix.buf[2] * this.buf[9] + matrix.buf[3] * this.buf[13]);\n        var m13 = (matrix.buf[0] * this.buf[2] + matrix.buf[1] * this.buf[6]\n                   + matrix.buf[2] * this.buf[10] + matrix.buf[3] * this.buf[14]);\n        var m14 = (matrix.buf[0] * this.buf[3] + matrix.buf[1] * this.buf[7]\n                   + matrix.buf[2] * this.buf[11] + matrix.buf[3] * this.buf[15]);\n\n        var m21 = (matrix.buf[4] * this.buf[0] + matrix.buf[5] * this.buf[4]\n                   + matrix.buf[6] * this.buf[8] + matrix.buf[7] * this.buf[12]);\n        var m22 = (matrix.buf[4] * this.buf[1] + matrix.buf[5] * this.buf[5]\n                   + matrix.buf[6] * this.buf[9] + matrix.buf[7] * this.buf[13]);\n        var m23 = (matrix.buf[4] * this.buf[2] + matrix.buf[5] * this.buf[6]\n                   + matrix.buf[6] * this.buf[10] + matrix.buf[7] * this.buf[14]);\n        var m24 = (matrix.buf[4] * this.buf[3] + matrix.buf[5] * this.buf[7]\n                   + matrix.buf[6] * this.buf[11] + matrix.buf[7] * this.buf[15]);\n\n        var m31 = (matrix.buf[8] * this.buf[0] + matrix.buf[9] * this.buf[4]\n                   + matrix.buf[10] * this.buf[8] + matrix.buf[11] * this.buf[12]);\n        var m32 = (matrix.buf[8] * this.buf[1] + matrix.buf[9] * this.buf[5]\n                   + matrix.buf[10] * this.buf[9] + matrix.buf[11] * this.buf[13]);\n        var m33 = (matrix.buf[8] * this.buf[2] + matrix.buf[9] * this.buf[6]\n                   + matrix.buf[10] * this.buf[10] + matrix.buf[11] * this.buf[14]);\n        var m34 = (matrix.buf[8] * this.buf[3] + matrix.buf[9] * this.buf[7]\n                   + matrix.buf[10] * this.buf[11] + matrix.buf[11] * this.buf[15]);\n\n        var m41 = (matrix.buf[12] * this.buf[0] + matrix.buf[13] * this.buf[4]\n                   + matrix.buf[14] * this.buf[8] + matrix.buf[15] * this.buf[12]);\n        var m42 = (matrix.buf[12] * this.buf[1] + matrix.buf[13] * this.buf[5]\n                   + matrix.buf[14] * this.buf[9] + matrix.buf[15] * this.buf[13]);\n        var m43 = (matrix.buf[12] * this.buf[2] + matrix.buf[13] * this.buf[6]\n                   + matrix.buf[14] * this.buf[10] + matrix.buf[15] * this.buf[14]);\n        var m44 = (matrix.buf[12] * this.buf[3] + matrix.buf[13] * this.buf[7]\n                   + matrix.buf[14] * this.buf[11] + matrix.buf[15] * this.buf[15]);\n        \n        this.buf[0] = m11;\n        this.buf[1] = m12;\n        this.buf[2] = m13;\n        this.buf[3] = m14;\n\n        this.buf[4] = m21;\n        this.buf[5] = m22;\n        this.buf[6] = m23;\n        this.buf[7] = m24;\n\n        this.buf[8] = m31;\n        this.buf[9] = m32;\n        this.buf[10] = m33;\n        this.buf[11] = m34;\n\n        this.buf[12] = m41;\n        this.buf[13] = m42;\n        this.buf[14] = m43;\n        this.buf[15] = m44;\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.ortho = function(left, right, bottom, top, near, far)\n    {\n        var tx = (left + right) / (right - left);\n        var ty = (top + bottom) / (top - bottom);\n        var tz = (far + near) / (far - near);\n        \n        this.initmatrix()\n        this.matrix.buf[0] = 2 / (right - left);\n        this.matrix.buf[5] = 2 / (top - bottom);\n        this.matrix.buf[10] = -2 / (far - near);\n        this.matrix.buf[12] = tx;\n        this.matrix.buf[13] = ty;\n        this.matrix.buf[14] = -tz;\n        \n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.frustum = function(left, right, bottom, top, near, far)\n    {\n        this.initmatrix()\n        var A = (right + left) / (right - left);\n        var B = (top + bottom) / (top - bottom);\n        var C = -(far + near) / (far - near);\n        var D = -(2 * far * near) / (far - near);\n        \n        this.matrix.buf[0] = (2 * near) / (right - left);\n        \n        this.matrix.buf[5] = 2 * near / (top - bottom);\n        \n        this.matrix.buf[8] = A;\n        this.matrix.buf[9] = B;\n        this.matrix.buf[10] = C;\n        this.matrix.buf[11] = -1;\n        \n        this.matrix.buf[14] = D;\n        this.matrix.buf[15] = 0;\n        \n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    CanvasMatrix4.prototype.perspective = function(fovy, aspect, zNear, zFar)\n    {\n        var top = Math.tan(fovy * Math.PI / 360) * zNear;\n        var bottom = -top;\n        var left = aspect * bottom;\n        var right = aspect * top;\n        this.frustum(left, right, bottom, top, zNear, zFar);\n        return this ;\n    }\n    CanvasMatrix4.prototype.pallarel = function(width, aspect, zNear, zFar)\n    {\n        var right = width/2;\n        var left = -right;\n    \tvar top = right / aspect ;\n    \tvar bottom = -top ;\n        this.ortho(left, right, bottom, top, zNear, zFar);\n        return this ;\n    }\n    CanvasMatrix4.prototype.lookat = function(eyex, eyey, eyez, centerx, centery, centerz, upx, upy, upz)\n    {\n        this.initmatrix()\n        \n        // Make rotation matrix\n\n        // Z vector\n        var zx = eyex - centerx;\n        var zy = eyey - centery;\n        var zz = eyez - centerz;\n        var mag = Math.hypot(zx,zy,zz);\n        if (mag) {\n            zx /= mag;\n            zy /= mag;\n            zz /= mag;\n        }\n\n        // X vector = Y cross Z\n        var xx =  upy * zz - upz * zy;\n        var xy = -upx * zz + upz * zx;\n        var xz =  upx * zy - upy * zx;\n\n        // Recompute Y = Z cross X\n        var yx = zy * xz - zz * xy;\n        var yy = -zx * xz + zz * xx;\n        var yz = zx * xy - zy * xx;\n\n        // cross product gives area of parallelogram, which is < 1.0 for\n        // non-perpendicular unit-length vectors; so normalize x, y here\n\n        mag = Math.hypot(xx,xy,xz);\n        if (mag) {\n            xx /= mag;\n            xy /= mag;\n            xz /= mag;\n        }\n\n        mag = Math.hypot(yx,yy,yz);\n        if (mag) {\n            yx /= mag;\n            yy /= mag;\n            yz /= mag;\n        }\n\n        this.matrix.buf[0] = xx;\n        this.matrix.buf[1] = yx;\n        this.matrix.buf[2] = zx;\n        \n        this.matrix.buf[4] = xy;\n        this.matrix.buf[5] = yy;\n        this.matrix.buf[6] = zy;\n        \n        this.matrix.buf[8] = xz;\n        this.matrix.buf[9] = yz;\n        this.matrix.buf[10] = zz;\n        \n        this.matrix.buf[12] = -(xx * eyex + xy * eyey + xz * eyez);\n        this.matrix.buf[13] = -(yx * eyex + yy * eyey + yz * eyez);\n        this.matrix.buf[14] = -(zx * eyex + zy * eyey + zz * eyez);\n     //   matrix.translate(-eyex, -eyey, -eyez);\n        \n        this.multRight(this.matrix);\n        return this ;\n    }\n\n    // Support functions\n    CanvasMatrix4.prototype._determinant2x2 = function(a, b, c, d)\n    {\n        return a * d - b * c;\n    }\n\n    CanvasMatrix4.prototype._determinant3x3 = function(a1, a2, a3, b1, b2, b3, c1, c2, c3)\n    {\n        return a1 * this._determinant2x2(b2, b3, c2, c3)\n             - b1 * this._determinant2x2(a2, a3, c2, c3)\n             + c1 * this._determinant2x2(a2, a3, b2, b3);\n    }\n\n    CanvasMatrix4.prototype._determinant4x4 = function()\n    {\n        var a1 = this.buf[0];\n        var b1 = this.buf[1]; \n        var c1 = this.buf[2];\n        var d1 = this.buf[3];\n\n        var a2 = this.buf[4];\n        var b2 = this.buf[5]; \n        var c2 = this.buf[6];\n        var d2 = this.buf[7];\n\n        var a3 = this.buf[8];\n        var b3 = this.buf[9]; \n        var c3 = this.buf[10];\n        var d3 = this.buf[11];\n\n        var a4 = this.buf[12];\n        var b4 = this.buf[13]; \n        var c4 = this.buf[14];\n        var d4 = this.buf[15];\n\n        return a1 * this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4)\n             - b1 * this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4)\n             + c1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4)\n             - d1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\n    }\n\n    CanvasMatrix4.prototype._makeAdjoint = function()\n    {\n        var a1 = this.buf[0];\n        var b1 = this.buf[1]; \n        var c1 = this.buf[2];\n        var d1 = this.buf[3];\n\n        var a2 = this.buf[4];\n        var b2 = this.buf[5]; \n        var c2 = this.buf[6];\n        var d2 = this.buf[7];\n\n        var a3 = this.buf[8];\n        var b3 = this.buf[9]; \n        var c3 = this.buf[10];\n        var d3 = this.buf[11];\n\n        var a4 = this.buf[12];\n        var b4 = this.buf[13]; \n        var c4 = this.buf[14];\n        var d4 = this.buf[15];\n\n        // Row column labeling reversed since we transpose rows & columns\n        this.buf[0]  =   this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);\n        this.buf[4]  = - this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);\n        this.buf[8]  =   this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);\n        this.buf[12]  = - this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);\n            \n        this.buf[1]  = - this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);\n        this.buf[5]  =   this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);\n        this.buf[9]  = - this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);\n        this.buf[13]  =   this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);\n            \n        this.buf[2]  =   this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);\n        this.buf[6]  = - this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);\n        this.buf[10]  =   this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);\n        this.buf[14]  = - this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);\n            \n        this.buf[3]  = - this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);\n        this.buf[7]  =   this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);\n        this.buf[11]  = - this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);\n        this.buf[15]  =   this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);\n    }\n\n    ////utils \n    //vec3 operations\n    \tCanvasMatrix4.V3add = function() {\n    \t\tlet x=0,y=0,z=0 ;\n    \t\tfor(let i=0;i<arguments.length;i++) {\n    \t\t\tx += arguments[i][0] ;y += arguments[i][1] ;z += arguments[i][2] ;\n    \t\t}\n    \t\treturn [x,y,z] ;\n    \t}\n    \tCanvasMatrix4.V3sub = function() {\n    \t\tlet x=arguments[0][0],y=arguments[0][1],z=arguments[0][2] ;\n    \t\tfor(let i=1;i<arguments.length;i++) {\n    \t\t\tx -= arguments[i][0] ;y -= arguments[i][1] ;z -= arguments[i][2] ;\n    \t\t}\n    \t\treturn [x,y,z] ;\n    \t}\n    \tCanvasMatrix4.V3inv = function(v) {\n    \t\treturn [-v[0],-v[1],-v[2]] ;\n    \t}\n    \tCanvasMatrix4.V3len = function(v) {\n    \t\treturn Math.hypot(v[0],v[1],v[2]) ;\n    \t}\n    \tCanvasMatrix4.V3norm = function(v,s) {\n    \t\tconst l = CanvasMatrix4.V3len(v) ;\n    \t\tif(s===undefined) s = 1 ;\n    \t\treturn (l==0)?[0,0,0]:[v[0]*s/l,v[1]*s/l,v[2]*s/l] ;\n    \t}\n    \tCanvasMatrix4.V3mult = function(v,s) {\n    \t\treturn [v[0]*s,v[1]*s,v[2]*s] ;\n    \t}\n    \tCanvasMatrix4.V3dot = function(v1,v2) {\n    \t\treturn v1[0]*v2[0]+v1[1]*v2[1]+v1[2]*v2[2] ;\n    \t}\n    \tCanvasMatrix4.V3cross = function(v1,v2) {\n    \t\treturn [\t\n    \t\t\tv1[1]*v2[2] - v1[2] * v2[1],\n    \t\t\tv1[2]*v2[0] - v1[0] * v2[2],\n    \t\t\tv1[0]*v2[1] - v1[1] * v2[0] \n    \t\t]\n    \t}\n\n    //multiple vector\n    CanvasMatrix4.prototype.multVec4 = function(x,y,z,w) {\n    \tif(Array.isArray(x)|| x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2];w=x[3]; x = x[0];\n    \t}\n    \tvar xx = this.buf[0]*x + this.buf[4]*y + this.buf[8]*z + this.buf[12]*w ;\n    \tvar yy = this.buf[1]*x + this.buf[5]*y + this.buf[9]*z + this.buf[13]*w ;\n    \tvar zz = this.buf[2]*x + this.buf[6]*y + this.buf[10]*z + this.buf[14]*w ;\n    \tvar ww = this.buf[3]*x + this.buf[7]*y + this.buf[11]*z + this.buf[15]*w ;\n    \treturn [xx,yy,zz,ww] ;\n    }\n\n    //shorthand class method \n    CanvasMatrix4.rotAndTrans = function(rx,ry,rz,tx,ty,tz) {\n    \tvar m = new CanvasMatrix4()\n    \tif(rx!=0) m.rotate(rx,1,0,0) \n    \tif(ry!=0) m.rotate(ry,0,1,0)\n    \tif(rz!=0) m.rotate(rz,0,0,1)\n    \tm.translate(tx,ty,tz)\n    \treturn m \n    }\n\n    //quaternion to matrix\n    CanvasMatrix4.prototype.q2m = function(x,y,z,w) {\n    \tif(Array.isArray(x) || x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2];w=x[3]; x = x[0];\n    \t}\n    \tvar x2 = x*x; var y2=y*y; var z2=z*z ;\n    \tthis.buf[0] = 1- 2*(y2 + z2) ;\n    \tthis.buf[1] = 2*(x*y + w*z) ;\n    \tthis.buf[2] = 2*(x*z - w*y) ;\n    \tthis.buf[3] = 0 ;\n    \tthis.buf[4] = 2*(x*y - w*z) ;\n    \tthis.buf[5] = 1-2*(x2 + z2) ;\n    \tthis.buf[6] = 2*(y*z + w*x) ;\n    \tthis.buf[7] = 0 ;\n    \tthis.buf[8] = 2*(x*z + w*y) ;\n    \tthis.buf[9] = 2*(y*z - w*x) ;\n    \tthis.buf[10] = 1-2*(x2 + y2) ;\n    \tthis.buf[11] = 0 ; this.buf[12]=0; this.buf[13]=0; this.buf[14]=0;this.buf[15]=1;\n    \treturn this \n    }\n    CanvasMatrix4.v2q = function(rot,x,y,z) {\n    \tif(Array.isArray(x) || x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2]; x = x[0];\n    \t}\n    \tlet l = x*x + y*y + z*z \n    \tif(l==0) return [0,0,0,1]\n    \tif(l!=1) {\n    \t\tl = Math.sqrt(l) \n    \t\tx /= l ; y /=l ; z /= l\n    \t}\n    \trot = rot *CanvasMatrix4.RAD /2 \n    \tlet sr = Math.sin(rot) \n    \treturn [x*sr,y*sr,z*sr,Math.cos(rot)]\n    }\n    CanvasMatrix4.e2q = function(x,y,z) {\n    \tif(Array.isArray(x) || x instanceof Float32Array) {\n    \t\ty = x[1]; z = x[2]; x = x[0];\n    \t}\n    \tx *= CanvasMatrix4.RAD*0.5\n    \ty *= CanvasMatrix4.RAD*0.5\n    \tz *= CanvasMatrix4.RAD*0.5\n    \tlet c1 = Math.cos(x),c2=Math.cos(y),c3=Math.cos(z)\n    \tlet s1 = Math.sin(x),s2=Math.sin(y),s3=Math.sin(z)\n    \t// order YXZ\n    \tlet qx = s1 * c2 * c3 + c1 * s2 * s3;\n        let qy = c1 * s2 * c3 - s1 * c2 * s3;\n        let qz = c1 * c2 * s3 - s1 * s2 * c3;\n        let qw = c1 * c2 * c3 + s1 * s2 * s3;\n        return [qx,qy,qz,qw]\n    }\n    CanvasMatrix4.qMult = function(q1,q2) {\n    \tlet w = q1[3] * q2[3] -(q1[0]*q2[0]+q1[1]*q2[1]+q1[2]*q2[2])\n    \tlet x = q1[1]*q2[2] - q1[2] * q2[1] + q1[3]*q2[0] + q2[3]*q1[0]\n    \tlet y = q1[2]*q2[0] - q1[0] * q2[2] + q1[3]*q2[1] + q2[3]*q1[1]\n     \tlet z = q1[0]*q2[1] - q1[1] * q2[0] + q1[3]*q2[2] + q2[3]*q1[2]\n    \treturn [x,y,z,w]\t\n    }\n\n    return CanvasMatrix4;\n});\n    \t\n\n"]}