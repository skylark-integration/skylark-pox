{"version":3,"sources":["WWModel.js"],"names":["define","poxp","CanvasMatrix4","$","WWModel","[object Object]","type","param","wx","wy","wz","div","divx","divy","divz","ninv","p","n","t","s","PHI","Math","PI","i","v","y","cos","r","sin","j","u","x","z","push","d2","base","pdiv","PH","yi","xr","xdiv","xi","li","xofs","xd","floor","pc","length","sc","dy","j2","cap","cubemap","this","parametricModel","px","py","pz","nx","ny","nz","mu","mv","start","end","sr","du","dv","cx","cz","vx","mx","mz","my","hypot","m","shape","vt","si","vi","vs","h","vl","vv","_uv","id","undefined","tridiv","atan2","acos","i1","i2","i3","v1","v2","v3","v12","V3norm","V3add","v23","v31","obj_v","obj_n","obj_t","obj_i","func","pu","pv","opt","pos","norm","uv","indices","iu","iv","dud","dvd","du0","du1","nux","nuy","nuz","dv0","dv1","nvx","nvy","nvz","nl","addvec","mode","c","obj_c","vbuf","ibuf","sf","sn","ii","l","pa","yx","yy","yz","zx","zy","zz","xx","xy","xz","vn","lj","parseFloat","av","concat","data","ret","vtx_at","vtx","idx","attr","vm","nv","k","ss","m4","inv","invert","transpose","buf","getAsArray","vy","vz","models","ofs","pp","sx","Number","MAX_VALUE","sy","sz","ex","MIN_VALUE","ey","ez","src","Promise","resolve","reject","req","XMLHttpRequest","open","responseType","onload","status","response","statusText","onerror","send","path","cb","lbufsize","decoder","TextDecoder","Array","isArray","constructor","File","reader","FileReader","e","target","result","split","readAsText","fetch","method","then","async","resp","ok","body","getReader","Uint8Array","bi","done","value","read","decode","slice","char","scale","loadAjax","xic","len","match","ll","ix","ind","console","log","catch","err","zup","nogroup","nomtl","xl","rxi","usemtl","group","pmtls","mtlspath","loadLines","cmd","splice","join","trim","loadMtl","groups","objs","g","obj","mtlname","all","mtls","allmtls","Object","assign","mtlpaths","shift","parseInt","H","S","V","a","ih","fl","rr","gg","bb"],"mappings":"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","file":"../WWModel.js","sourcesContent":["define([\n    \"./poxp\",\n    \"./CanvasMatrix4\"\n],function(poxp,CanvasMatrix4){\n\t//Model library for WWG\n\t// Version 1.0 \n\t// 2016-2017 wakufactory.jp \n\t// license: MIT \n\n\tvar $ = poxp.$;\n\n\t// export default \n\tclass WWModel {\n\n\t\t// generate primitive\n\t\t primitive(type,param) {\n\t\t\tif(!param) param = {} ;\n\t\t\tlet wx = (param.wx)?param.wx:1.0 ;\n\t\t\tlet wy = (param.wy)?param.wy:1.0 ;\n\t\t\tlet wz = (param.wz)?param.wz:1.0 ;\n\t\t\tlet div = (param.div)?param.div:10 ;\n\t\t\tlet divx = (param.divx)?param.divx:div ;\n\t\t\tlet divy = (param.divy)?param.divy:div ;\n\t\t\tlet divz = (param.divz)?param.divz:div ;\n\t\t\tlet ninv = (param.ninv)?-1:1 ;\n\t\t\tlet p = [] ;\n\t\t\tlet n = [] ;\n\t\t\tlet t = [] ;\n\t\t\tlet s = [] ;\n\t\t\tlet PHI = Math.PI *2 ;\n\n\t\t\tswitch(type) {\n\t\t\tcase \"sphere\":\n\t\t\t\tfor(let i = 0 ; i <= div ; ++i) {\n\t\t\t\t\tlet v = i / (0.0+div);\n\t\t\t\t\tlet y = Math.cos(Math.PI * v), r = Math.sin(Math.PI * v);\n\t\t\t\t\tfor(let j = 0 ; j <= div*2 ; ++j) {\n\t\t\t\t\t\tlet u = j / (0+div*2) ;\n\t\t\t\t\t\tlet x = (Math.cos(PHI * u) * r)\n\t\t\t\t\t\tlet z = (Math.sin(PHI * u) * r)\n\t\t\t\t\t\tp.push([x*wx,y*wy,z*wz])\n\t\t\t\t\t\tn.push([x*ninv,y*ninv,z*ninv])\n\t\t\t\t\t\tt.push([(ninv>0)?1-u:u,1-v])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet d2 = div*2+1 ;\n\t\t\t\tfor(let j = 0 ; j < div ; ++j) {\n\t\t\t\t\tlet base = j * d2;\n\t\t\t\t\tfor(let i = 0 ; i < div*2 ; ++i) {\n\t\t\t\t\t\tif(ninv>0) s.push(\n\t\t\t\t\t\t\t[base + i,\t  base + i + 1, base + i     + d2],\n\t\t\t\t\t\t\t[base + i + d2, base + i + 1, base + i + 1 + d2]);\n\t\t\t\t\t\telse s.push(\n\t\t\t\t\t\t\t[base + i     + d2,\tbase + i + 1, base + i],\n\t\t\t\t\t\t\t[base + i + 1 + d2, base + i + 1, base + i + d2 ]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t\t\n\t\t\tcase \"sphere2\":\n\t\t\t\tconst pdiv = (param.div)?param.div:6 \n\t\t\t\tconst PH = Math.PI/2\n\t\t\t\tfor(let yi=0; yi<pdiv;yi++) {\n\t\t\t\t\tlet y = Math.sin(PH*yi/pdiv)\n\t\t\t\t\tlet xr = Math.cos(PH*yi/pdiv)\n\t\t\t\t\tlet xdiv = pdiv-yi\n\t\t\t\t\tfor(let xi=0;xi<=xdiv;xi++) {\n\t\t\t\t\t\tlet x = Math.cos(PH*xi/xdiv)*xr\n\t\t\t\t\t\tlet z = Math.sin(PH*xi/xdiv)*xr\n\t\t\t\t\t\tp.push([x*wx,y*wy,z*wz])\n\t\t\t\t\t\tn.push([x,y,z])\n\t\t\t\t\t\tt.push([1-xi/xdiv/4,0.5+yi/pdiv/2])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tp.push([0,wy,0])\n\t\t\t\tn.push([0,1,0])\n\t\t\t\tt.push([0.75,1])\n\t\t\t\tlet li = 0\n\t\t\t\tfor(let yi=0;yi<pdiv;yi++) {\n\t\t\t\t\tlet xdiv = (pdiv-yi)*2-1\n\t\t\t\t\tlet xofs = pdiv-yi+1\n\t\t\t\t\tfor(let xi=0;xi<xdiv;xi++) {\n\t\t\t\t\t\tlet xd = Math.floor(xi/2)\n\t\t\t\t\t\tif(xi%2==0) {\n\t\t\t\t\t\t\tif(ninv>0) s.push([xd+li,xd+li+xofs,xd+li+1])\n\t\t\t\t\t\t\telse  s.push([xd+li,xd+li+1,xd+li+xofs])\t\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(ninv>0) s.push([xd+1+li,xd+li+xofs,xd+li+xofs+1])\n\t\t\t\t\t\t\telse  s.push([xd+1+li,xd+li+xofs+1,xd+li+xofs])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tli += xofs\n\t\t\t\t}\n\t\t\t\tlet pc = p.length \n\t\t\t\tlet sc = s.length\n\t\t\t\tfor(let i=0;i<pc;i++) {\n\t\t\t\t\tp.push([p[i][0],-p[i][1],p[i][2]])\n\t\t\t\t\tn.push([p[i][0],-p[i][1],p[i][2]])\n\t\t\t\t\tt.push([t[i][0],1-t[i][1]])\n\t\t\t\t}\n\t\t\t\tfor(let i=0;i<sc;i++) {\n\t\t\t\t\ts.push([s[i][0]+pc,s[i][2]+pc,s[i][1]+pc])\n\t\t\t\t}\n\t\t\t\tpc = p.length \n\t\t\t\tsc = s.length\n\t\t\t\tfor(let i=0;i<pc;i++) {\n\t\t\t\t\tp.push([-p[i][0],p[i][1],p[i][2]])\n\t\t\t\t\tn.push([-p[i][0],p[i][1],p[i][2]])\n\t\t\t\t\tt.push([1-t[i][0]+0.5,t[i][1]])\n\t\t\t\t}\n\t\t\t\tfor(let i=0;i<sc;i++) {\n\t\t\t\t\ts.push([s[i][0]+pc,s[i][2]+pc,s[i][1]+pc])\n\t\t\t\t}\n\t\t\t\tpc = p.length \n\t\t\t\tsc = s.length\n\t\t\t\tfor(let i=0;i<pc;i++) {\n\t\t\t\t\tp.push([p[i][0],p[i][1],-p[i][2]])\n\t\t\t\t\tn.push([p[i][0],p[i][1],-p[i][2]])\n\t\t\t\t\tt.push([1-t[i][0],t[i][1]])\n\t\t\t\t}\n\t\t\t\tfor(let i=0;i<sc;i++) {\n\t\t\t\t\ts.push([s[i][0]+pc,s[i][2]+pc,s[i][1]+pc])\n\t\t\t\t}\t\n\t\t\t\tbreak ;\n\t\t\tcase \"cylinder\":\n\t\t\t\tdivy = (param.divy)?param.divy:1\n\t\t\t\tfor(let i = 0 ; i <= div ; ++i) {\n\t\t\t\t\tlet v = i / (0.0+div);\n\t\t\t\t\tlet z = Math.sin(PHI * v)*wz, x = Math.cos(PHI * v)*wx;\n\t\t\t\t\tlet dy = wy*2/divy ;\n\t\t\t\t\tfor(let yi=0;yi<=divy;yi++) {\n\t\t\t\t\t\tp.push([x,yi*dy-wy,z])\n\t\t\t\t\t\tn.push([x*ninv,0,z*ninv])\n\t\t\t\t\t\tt.push([(ninv>0)?1-v:v,yi/divy])\n\t\t//\t\t\t\tp.push([x,(yi+1)*dy-wy,z])\n\t\t//\t\t\t\tn.push([x*ninv,0,z*ninv,0])\n\t\t//\t\t\t\tt.push([(ninv>0)?1-v:v,0])\n\t\t\t\t\t}\t\t\t\n\t\t\t\t}\n\t\t\t\tfor(let j =0; j < div ;j++) {\n\t\t\t\t\tfor(let yi=0;yi<divy;yi++) {\n\t\t\t\t\t\tlet j2 = j*(divy+1)+yi \n\t\t\t\t\t\tif(ninv<0)s.push([j2,j2+(divy+1),j2+(divy+1)+1,j2+1]) ;\n\t\t\t\t\t\telse s.push([j2,j2+1,j2+3,j2+2]) ;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(param.cap) {\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\tbreak; \n\t\t\tcase \"ring\":\n\t\t\t\tdivy = (param.divy)?param.divy:1\n\t\t\t\tfor(let i = 0 ; i <= div ; ++i) {\n\t\t\t\t\tlet v = i / (0.0+div);\n\t\t\t\t\tlet z = Math.sin(PHI * v)*wz, x = Math.cos(PHI * v)*wx;\n\t\t\t\t\tfor(let yi=0;yi<divy;yi++) {\n\t\t\t\t\t\tp.push([x,wy,z])\n\t\t\t\t\t\tn.push([x*ninv,0,z*ninv])\n\t\t\t\t\t\tt.push([(ninv>0)?1-v:v,1])\n\t\t\t\t\t\tp.push([x,-wy,z])\n\t\t\t\t\t\tn.push([x*ninv,0,z*ninv,0])\n\t\t\t\t\t\tt.push([(ninv>0)?1-v:v,0])\n\t\t\t\t\t}\t\t\t\n\t\t\t\t}\n\t\t\t\tfor(let j =0; j < div ;j++) {\n\t\t\t\t\tif(ninv>0)s.push([j*2,j*2+2,j*2+3,j*2+1]) ;\n\t\t\t\t\telse s.push([j*2,j*2+1,j*2+3,j*2+2]) ;\n\t\t\t\t}\n\t\t\t\tif(param.cap) {\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\tbreak; \n\t\t\tcase \"cone\":\n\t\t\t\tfor(let i = 0 ; i <= div ; ++i) {\n\t\t\t\t\tlet v = i / (0.0+div);\n\t\t\t\t\tlet z = Math.sin(PHI * v)*wz, x = Math.cos(PHI * v)*wx;\n\t\t\t\t\tp.push([0,wy,0])\n\t\t\t\t\tn.push([x*ninv,0,z*ninv])\n\t\t\t\t\tt.push([(ninv>0)?1-v:v,1])\n\t\t\t\t\tp.push([x,-wy,z])\n\t\t\t\t\tn.push([x*ninv,0,z*ninv,0])\n\t\t\t\t\tt.push([(ninv>0)?1-v:v,0])\t\t\t\n\t\t\t\t}\n\t\t\t\tfor(let j =0; j < div ;j++) {\n\t\t\t\t\tif(ninv>0)s.push([j*2,j*2+2,j*2+3,j*2+1]) ;\n\t\t\t\t\telse s.push([j*2,j*2+1,j*2+3,j*2+2]) ;\n\t\t\t\t}\n\t\t\t\tbreak; \n\t\t\tcase \"disc\":\n\t\t\t\tfor(let i = 0 ; i < div ; ++i) {\n\t\t\t\t\tlet v = i / (0.0+div);\n\t\t\t\t\tlet z = Math.cos(PHI * v)*wz, x = Math.sin(PHI * v)*wx;\n\t\t\t\t\tp.push([x,0,z])\n\t\t\t\t\tn.push([0,1,0])\n\t\t\t\t\tt.push([(x/wx+1)/2,(z/wz+1)/2])\t\n\t\t\t\t}\n\t\t\t\tp.push([0,0,0])\n\t\t\t\tn.push([0,1,0])\n\t\t\t\tt.push([0.5,0.5])\n\t\t\t\tfor(let j =0; j < div-1 ;j++) {\n\t\t\t\t\ts.push([j,j+1,div]) ;\n\t\t\t\t}\n\t\t\t\ts.push([div-1,0,div])\n\t\t\t\tbreak; \n\t\t\tcase \"plane\":\n\t\t\t\tif(!param.wz)  {\n\t\t\t\t\tp = [[wx,-wy,0],[wx,wy,0],[-wx,wy,0],[-wx,-wy,0]]\n\t\t\t\t\tn = [[0,0,ninv],[0,0,ninv],[0,0,ninv],[0,0,ninv]]\n\t\t\t\t} else if(!param.wx){\n\t\t\t\t\tp = [[0,-wy,-wz],[0,wy,-wz],[0,wy,wz],[0,-wy,wz]]\n\t\t\t\t\tn = [[ninv,0,0],[ninv,0,0],[ninv,0,0],[ninv,0,0]]\n\t\t\t\t}else {\n\t\t\t\t\tp = [[wx,0,wz],[wx,0,-wz],[-wx,0,-wz],[-wx,0,wz]]\n\t\t\t\t\tn = [[0,ninv,0],[0,ninv,0],[0,ninv,0],[0,ninv,0]]\n\t\t\t\t}\n\t\t\t\tt = (ninv>0)?[[1,0],[1,1],[0,1],[0,0]]:[[-1,0],[-1,1],[0,1],[0,0]]\n\t\t\t\ts = (ninv>0)?[[0,1,2],[2,3,0]]:[[2,1,0],[0,3,2]]\n\t\t\t\tbreak ;\n\t\t\tcase \"box\":\n\t\t\t\tp = [\n\t\t\t\t\t[wx,wy,wz],[wx,-wy,wz],[-wx,-wy,wz],[-wx,wy,wz],\t\t//+z\n\t\t\t\t\t[wx,wy,-wz],[wx,-wy,-wz],[-wx,-wy,-wz],[-wx,wy,-wz],//-z\n\t\t\t\t\t[wx,wy,wz],[wx,-wy,wz],[wx,-wy,-wz],[wx,wy,-wz],\t\t//+x\n\t\t\t\t\t[-wx,wy,wz],[-wx,-wy,wz],[-wx,-wy,-wz],[-wx,wy,-wz],//-x\n\t\t\t\t\t[wx,wy,wz],[wx,wy,-wz],[-wx,wy,-wz],[-wx,wy,wz],\t\t//+y\n\t\t\t\t\t[wx,-wy,wz],[wx,-wy,-wz],[-wx,-wy,-wz],[-wx,-wy,wz],\t//-y\n\t\t\t\t]\n\t\t\t\tn = [\n\t\t\t\t\t[0,0,ninv],[0,0,ninv],[0,0,ninv],[0,0,ninv],\n\t\t\t\t\t[0,0,-ninv],[0,0,-ninv],[0,0,-ninv],[0,0,-ninv],\n\t\t\t\t\t[ninv,0,0],[ninv,0,0],[ninv,0,0],[ninv,0,0],\n\t\t\t\t\t[-ninv,0,0],[-ninv,0,0],[-ninv,0,0],[-ninv,0,0],\n\t\t\t\t\t[0,ninv,0],[0,ninv,0],[0,ninv,0],[0,ninv,0],\n\t\t\t\t\t[0,-ninv,0],[0,-ninv,0],[0,-ninv,0],[0,-ninv,0]\n\t\t\t\t]\n\t\t\t\tt = (param.cubemap==1)?[\n\t\t\t\t\t[3/4,2/3],[3/4,1/3],[1,1/3],[1,2/3],\n\t\t\t\t\t[1/2,2/3],[1/2,1/3],[1/4,1/3],[1/4,2/3],\n\t\t\t\t\t[3/4,2/3],[3/4,1/3],[1/2,1/3],[1/2,2/3],\n\t\t\t\t\t[0,2/3],[0,1/3],[1/4,1/3],[1/4,2/3],\n\t\t\t\t\t[1/2,1],[1/2,2/3],[1/4,2/3],[1/4,1],\n\t\t\t\t\t[1/2,0],[1/2,1/3],[1/4,1/3],[1/4,0]\n\t\t\t\t]:[\n\t\t\t\t\t[1,1],[1,0],[0,0],[0,1],\n\t\t\t\t\t[0,1],[0,0],[1,0],[1,1],\n\t\t\t\t\t[0,1],[0,0],[1,0],[1,1],\n\t\t\t\t\t[1,1],[1,0],[0,0],[0,1],\n\t\t\t\t\t[1,0],[1,1],[0,1],[0,0],\n\t\t\t\t\t[1,1],[1,0],[0,0],[0,1]\n\t\t\t\t]\n\t\t\t\ts = (ninv>0)?[\n\t\t\t\t\t[3,1,0],[2,1,3],\n\t\t\t\t\t[4,5,7],[7,5,6],\n\t\t\t\t\t[8,9,11],[11,9,10],\n\t\t\t\t\t[15,13,12],[14,13,15],\t\n\t\t\t\t\t[16,17,19],[19,17,18],\n\t\t\t\t\t[23,21,20],[22,21,23],\t\t\n\t\t\t\t]:[\n\t\t\t\t\t[0,1,3],[3,1,2],\n\t\t\t\t\t[7,5,4],[6,5,7],\n\t\t\t\t\t[11,9,8],[10,9,11],\n\t\t\t\t\t[12,13,15],[15,13,14],\t\n\t\t\t\t\t[19,17,16],[18,17,19],\n\t\t\t\t\t[20,21,23],[23,21,22],\t\t\n\t\t\t\t]\n\t\t\t\tbreak ;\n\t\t\tcase \"mesh\":\n\t\t\t\tthis.parametricModel( function(u,v) {\n\t\t\t\t\tlet r = {\n\t\t\t\t\t\tpx:(u-0.5)*wx, py:0, pz:(v-0.5)*wz,\n\t\t\t\t\t\tnx:0, ny:1, nz:0,\n\t\t\t\t\t\tmu:u, mv:v }\n\t\t\t\t\treturn r ;\n\t\t\t\t},{start:1.0,end:0,div:divx},{start:0,end:1,div:divz},{ninv:param.ninv}) ;\n\t\t\t\treturn this ;\t\t\n\t\t\t\tbreak ;\n\t\t\tcase \"torus\":\n\t\t\t\tthis.parametricModel( function(u,v) {\n\t\t\t\t\tlet R = 1.0 ;\n\t\t\t\t\tlet sr = (param.sr)?param.sr:0.5 ;\n\t\t\t\t\tlet du = u ;\n\t\t\t\t\tlet dv = -v ;\n\t\t\t\t\tlet cx = Math.sin(du*PHI) ;\n\t\t\t\t\tlet cz = Math.cos(du*PHI) ;\n\t\t\t\t\tlet vx = Math.sin(dv*PHI) ;\n\t\t\t\t\tlet vy = Math.cos(dv*PHI) ;\n\t\t\t\t\tlet tx = 1\n\t\t\t\t\tlet mx = sr*vx*cx ;\n\t\t\t\t\tlet mz = sr*vx*cz ;\n\t\t\t\t\tlet my = sr*vy ;\n\t\t\t\t\tlet ml = Math.hypot(mx,my,mz) ;\n\t\t\t\n\t\t\t\t\tlet px = R*cx + tx*mx ;\n\t\t\t\t\tlet pz = R*cz + tx*mz ;\n\t\t\t\t\tlet py = tx*my ;\n\t\t\t\t\tlet r = {\n\t\t\t\t\t\tpx:px*wx, py:py*wy, pz:pz*wz,\n\t\t\t\t\t\tnx:0, ny:0, nz:0,\n\t\t\t\t\t\tmu:u, mv:v }\n\t\t\t\t\treturn r ;\t\t\t\n\t\t\t\t\t\n\t\t\t\t},{start:0,end:1.0,div:divx*2},{start:0,end:1,div:divy},{ninv:param.ninv}) ;\n\t\t\t\treturn this ;\n\t\t\tcase \"polyhedron\":\n\n\t\t\t\tif(!m[param.shape]) return null ;\n\t\t\t\tlet vt = m[param.shape].v ;\n\t\t\t\tlet si = m[param.shape].s ;\n\t\t\t\tlet vi = 0 ;\n\t\t\t\tfor(let i =0;i<si.length;i++) {\n\t\t\t\t\tlet nx=0,ny=0,nz=0 ;\n\t\t\t\t\tlet vs = [] ;\n\t\t\t\t\tfor(let h = si[i].length-1 ;h>=0;h--) {\n\t\t\t\t\t\tlet v = vt[si[i][h]] ;\n\t\t\t\t\t\tp.push([v[0],v[2],v[1]]) ;\n\t\t\t\t\t\tnx += v[0] ;\n\t\t\t\t\t\tny += v[2] ;\n\t\t\t\t\t\tnz += v[1] ;\n\t\t\t\t\t\tvs.push(vi) ;\n\t\t\t\t\t\tvi++ ;\n\t\t\t\t\t}\n\t\t\t\t\tlet vl = Math.hypot(nx,ny,nz) ;\n\t\t\t\t\tfor(let h = 0 ;h <si[i].length;h++) n.push([nx/vl,ny/vl,nz/vl]) ;\n\t\t\t\t\ts.push(vs) ;\n\t\t\t\t}\n\t\t\t\tt = null ;\n\t\t\t\tbreak ;\n\t\t\tcase \"icosa\":\n\t\t\t\tvt = m[\"r05\"].v ;\n\t\t\t\tsi = m[\"r05\"].s ;\n\t\t\t\tfor(let i=0;i<vt.length;i++) {\n\t\t\t\t\tlet vv = [vt[i][0],vt[i][2],vt[i][1]]\n\t\t\t\t\tp.push(vv)\n\t\t\t\t\tn.push(vv)\n\t\t\t\t\t_uv(vv)\n\t\t\t\t}\n\t\t\t\tfor(let i=0;i<si.length;i++) {\n\t\t\t\t\tif(ninv<0) s.push([si[i][0],si[i][1],si[i][2]])\n\t\t\t\t\telse  s.push([si[i][0],si[i][2],si[i][1]])\n\t\t\t\t}\n\t\t\t\tconst id = (param.div!==undefined)?param.div:2\n\t\t\t\tfor(let i=0;i<id;i++) tridiv(p,s) \n\t\t\t\tfor(let i=0;i<p.length;i++) {\n\t\t\t\t\tp[i][0] *= wx ;\n\t\t\t\t\tp[i][1] *= wy ;\n\t\t\t\t\tp[i][2] *= wz ;\n\t\t\t\t}\n\t\t\t\tbreak \n\t\t\t}\n\t\t\tfunction _uv(p) {\n\t\t\t\tlet u = Math.atan2(p[2],p[0])/Math.PI/2\n\t\t//\t\tif(u<0) u = 1-u\n\t\t\t\tt.push([(1-u)%1,1-Math.acos(p[1])/Math.PI])\n\t\t\t}\n\t\t\tfunction tridiv(v,s) {\n\t\t\t\tlet vi = v.length ;\n\t\t\t\tlet si = s.length ;\n\t\t\t\tlet vf ={} \n\t\t\t\tlet ret \n\t\t\t\tfunction _vff(i1,i2,ni) {\n\t\t\t\t\tlet k = (i1<i2)?`${i1}-${i2}`:`${i2}-${i1}`\n\t\t\t\t\tif(vf[k]==undefined) {\n\t\t\t\t\t\tvf[k] = ni\n\t\t\t\t\t\tret = ni  \n\t\t\t\t\t} else ret = vf[k]\n\t\t\t\t\treturn ret \n\t\t\t\t}\n\t\t\t\tfor(let i=0;i<si;i++) {\n\t\t\t\t\tlet i1 = s[i][0],i2 = s[i][1],i3 = s[i][2]\n\t\t\t\t\tlet v1 = v[i1], v2 = v[i2], v3 = v[i3]\n\n\t\t\t\t\tlet v12 = CanvasMatrix4.V3norm(CanvasMatrix4.V3add(v1,v2)) ;\n\t\t\t\t\tlet v23 = CanvasMatrix4.V3norm(CanvasMatrix4.V3add(v2,v3)) ;\n\t\t\t\t\tlet v31 = CanvasMatrix4.V3norm(CanvasMatrix4.V3add(v3,v1)) ;\n\t\t\t\t\tv.push(v12);\tv.push(v23);v.push(v31)\n\t\t\t\t\tn.push(v12);\tn.push(v23);n.push(v31)\n\t\t\t\t\t_uv(v12);_uv(v23);_uv(v31)\n\t\t\t\t\t\n\t\t\t\t\ts[i]=[i1,vi,vi+2] ;\n\t\t\t\t\ts.push([vi,vi+1,vi+2]) ;\n\t\t\t\t\ts.push([i2,vi+1,vi]) ;\n\t\t\t\t\ts.push([i3,vi+2,vi+1]) ;\n\t\t\t\t\tvi += 3\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.obj_v = p \n\t\t\tthis.obj_n = n\n\t\t\tthis.obj_t = t\n\t\t\tthis.obj_i = s\n\t\t//\tconsole.log(p)\n\t\t//\tconsole.log(n)\n\t\t//\tconsole.log(t)\n\t\t//\tconsole.log(s)\n\t\t\treturn this ;\n\t\t}\n\t\t// generate parametric model by function\n\t\t parametricModel(func,pu,pv,opt) {\n\t\t\tlet pos = [] ;\n\t\t\tlet norm = [] ;\n\t\t\tlet uv = [] ;\n\t\t\tlet indices = [] ;\n\t\t\tlet ninv = (opt && opt.ninv)?-1:1 ;\n\n\t\t\tlet du = (pu.end - pu.start)/pu.div ;\n\t\t\tlet dv = (pv.end - pv.start)/pv.div ;\n\t\t\tfor(let iu =0; iu <= pu.div ;iu++ ) {\n\t\t\t\tfor(let iv = 0 ;iv<= pv.div; iv++ ) {\n\t\t\t\t\tlet u = pu.start+du*iu ;\n\t\t\t\t\tlet v = pv.start+dv*iv ;\n\t\t\t\t\tlet p = func(u,v) ;\n\t\t\t\t\tpos.push( [p.px,p.py,p.pz] ) ;\n\t\t\t\t\tif(p.mu!=undefined) uv.push([p.mu,p.mv]) ;\n\t\t\t\t\t// calc normal\n\t\t\t\t\tif(p.nx==0&&p.ny==0&&p.nz==0) {\n\t\t\t\t\t\tlet dud = du/10 ; let dvd = dv/10 ;\n\t\t\t\t\t\tlet du0 = func(u-dud,v) ; let du1 = func(u+dud,v) ;\n\t\t\t\t\t\tlet nux = (du1.px - du0.px)/(dud*2) ;\n\t\t\t\t\t\tlet nuy = (du1.py - du0.py)/(dud*2) ;\n\t\t\t\t\t\tlet nuz = (du1.pz - du0.pz)/(dud*2) ;\n\t\t\t\t\t\tlet dv0 = func(u,v-dvd) ; let dv1 = func(u,v+dvd) ;\n\t\t\t\t\t\tlet nvx = (dv1.px - dv0.px)/(dvd*2) ;\n\t\t\t\t\t\tlet nvy = (dv1.py - dv0.py)/(dvd*2) ;\n\t\t\t\t\t\tlet nvz = (dv1.pz - dv0.pz)/(dvd*2) ;\n\t\t\t\t\t\tlet nx = nuy*nvz - nuz*nvy ;\n\t\t\t\t\t\tlet ny = nuz*nvx - nux*nvz ;\n\t\t\t\t\t\tlet nz = nux*nvy - nuy*nvx ;\n\t\t\t\t\t\tlet nl = Math.hypot(nx,ny,nz); \n\t\t\t\t\t\tp.nx = nx/nl ;\n\t\t\t\t\t\tp.ny = ny/nl ;\n\t\t\t\t\t\tp.nz = nz/nl ;\n\t\t\t\t\t}\n\t\t\t\t\tnorm.push([p.nx*ninv, p.ny*ninv,p.nz*ninv] ) ;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet d2 = pv.div+1 ;\n\t\t\tfor(let j = 0 ; j < pu.div ; ++j) {\n\t\t\t\tlet base = j * d2;\n\t\t\t\tfor(let i = 0 ; i < pv.div ; ++i) {\n\t\t\t\t\tif(ninv>0) indices.push([base+i,base+i+d2,base+i+d2+1,base+i+1])\t\n\t\t\t\t\telse  indices.push([base+i+1,base+i+d2+1,base+i+d2,base+i])\t\n\t\t\t\t}\t\n\n\t\t\t}\n\t\t\tthis.obj_v = pos\n\t\t\tthis.obj_n = norm\n\t\t\tif(uv.length>0) this.obj_t = uv\n\t\t\tthis.obj_i = indices \n\t\t\treturn this ;\n\t\t}\n\n\t\t//convert vtx data to vbo array\n\t\tobjModel(addvec,mode) {\n\t\t\tlet v = this.obj_v ;\n\t\t\tlet s = this.obj_i ;\n\t\t\tlet n = this.obj_n ;\n\t\t\tlet t = this.obj_t ;\n\t\t\tlet c = this.obj_c ;\n\n\t\t\tlet vbuf = [] ;\n\t\t\tlet ibuf = [] ;\n\t\t\tlet sf = [] ;\n\t\t\tlet sn = [] ;\n\t\t\tlet ii = 0 ;\n\t\t\tif(!n) this.obj_n = [] ;\n\n\t\t\tfor(let i=0,l=s.length;i<l;i++) {\n\t\t\t\tlet p = s[i] ;\n\t\t\t\tif(!n) {\n\t\t\t\t\t//面法線算出\n\t\t\t\t\tlet pa = [] ;\n\t\t\t\t\tfor(let j=0;j<3;j++) {\n\t\t\t\t\t\tpa[j] = v[p[j]] ;\n\t\t\t\t\t}\n\t\t\t\t\tlet yx = pa[1][0]-pa[0][0];\n\t\t\t\t\tlet yy = pa[1][1]-pa[0][1];\n\t\t\t\t\tlet yz = pa[1][2]-pa[0][2];\n\t\t\t\t\tlet zx = pa[2][0]-pa[0][0];\n\t\t\t\t\tlet zy = pa[2][1]-pa[0][1];\n\t\t\t\t\tlet zz = pa[2][2]-pa[0][2];\t\t\t\t\n\t\t\t\t\tlet xx =  yy * zz - yz * zy;\n\t\t\t\t\tlet xy = -yx * zz + yz * zx;\n\t\t\t\t\tlet xz =  yx * zy - yy * zx;\n\t\t\t\t\tlet vn = Math.hypot(xx,xy,xz) ;\n\t\t\t\t\txx /= vn ; xy /= vn ; xz /= vn ;\n\t\t\t\t\tsf.push( [xx,xy,xz]) ;\n\t\t\t\t\t//面リスト\n\t\t\t\t\tfor(let j=0,lj=p.length;j<lj;j++) {\n\t\t\t\t\t\tif(!sn[p[j]]) sn[p[j]] = [] ;\n\t\t\t\t\t\tsn[p[j]].push(i) ;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//3角分割\n\t\t\t\tfor(let j=1,lj=p.length-1;j<lj;j++) {\n\t\t\t\t\tibuf.push(p[0]) ;\n\t\t\t\t\tibuf.push(p[j]) ;\n\t\t\t\t\tibuf.push(p[j+1] ) ;\n\t\t\t\t}\n\t\t\t\tii += p.length ;\n\t\t\t}\n\t\t//\tconsole.log(\" vert:\"+v.length);\n\t\t//\tconsole.log(\" poly:\"+ibuf.length/3);\n\t\t\tfor(let i=0,l=v.length;i<l;i++) {\n\t\t\t\tvbuf.push( parseFloat( v[i][0]) ) ;\n\t\t\t\tvbuf.push( parseFloat( v[i][1]) ) ;\n\t\t\t\tvbuf.push( parseFloat( v[i][2]) ) ;\n\t\t\t\tlet nx=0,ny=0,nz=0 ;\t\t\n\t\t\t\tif(n) {\n\t\t\t\t\tnx = n[i][0] ;\n\t\t\t\t\tny = n[i][1] ;\n\t\t\t\t\tnz = n[i][2] ;\n\t\t\t\t} else {\n\t\t\t\t\t//面法線の合成\n\t\t\t\t\tif(!sn[i]) {\n\t\t\t\t\t\tnx =0,ny=0,nz=0\n\t\t\t\t\t} else {\n\t\t\t\t\tfor(let j=0;j<sn[i].length;j++) {\n\t\t\t\t\t\tlet ii = sn[i][j] ;\n\t\t\t\t\t\tnx += sf[ii][0] ;\n\t\t\t\t\t\tny += sf[ii][1] ;\n\t\t\t\t\t\tnz += sf[ii][2] ;\n\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet vn = Math.hypot(nx,ny,nz) ;\n\t\t\t\tif(vn==0) {\n\t\t\t\tvbuf.push(0) ;\n\t\t\t\tvbuf.push(0) ;\n\t\t\t\tvbuf.push(0) ;\t\t\t\n\t\t\t\t} else {\n\t\t\t\tvbuf.push(nx/vn) ;\n\t\t\t\tvbuf.push(ny/vn) ;\n\t\t\t\tvbuf.push(nz/vn) ;\n\t\t\t\t}\n\t\t\t\tif(!n) {\n\t\t\t\t\tthis.obj_n.push([nx/vn,ny/vn,nz/vn]); \n\t\t\t\t}\n\t\t\t\tif(t) {\n\t\t\t\t\tvbuf.push(parseFloat( t[i][0]) ) ;\n\t\t\t\t\tvbuf.push(parseFloat( t[i][1]))  ;\n\t\t\t\t}\n\t\t\t\tif(c) {\n\t\t\t\t\tvbuf.push(parseFloat( c[i][0])) ;\n\t\t\t\t\tvbuf.push(parseFloat( c[i][1])) ;\n\t\t\t\t\tvbuf.push(parseFloat( c[i][2])) ;\n\t\t\t\t}\n\t\t\t\tif(addvec) {\n\t\t\t\t\tfor(av=0;av<addvec.length;av++) {\n\t\t\t\t\t\tvbuf = vbuf.concat(addvec[av].data[i]) ;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t//\tconsole.log(vbuf) ;\n\t\t//\tconsole.log(ibuf) ;\n\t\t\tthis.ibuf = ibuf ;\n\t\t\tthis.vbuf = vbuf ;\n\t\t\tlet ret = {mode:\"tri\",vtx_at:[\"position\",\"norm\"],vtx:vbuf,idx:ibuf} ;\n\t\t\tif(t) ret.vtx_at.push(\"uv\") ;\n\t\t\tif(c) ret.vtx_at.push(\"color\") ;\n\t\t\tif(addvec) {\n\t\t\t\tfor(av=0;av<addvec.length;av++) ret.vtx_at.push(addvec[av].attr) ;\n\t\t\t}\n\t\t\treturn ret ;\n\t\t}\n\n\t\t// generate normal vector lines\n\t\t normLines(vm) {\n\t\t\tlet nv = [] ;\n\t\t\tlet v = this.obj_v\n\t\t\tlet n = this.obj_n ;\n\t\t\tif(vm==undefined) vm = 0.1\n\t\t\tfor(let i=0,l=v.length;i<l;i++) {\n\t\t\t\tnv.push(v[i][0]) ;\n\t\t\t\tnv.push(v[i][1]) ;\n\t\t\t\tnv.push(v[i][2]) ;\n\t\t\t\tnv.push(v[i][0]+n[i][0]*vm) ;\n\t\t\t\tnv.push(v[i][1]+n[i][1]*vm) ;\n\t\t\t\tnv.push(v[i][2]+n[i][2]*vm) ;\n\t\t\t}\n\t\t\treturn  {mode:\"lines\",vtx_at:[\"position\"],vtx:nv} ;\n\t\t}\n\t\t// generate wireframe lines\n\t\t wireframe() {\n\t\t\tlet nv = [] ;\n\t\t\tlet v = this.obj_v ;\n\t\t\tlet s = this.obj_i ;\n\t\t\tfor(let k=0,l=s.length;k<l;k++) {\n\t\t\t\tlet ss = s[k]; \n\t\t\t\tlet i\n\t\t\t\tfor(i=1;i<ss.length;i++) {\n\t\t\t\t\tnv.push(v[ss[i-1]][0]) ;\n\t\t\t\t\tnv.push(v[ss[i-1]][1]) ;\n\t\t\t\t\tnv.push(v[ss[i-1]][2]) ;\n\t\t\t\t\tnv.push(v[ss[i]][0]) ;\n\t\t\t\t\tnv.push(v[ss[i]][1]) ;\n\t\t\t\t\tnv.push(v[ss[i]][2]) ;\n\t\t\t\t}\n\t\t\t\tnv.push(v[ss[i-1]][0]) ;\n\t\t\t\tnv.push(v[ss[i-1]][1]) ;\n\t\t\t\tnv.push(v[ss[i-1]][2]) ;\t\t\n\t\t\t\tnv.push(v[ss[0]][0]) ;\n\t\t\t\tnv.push(v[ss[0]][1]) ;\n\t\t\t\tnv.push(v[ss[0]][2]) ;\t\n\t\t\t}\n\t\t\treturn  {mode:\"lines\",vtx_at:[\"position\"],vtx:nv} ;\t\n\t\t}\n\n\t\t// mult 4x4 matrix to model\n\t\t multMatrix4(m4) {\n\t\t\tlet inv = new CanvasMatrix4(m4).invert().transpose() ;\n\t\t\tlet buf = m4.getAsArray()\n\t\t\tfor(let i=0;i<this.obj_v.length;i++) {\n\t\t\t\tlet v = this.obj_v[i] ;\n\t\t\t\tlet vx = buf[0] * v[0] + buf[4] * v[1] + buf[8] * v[2] + buf[12] ;\n\t\t\t\tlet vy = buf[1] * v[0] + buf[5] * v[1] + buf[9] * v[2] + buf[13] ;\n\t\t\t\tlet vz = buf[2] * v[0] + buf[6] * v[1] + buf[10] * v[2] + buf[14] ;\n\t\t\t\tthis.obj_v[i] = [vx,vy,vz] ;\n\t\t\t}\n\t\t\tif(!this.obj_n) return \n\t\t\tbuf = inv.getAsArray() \n\t\t\tfor(let i=0;i<this.obj_n.length;i++) {\n\t\t\t\tlet v = this.obj_n[i] ;\n\t\t\t\tlet vx = buf[0] * v[0] + buf[4] * v[1] + buf[8] * v[2] + buf[12] ;\n\t\t\t\tlet vy = buf[1] * v[0] + buf[5] * v[1] + buf[9] * v[2] + buf[13] ;\n\t\t\t\tlet vz = buf[2] * v[0] + buf[6] * v[1] + buf[10] * v[2] + buf[14] ;\n\t\t\t\tthis.obj_n[i] = [vx,vy,vz] ;\n\t\t\t}\n\t\t}\n\t\t// merge model\n\t\t mergeModels(models) {\n\t\t\tlet m = this ;\n\t\t\tlet ofs = 0 ;\n\t\t\tfor(let i=0;i<models.length;i++) {\n\t\t\t\tm.obj_v = m.obj_v.concat(models[i].obj_v) \n\t\t\t\tm.obj_n = m.obj_n.concat(models[i].obj_n) \n\t\t\t\tm.obj_t = m.obj_t.concat(models[i].obj_t)\n\t\t\t\tfor(let j=0;j<models[i].obj_i.length;j++) {\n\t\t\t\t\tlet p = models[i].obj_i[j] ;\n\t\t\t\t\tlet pp = [] ;\n\t\t\t\t\tfor( n=0;n<p.length;n++) {\n\t\t\t\t\t\tpp.push( p[n]+ofs ) ;\n\t\t\t\t\t}\n\t\t\t\t\tm.obj_i.push(pp) ;\n\t\t\t\t}\n\t\t\t\tofs += models[i].obj_v.length ;\n\t\t\t}\n\t\t\treturn m ;\n\t\t}\n\t\t// calc bounding box \n\t\tboundbox() {\n\t\t\tlet sx = Number.MAX_VALUE\n\t\t\tlet sy = sx \n\t\t\tlet sz = sx \n\t\t\tlet ex = Number.MIN_VALUE \n\t\t\tlet ey = ex \n\t\t\tlet ez = ex \n\t\t\t\n\t\t\tfor(let i=0;i<this.obj_v.length;i++) {\n\t\t\t\tlet v = this.obj_v[i] ;\t\n\t\t\t\tif( v[0] < sx ) sx = v[0]\n\t\t\t\tif( v[1] < sy ) sy = v[1] \n\t\t\t\tif( v[2] < sz ) sz = v[2] \n\t\t\t\tif( v[0] > ex ) ex = v[0] \n\t\t\t\tif( v[1] > ey ) ey = v[1] \n\t\t\t\tif( v[2] > ez ) ez = v[2] \n\t\t\t}\n\t\t\treturn [[sx,sy,sz],[ex,ey,ez]]\n\t\t}\n\n\t\t// load external file \n\t\tloadAjax(src) {\n\t\t\treturn new Promise(function(resolve,reject) {\n\t\t\t\tlet req = new XMLHttpRequest();\n\t\t\t\treq.open(\"get\",src,true) ;\n\t\t\t\treq.responseType = \"text\" ;\n\t\t\t\treq.onload = function() {\n\t\t\t\t\tif(this.status==200) {\n\t\t\t\t\t\tresolve(this.response) ;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(\"Ajax error:\"+this.statusText) ;\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treq.onerror = function() {\n\t\t\t\t\treject(\"Ajax error:\"+this.statusText)\n\t\t\t\t}\n\t\t\t\treq.send() ;\n\t\t\t})\n\t\t}\n\t\tstatic loadLines(path,cb,lbufsize) {\n\n\t\t\tif(!lbufsize) lbufsize = 10000\n\t\t\tconst decoder = new TextDecoder\n\t\t\treturn new Promise((resolve,reject)=>{\n\t\t\t\tif(Array.isArray(path)) {\n\t\t\t\t\tfor(let i=0;i<path.length;i++) {\n\t\t\t\t\t\tcb(path[i])\n\t\t\t\t\t}\n\t\t\t\t\tresolve(path)\n\t\t\t\t\treturn \n\t\t\t\t}\n\t\t\t\tif(path.constructor == File ){\t// load File\n\t\t\t\t\tconst reader = new FileReader()\n\t\t\t\t\treader.onload = (e)=> {\n\t\t\t\t\t\tconst l = e.target.result.split(\"\\n\")\n\t\t\t\t\t\tfor(let i=0;i<l.length;i++) {\n\t\t\t\t\t\t\tcb(l[i])\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(path)\n\t\t\t\t\t}\n\t\t\t\t\treader.readAsText(path)\n\t\t\t\t\treturn \n\t\t\t\t}\n\t\t\t\tfetch( path , {\n\t\t\t\t\tmethod:\"GET\"\n\t\t\t\t}).then( async resp=>{\n\t\t\t\t\tif(resp.ok) {\n\t\t\t\t\t\tconst reader = resp.body.getReader();\n\t\t\t\t\t\tconst buf = new Uint8Array(lbufsize)\n\t\t\t\t\t\tlet bi = 0 \n\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\tconst {done, value} = await reader.read();\n\t\t\t\t\t\t\tif (done) {\n\t\t\t\t\t\t\t  cb(decoder.decode(buf.slice(0,bi))) \n\t\t\t\t\t\t\t  resolve(resp)\n\t\t\t\t\t\t\t  break;\n\t\t\t\t\t\t\t}\n\t\t//\t\t\t\t\tconsole.log(value.length)\n\t\t\t\t\t\t\tfor (const char of value) {\n\t\t\t\t\t\t\t\tbuf[bi++] = char \n\t\t\t\t\t\t\t\tif(char == 0x0a ) {\n\t\t\t\t\t\t\t\t\tcb(decoder.decode(buf.slice(0,bi-1))) \n\t\t\t\t\t\t\t\t\tbi = 0 \n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(resp)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\t// load .obj file\n\t\tasync loadObj(path,scale) {\n\t\t\tif(!scale) scale=1.0 ;\n\t\t\treturn new Promise((resolve,reject)=> {\n\t\t\t\tthis.loadAjax(path).then((data)=> {\n\t\t//\t\t\tconsole.log(data) ;\n\t\t\t\t\tlet l = data.split(\"\\n\") ;\n\t\t\t\t\tlet v = [];\n\t\t\t\t\tlet n = [] ;\n\t\t\t\t\tlet x = [] ;\n\t\t\t\t\tlet t = [] ;\n\t\t\t\t\tlet c = [] ;\n\t\t\t\t\tlet xi = {} ;\n\t\t\t\t\tlet xic = 0 ;\n\n\t\t\t\t\tfor(let i = 0,len=l.length;i<len;i++) {\n\t\t\t\t\t\tif(l[i].match(/^#/)) continue ;\n\t\t\t\t\t\tif(l[i].match(/^eof/)) break ;\n\t\t\t\t\t\tlet ll = l[i].split(/\\s+/) ;\n\t\t\t\t\t\tif(ll[0] == \"v\") {\n\t\t\t\t\t\t\tv.push([ll[1]*scale,ll[2]*scale,ll[3]*scale]) ;\n\t\t\t\t\t\t\tif(ll.length==7) c.push([ll[4],ll[5],ll[6]])\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(ll[0] == \"vt\") {\n\t\t\t\t\t\t\tt.push([ll[1],ll[2]]) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(ll[0] == \"vn\") {\n\t\t\t\t\t\t\tn.push([ll[1],ll[2],ll[3]]) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(ll[0] == \"f\") {\n\t\t\t\t\t\t\tlet ix = [] ;\n\t\t\t\t\t\t\tfor(let ii=1;ii<ll.length;ii++) {\n\t\t\t\t\t\t\t\tif(ll[ii]==\"\") continue ;\n\t\t\t\t\t\t\t\tif(!(ll[ii] in xi)) xi[ll[ii]] = xic++ ; \n\t\t\t\t\t\t\t\tix.push(xi[ll[ii]]) ;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tx.push(ix) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.obj_v = [] ;\n\t\t\t\t\tif(c.length>0) this.obj_c = [] \n\t\t\t\t\tthis.obj_i =x ;\n\t\t\t\t\tif(n.length>0) this.obj_n = [] ;\n\t\t\t\t\tif(t.length>0) this.obj_t = [] ;\n\t\t\t\t\tif(x.length>0) {\n\t\t\t\t\t\tfor(let i in xi) {\n\t\t\t\t\t\t\tlet si = i.split(\"/\") ;\n\t\t\t\t\t\t\tlet ind = xi[i] ;\n\t\t\t\t\t\t\tthis.obj_v[ind] = v[si[0]-1] ;\n\t\t\t\t\t\t\tif(c.length>0) this.obj_c[ind] = c[si[0]-1]  \n\t\t\t\t\t\t\tif(t.length>0) this.obj_t[ind] = t[si[1]-1] ;\n\t\t\t\t\t\t\tif(n.length>0) this.obj_n[ind] = n[si[2]-1] ;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.obj_v = v \n\t\t\t\t\t\tif(c.length>0) this.obj_c = c\n\t\t\t\t\t\tif(n.length>0) this.obj_n = n\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"loadobj \"+path+\" vtx:\"+v.length+\" norm:\"+n.length+\" tex:\"+t.length+\" idx:\"+x.length+\" vbuf:\"+this.obj_v.length) ;\n\t\t\t\t\tresolve(this) ;\n\t\t\t\t}).catch(function(err) {\n\t\t\t\t\treject(err) ;\n\t\t\t\t})\n\t\t\t}) ;\n\t\t}\n\t\tstatic async loadObj2(path,opt) {\n\n\t\t\tlet scale = 1.0\n\t\t\tlet zup = false  \n\t\t\tlet nogroup = false \n\t\t\tlet nomtl = false \n\t\t\tif(opt) {\n\t\t\t\tif(opt.scale) scale=opt.scale\n\t\t\t\tif(opt.zup) zup = opt.zup\n\t\t\t\tif(opt.nogroup) nogroup = opt.nogroup\n\t\t\t\tif(opt.nomtl) nomtl = opt.nomtl\n\t\t\t}\n\t\t\treturn new Promise((resolve,reject)=> {\n\t\t\t\tconst v = [];\n\t\t\t\tconst n = [] ;\n\t\t\t\tconst xl = {} ;\n\t\t\t\tconst t = [] ;\n\t\t\t\tconst c = [] ;\n\t\t\t\tconst xi = {} ;\n\t\t\t\tconst rxi = []\n\t\t\t\tlet xic = 0 ;\n\t\t\t\tlet usemtl = \"\" \n\t\t\t\tlet group = \"\" \n\t\t\t\tconst pmtls = []\n\t\t\t\tconst mtlspath = [] \n\t\t\t\tWWModel.loadLines(path,async l=>{\n\t\t\t\t\t\tif(l.match(/^#/)) return ;\n\t\t\t\t\t\tif(l.match(/^eof/)) return ;\n\t\t\t\t\t\tconst ll = l.split(/\\s+/) ;\n\t\t\t\t\t\tconst cmd = ll[0]\n\t\t\t\t\t\tif(cmd == \"v\") {\n\t\t\t\t\t\t\tif(zup) v.push([ll[1]*scale,ll[3]*scale,-ll[2]*scale]) ;\n\t\t\t\t\t\t\telse v.push([ll[1]*scale,ll[2]*scale,ll[3]*scale]) ;\n\t\t\t\t\t\t\tif(ll.length==7) c.push([ll[4],ll[5],ll[6]])\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cmd == \"vt\") {\n\t\t\t\t\t\t\tt.push([ll[1],ll[2]]) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cmd == \"vn\") {\n\t\t\t\t\t\t\tif(zup) n.push([ll[1],ll[3],-ll[2]]) ;\n\t\t\t\t\t\t\telse  n.push([ll[1],ll[2],ll[3]]) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cmd == \"f\") {\n\t\t\t\t\t\t\tlet ix = [] ;\n\t\t\t\t\t\t\tfor(let ii=1;ii<ll.length;ii++) {\n\t\t\t\t\t\t\t\tif(ll[ii]==\"\") continue ;\n\t\t\t\t\t\t\t\tif(!(ll[ii] in xi)) {\n\t\t\t\t\t\t\t\t\txi[ll[ii]] = xic++ ; \n\t\t\t\t\t\t\t\t\trxi[xi[ll[ii]]] = ll[ii]\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tix.push(xi[ll[ii]]) ;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(!xl[group]) xl[group] = {} \n\t\t\t\t\t\t\tif(!xl[group][usemtl]) xl[group][usemtl] = []\n\t\t\t\t\t\t\txl[group][usemtl].push(ix) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cmd == \"mtllib\") {\n\t\t\t\t\t\t\tif(path.constructor == File || Array.isArray(path) ){\n\t\t\t\t\t\t\t\t\tmtlspath.push(\tll.splice(1).join(\" \").trim())\n\t\t\t\t\t\t\t\t return\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tlet pp = path.split(\"/\") \n\t\t\t\t\t\t\tpp[pp.length-1] = ll[1] \n\t\t\t\t\t\t\tpmtls.push( WWModel.loadMtl(pp.join(\"/\")) )\n\t\t\t\t\t\t\tmtlspath.push(pp)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cmd == \"usemtl\") {\n\t\t\t\t\t\t\tif(!nomtl) usemtl = ll[1] \n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cmd == \"g\") {\n\t\t\t\t\t\t\tif(!nogroup) group = ll[1] \n\t\t\t\t\t\t}\n\t\t\t\t}).then(r=>{\n\t\t\t\t\tconst groups = []\n\t\t\t\t\tlet objs\n\t\t//\t\t\tconsole.log(xl)\n\t\t//\t\t\tconsole.log(rxi)\n\t\t\t\t\tfor(let g in xl) {\n\t\t\t\t\t\tobjs = [] \n\t\t\t\t\t\tfor( let m in xl[g]) {\n\t\t\t\t\t\t\tlet x = xl[g][m]\n\t\t\t\t\t\t\tconst obj = new WWModel() \n\t\t\t\t\t\t\tobj.obj_v = [] ;\n\t\t\t\t\t\t\tif(c.length>0) obj.obj_c = [] \n\t\t\t\t\t\t\tif(n.length>0) obj.obj_n = [] ;\n\t\t\t\t\t\t\tif(t.length>0) obj.obj_t = [] ;\n\t\t\t\t\t\t\tobj.obj_i =x ;\n\t\t\t\t\t\t\tif(x.length>0) {\n\t\t\t\t\t\t\t\tfor(let i in xi) {\n\t\t\t\t\t\t\t\t\tlet si = i.split(\"/\") ;\n\t\t\t\t\t\t\t\t\tlet ind = xi[i] ;\n\t\t\t\t\t\t\t\t\tobj.obj_v[ind] = v[si[0]-1] ;\n\t\t\t\t\t\t\t\t\tif(c.length>0) obj.obj_c[ind] = c[si[0]-1]  \n\t\t\t\t\t\t\t\t\tif(t.length>0) obj.obj_t[ind] = t[si[1]-1] ;\n\t\t\t\t\t\t\t\t\tif(n.length>0) obj.obj_n[ind] = n[si[2]-1] ;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tobj.obj_v = v \n\t\t\t\t\t\t\t\tif(c.length>0) obj.obj_c = c\n\t\t\t\t\t\t\t\tif(n.length>0) obj.obj_n = n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tobjs.push({obj:obj,mtlname:m})\n\t\t\t\t\t\t\tif(typeof path !=\"string\") path=\"\"\n\t\t\t\t\t\t\tconsole.log(\"loadobj \"+path+\" vtx:\"+v.length+\" norm:\"+n.length+\" tex:\"+t.length+\" idx:\"+x.length+\" vbuf:\"+obj.obj_v.length) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tgroups.push({objs:objs,group:g})\n\t\t\t\t\t}\n\t\t\t\t\tif(pmtls.length>0) {\n\t\t\t\t\t\tPromise.all(pmtls).then(mtls=> {\n\t\t\t\t\t\t\tlet allmtls = {} \n\t\t\t\t\t\t\tfor(let i in mtls) {\n\t\t\t\t\t\t\t\tallmtls = Object.assign(allmtls,mtls[i]) \n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tresolve((nogroup)?{objs:objs,mtls:allmtls}:{groups:groups,mtls:allmtls})\n\t\t\t\t\t\t})\n\t\t\t\t\t} else resolve((nogroup)?{objs:objs,mtlpaths:mtlspath}:{groups:groups,mtlpaths:mtlspath})\n\t\t\t\t\t\t\t\t\n\t\t\t\t}).catch(err=> {\n\t\t\t\t\treject(err) ;\n\t\t\t\t})\n\t\t\t}) ;\n\t\t}\n\t\tstatic async loadMtl(path) {\n\t\t\tconst mtls = []\n\t\t\tlet mtlname = \"\" \n\t\t\treturn new Promise((resolve,reject)=> {\n\t\t\t\tWWModel.loadLines(path,l=>{\n\t\t\t\t\tif(l.match(/^#/)) return \n\t\t\t\t\tif(l.match(/^eof/)) return \n\t\t\t\t\tlet ll = l.split(/\\s+/) \n\t\t\t\t\tlet cmd = ll.shift()\n\t\t\t\t\tif(cmd==\"\") cmd = ll.shift() \n\t\t\t\t\tif(cmd==\"newmtl\") {\n\t\t\t\t\t\tmtlname = ll[0] \n\t\t\t\t\t\tmtls[mtlname] = {}\n\t\t\t\t\t\treturn  \n\t\t\t\t\t}\n\t\t\t\t\tswitch(cmd) {\n\t\t\t\t\t\tcase \"Kd\":\t//diffuse\n\t\t\t\t\t\tcase \"Ks\":\t//specular\n\t\t\t\t\t\tcase \"Ka\":\t//ambient\n\t\t\t\t\t\tcase \"Tf\":\t// transmission filter\n\t\t\t\t\t\t\tmtls[mtlname][cmd] = [parseFloat(ll[0]),parseFloat(ll[1]),parseFloat(ll[2])]\n\t\t\t\t\t\t\tbreak ;\n\t\t\t\t\t\tcase \"Ni\":\t//reflaction\n\t\t\t\t\t\tcase \"d\":\t//diffuse\n\t\t\t\t\t\tcase \"Ns\":\t//spec Shininess\n\t\t\t\t\t\tcase \"Tr\":\t//transparent\n\t\t\t\t\t\t\tmtls[mtlname][cmd] = parseFloat(ll[0])\n\t\t\t\t\t\t\tbreak ;\n\t\t\t\t\t\tcase \"illum\":\n\t\t\t\t\t\t\tmtls[mtlname][cmd] = parseInt(ll[0])\n\t\t\t\t\t\t\tbreak ;\n\t\t\t\t\t\tcase \"map_Kd\":\n\t\t\t\t\t\tcase \"map_Ka\":\n\t\t\t\t\t\tcase \"map_Ks\":\n\t\t\t\t\t\t\tmtls[mtlname][cmd] = ll.join(\" \").trim()\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}).then(r=>{\n\t\t//\t\t\tconsole.log(mtls)\n\t\t\t\t\tresolve(mtls) \n\t\t\t\t}).catch(err=> {\n\t\t\t\t\treject(err) ;\n\t\t\t\t})\t\t\t\n\t\t\t})\n\t\t}\n\n\n\t\t// other utils \n\t\tstatic  HSV2RGB( H, S, V ,a) {\n\t\t\tlet ih;\n\t\t\tlet fl;\n\t\t\tlet m, n;\n\t\t\tlet rr,gg,bb ;\n\t\t\tH = H * 6 ;\n\t\t\tih = Math.floor( H );\n\t\t\tfl = H - ih;\n\t\t\tif( !(ih & 1)) fl = 1 - fl;\n\t\t\tm = V * ( 1 - S );\n\t\t\tn = V * ( 1 - S * fl );\n\t\t\tswitch( ih ){\n\t\t\t\tcase 0:\n\t\t\t\tcase 6:\n\t\t\t\t\trr = V; gg = n; bb = m; break;\n\t\t\t\tcase 1: rr = n; gg = V; bb = m; break;\n\t\t\t\tcase 2: rr = m; gg = V; bb = n; break;\n\t\t\t\tcase 3: rr = m; gg = n; bb = V; break;\n\t\t\t\tcase 4: rr = n; gg = m; bb = V; break;\n\t\t\t\tcase 5: rr = V; gg = m; bb = n; break;\n\t\t\t}\n\t\t\treturn [rr,gg,bb,(a===undefined)?1.0:a] ;\n\t\t}\n\t\tstatic  snormal(pa) {\n\t\t\tlet yx = pa[1][0]-pa[0][0];\n\t\t\tlet yy = pa[1][1]-pa[0][1];\n\t\t\tlet yz = pa[1][2]-pa[0][2];\n\t\t\tlet zx = pa[2][0]-pa[0][0];\n\t\t\tlet zy = pa[2][1]-pa[0][1];\n\t\t\tlet zz = pa[2][2]-pa[0][2];\t\t\t\t\n\t\t\tlet xx =  yy * zz - yz * zy;\n\t\t\tlet xy = -yx * zz + yz * zx;\n\t\t\tlet xz =  yx * zy - yy * zx;\n\t\t\tlet vn = Math.hypot(xx,xy,xz) ;\n\t\t\txx /= vn ; xy /= vn ; xz /= vn ;\n\t\t\treturn [xx,xy,xz] ;\n\t\t}\n\n\t} //class WWModel\n\n\treturn poxp.WWModel = WWModel;\n});\n\n"]}