/**
 * skylark-poxp - A version of poxp that ported to running on skylarkjs
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-poxp/
 * @license MIT
 */
define(["./poxp","./CanvasMatrix4","./Json2Canvas"],function(t,e,s){return t.util={Cpanel:class{constructor(t,i){this.hide=!1,i||(i={}),void 0===i.width&&(i.width=100),void 0===i.height&&(i.height=50),void 0===i.font&&(i.font="10px monospace"),void 0===i.color&&(i.color="red"),void 0===i.lines&&(i.lines=5),void 0===i.lheight&&(i.lheight=10),void 0===i.ry&&(i.ry=40),void 0===i.pos&&(i.pos=[-.2,.2,-.8]),void 0===i.camFix&&(i.camFix=!0),this.pcanvas=document.createElement("canvas"),this.pcanvas.width=i.width,this.pcanvas.height=i.height,this.j2c=new s(this.pcanvas),this.j2c.default.font=i.font,this.j2c.default.textColor=i.color,this.clearColor=i.clearColor,this.ctx=this.j2c.ctx,this.dd=[];let h=i.lheight;for(let t=0;t<i.lines;t++,h+=i.lheight)this.dd.push({shape:"text",str:"",x:0,y:h,width:i.width});this.j2c.draw(this.dd),this.id=(new Date).getTime()+Math.floor(1e3*Math.random());const a={name:"cpanel"+this.id,canvas:this.pcanvas,opt:{flevel:1,repeat:2,nomipmap:!0}};t.addTex(a),this.model={name:"panel"+this.id,geo:(new WWModel).primitive("plane",{wx:i.width/1e3,wy:i.height/1e3}).objModel(),camFix:i.camFix,layer:i.layer,bm:(new e).rotate(i.ry,0,1,0).translate(i.pos),blend:"alpha",vs_uni:{uvMatrix:[1,0,0,0,1,0,0,0,0]},fs_uni:{tex1:"cpanel"+this.id,colmode:2,shmode:1}},t.addModel(this.model)}show(t){this.hide=!t,this.model.hide=this.hide}update(t,e){if(!this.hide){this.j2c.clear(this.clearColor);for(let t=0;t<e.length;t++)null!==e[t]&&(this.dd[t].str=e[t]);this.j2c.draw(this.dd),t.updateTex("cpanel"+this.id,this.pcanvas)}}},Beam:class{constructor(t){this.len=200,this.color=[1,1,0,1],this.cofs=[.3,-.5,.2],this.vs=this.cofs.slice(0),this.ve=[this.len/2,this.len/2,-this.len],this.bv=[0,0,-1],t.addModel({name:"beam",geo:{mode:"lines",vtx_at:["position"],vtx:this.vs.concat(this.ve)},fs_uni:{colmode:0,shmode:1,bcolor:this.color}})}update(t,e){let s=t.getModelData("beam").geo.vtx,i=POX.poxp.gPad;if(i&&i.pose){this.ori=i.pose.orientation;let h=this.cofs[0]*("right"==i.hand?1:-1),a=this.cofs[1],o=this.cofs[2],n=Mat4.v2q(-e.camRY,0,1,0),l=(new Mat4).q2m(Mat4.qMult(n,this.ori));l.translate(e.camCX,e.camCY,e.camCZ),this.vs=l.multVec4(h,0,o,1),this.vs[1]=a+e.camCY,this.ve=l.multVec4(0,0,-this.len,1),this.bv=Mat4.V3norm(Mat4.V3sub(this.ve,this.vs)),s[0]=this.vs[0],s[1]=this.vs[1],s[2]=this.vs[2],s[3]=this.ve[0],s[4]=this.ve[1],s[5]=this.ve[2],t.updateModel("beam","vbo",s)}}},Pool:class{constructor(){this._use=[],this._free=[]}CreateInstance(){return{}}InitInstance(t){return t}Rent(){let t;return this._free.length>0?(t=this._free[this._free.length-1],this._free.pop()):t=this.CreateInstance(),this.InitInstance(t),this._use.push(t),t}Return(t){for(let e in this._use)if(this._use[e]===t){this._use.splice(e,1);break}this._free.push(t)}Alloc(t){for(let e=0;e<t;e++)this._free.push(this.CreateInstance())}GetInstances(){return this._use}}}});
//# sourceMappingURL=sourcemaps/util.js.map
