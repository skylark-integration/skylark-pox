{"version":3,"sources":["Player.js"],"names":["define","pox","CanvasMatrix4","GPad","Pointer","PoxCamera","POXPDevice","WBind","WWG","WWModel","$","Mat4","RAD","Player","[object Object]","can","opt","this","version","Promise","HTMLElement","document","querySelector","wwg","initopt","preserveDrawingBuffer","capture","antialias","xrCompatible","noWebGL2","init2","init","needWebGL2","Param","create","param","bindInput","ui","isStereo","autorot","pause","bindHtml","fps","camselect","pixRatio","synth","poxp","eventListener","gPad","name","gPad2","pad","f","log","gp","hand","ev","ret","callEvent","b","p","resize","window","addEventListener","e","createElement","setAttribute","style","position","zIndex","top","left","width","height","padding","border","opacity","parentNode","appendChild","keyElelment","focus","setEvent","checkVR","then","console","vrReady","cam0","createCamera","setCam","camFar","cam1","ccam","cb","el","active","frame","push","gpad","vrchange","filter","VRReady","presentVR","body","webkitRequestFullscreen","base","ssize","offsetWidth","offsetHeight","webkitFullscreenElement","innerWidth","innerHeight","closeVR","dragging","down","d","x","y","sx","sy","event","cam","camMode","move","ox","oy","dx","dy","up","ex","ey","out","wheel","gesture","z","r","gyro","addev","querySelectorAll","forEach","o","target","id","key","getAttribute","preventDefault","devicePixelRatio","resolve","reject","req","XMLHttpRequest","open","responseType","onload","status","response","statusText","onerror","send","path","match","loadImageAjax","img","Image","src","uidom","vs","fs","POX","loadImage","loadAjax","addEvent","exitVR","V3add","i","arguments","length","V3len","v","Math","hypot","V3norm","s","l","undefined","V3mult","V3dot","v1","v2","Vdistance","map","setScene","async","scene","catch","err","stack","msg","errCb","addModel","model","render","removeModel","getModelData","m","parseJS","eval","Function","emsg","constructor","setting","needWGL2","setParam","split","inc","RegExp","$1","all","res","c","concat","join","cancelAnimationFrame","loop","unload","clear","kind","rtime","vrmode","dbtn","leftPad","rightPad","primaryPad","secondaryPad","dom","uparam","input","type","step","tag","_tohex","toString","_setdisp","getElementById","innerHTML","substr","setFunc","set","min","max","get","parseInt","value","sc","sset","scale","vshader","text","fshader","createRender","isVR","self","bm","mMtx","mvMtx","vpMtx","iMtx","miMtx","setRender","renderStart","clearEvent","st","Date","getTime","ctime","ltime","tt","rt","ft","fc","loopf","timestamp","animationFrame","ct","floor","camRY","rp","lp","pp","sp","p1","p2","emu","conn","setPad","update","camm","getMtx","upd","updateTimer","time","data","sort","a","al","layer","bl","vp","getViewport","WebXR","isPresenting","gl","bindFramebuffer","FRAMEBUFFER","webGLLayer","framebuffer","mtx2","modelMtx2","vs_uni","fs_uni","viewport","leftViewport","draw","rightViewport","stereo","submitFrame","getParentMtx","parent","mm","multRight","mod","models","load","group","g","gi","gg","ggi","getModelIdx","uni0","modelMatrix","getAsWebGLFloatArray","vpMatrix","camP","camVP","mvpMatrix","invMatrix","invert","transpose","minvMatrix","uni1","vpMatrix_l","vpMatrix_r","resolution","camMatirx","camV","eyevec","camX","camY","camZ","prototype","Camera"],"mappings":"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","file":"../Player.js","sourcesContent":["define([\n\t\"./pox\",\n\t\"./CanvasMatrix4\",\n\t\"./GPad\",\n\t\"./Pointer\",\n\t\"./Camera\",\n\t\"./Device\",\n\t\"./WBind\",\n\t\"./WWG\",\n\t\"./WWModel\"\n],function(pox,CanvasMatrix4,GPad,Pointer,PoxCamera,POXPDevice,WBind,WWG,WWModel){\n\t//poxplayer.js\n\t//  PolygonExplorer Player\n\t//   wakufactory.jp\n\t\"use strict\" ;\n\n\tvar $ = pox.$;\n\n\tconst Mat4 = CanvasMatrix4 // alias\n\tconst RAD = pox.RAD;\n\n\tclass Player {\n\n\t\tconstructor(can,opt) {\n\t\t\tthis.version = \"2.2.0\" \n\t\t\tif(!Promise) {\n\t\t\t\tthrow \"This browser is not supported!!\"\t\n\t\t\t}\n\t\t\tif(!opt) opt = {} \n\t\t\tthis.can = (can instanceof HTMLElement)?can:document.querySelector(can)  ;\n\n\t\t\t// wwg initialize\n\t\t\tconst wwg = new WWG() ;\n\t\t\tconst initopt = {preserveDrawingBuffer: opt.capture,antialias:true, xrCompatible: true }\n\t\t\tconst useWebGL2 = !opt.noWebGL2\n\t\t\tif(!(useWebGL2 && wwg.init2(this.can,initopt)) && !wwg.init(this.can,initopt)) {\n\t\t\t\tthrow \"wgl not supported!\"\n\t\t\t}\n\t\t\tif(opt.needWebGL2 && wwg.version!=2) {\n\t\t\t\tthrow \"needs wgl2\"\n\t\t\t}\n\t\t\tthis.wwg = wwg ;\n\t\t//\tif(window.WAS!=undefined) this.synth = new WAS.synth() \n\t\t\t\n\t\t\tconst Param = WBind.create() ;\n\t\t\tthis.param = Param ;\n\t\t\tParam.bindInput(\"isStereo\",(opt.ui && opt.ui.isStereo)?opt.ui.isStereo:\"#isstereo\") ;\n\t\t\tParam.bindInput(\"autorot\",(opt.ui && opt.ui.autorot)?opt.ui.autorot:\"#autorot\") ;\n\t\t\tParam.bindInput(\"pause\",(opt.ui && opt.ui.pause)?opt.ui.pause:\"#pause\") ;\n\t\t\tParam.bindHtml(\"fps\",(opt.ui && opt.ui.fps)?opt.ui.fps:\"#fps\") ;\n\t\t\tParam.bindInput(\"camselect\",(opt.ui && opt.ui.camselect)?opt.ui.camselect:\"#camselect\") ;\n\t\t\t\n\t\t\tthis.pixRatio = 1 \n\t\t\tthis.pox = {\n\t\t\t\tcan:this.can,\n\t\t\t\twwg:this.wwg,\n\t\t\t\tWWModel : WWModel,\n\t\t\t\tCanvasMatrix4 : CanvasMatrix4,\n\t\t\t\tMat4 : CanvasMatrix4,\n\t\t\t\tsynth:this.synth,\n\t\t\t\tpoxp:this\n\t\t\t}\n\t\t\tthis.eventListener = {}\n\n\t\t\tif(GPad) {\n\t\t\t\tthis.pox.gPad = new GPad()\n\t\t\t\tthis.pox.gPad.name = \"1\"\n\t\t\t\tthis.pox.gPad2 = new GPad()\n\t\t\t\tthis.pox.gPad2.name = \"2\"\n\t\t\t\tif(!this.pox.gPad.init(0,(pad,f)=>{\n\t\t\t\t\tif(f) {\n\t\t\t\t\t\tthis.pox.log(\"set 1\"+pad.gp.hand)\n\t\t\t\t\t}\n\t\t\t\t}))\n\t\t\t\tif(!this.pox.gPad2.init(1,(pad,f)=>{\n\t\t\t\t\tif(f) {\n\t\t\t\t\t\tthis.pox.log(\"set 2\"+pad.gp.hand)\n\t\t\t\t\t}\n\t\t\t\t}))\n\t\t//\t\tconsole.log(this.pox.gPad)\n\t\t\t\tthis.pox.gPad.ev = (pad)=> {\n\t\t\t\t\tret = this.callEvent(\"gpad\",pad) ;\n\t\t\t\t}\n\t\t\t\tthis.pox.gPad2.ev = (pad,b,p)=> {\n\t\t\t\t\tret = this.callEvent(\"gpad\",pad) ;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// canvas initialize\n\t\t\tthis.resize() ;\n\t\t\twindow.addEventListener(\"resize\",()=>{this.resize()}) ;\n\t\t\tthis.pause = true ;\n\n\t\t\t//set key capture dummy input\n\t\t\tconst e = document.createElement(\"input\") ;\n\t\t\te.setAttribute(\"type\",\"checkbox\") ;\n\t\t\te.style.position = \"absolute\" ; e.style.zIndex = -100 ;\n\t\t\te.style.top = 0 ;e.style.left = \"-20px\"\n\t\t\te.style.width = \"10px\" ; e.style.height =\"10px\" ; e.style.padding = 0 ; e.style.border = \"none\" ; e.style.opacity = 0 ;\n\t\t\tthis.can.parentNode.appendChild(e) ;\n\t\t\tthis.keyElelment = e ;\n\t\t\tthis.keyElelment.focus() ;\n\n\t\t\tthis.setEvent() ;\n\t\t\t// VR init \n\t\t\tPOXPDevice.checkVR(this).then(f=>{\n\t\t\t\tif(f) console.log((POXPDevice.vrDisplay)?\"WebVR\":\"WebXR\"+\" supported\")\n\t\t\t\tthis.vrReady = f \n\t\t\t})\n\t\t\t//create default camera\n\t\t\tthis.cam0 = this.createCamera()\n\t\t\tthis.cam0.setCam({camFar:10000})\n\t\t\tthis.cam1 = this.createCamera() ;\n\t\t\tthis.ccam = this.cam1 \n\t\t}\n\t\taddEvent(ev,cb) {\n\t\t\tlet el = null\n\t\t\tswitch(ev) {\n\t\t\t\tcase \"frame\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.frame.push(el)\n\t\t\t\t\tbreak \n\t\t\t\tcase \"gpad\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.gpad.push(el)\n\t\t\t\t\tbreak \n\t\t\t\tcase \"vrchange\":\n\t\t\t\t\tel = {cb:cb,active:true}\n\t\t\t\t\tthis.eventListener.vrchange.push(el)\n\t\t\t\t\tbreak \n\t\t\t}\n\t\t\treturn el\n\t\t}\n\t\tremoveEvent (ev) {\n\t\t\tthis.eventListener.frame = this.eventListener.frame.filter((e)=>(e!==ev))\n\t\t\tthis.eventListener.gpad = this.eventListener.gpad.filter((e)=>(e!==ev))\n\t\t\tthis.eventListener.vrchange = this.eventListener.vrchange.filter((e)=>(e!==ev))\n\t\t}\n\t\tclearEvent() {\n\t\t\tthis.eventListener.frame = []\n\t\t\tthis.eventListener.gpad = []\n\t\t\tthis.eventListener.vrchange = []\n\t\t}\n\t\tenterVR() {\n\t\t\tlet ret = true\n\t\t\tif(POXPDevice.VRReady) {\n\t\t\t\tconsole.log(\"enter VR\")\n\t\t\t\tPOXPDevice.presentVR(this)\n\t\t\t} else if(document.body.webkitRequestFullscreen) {\n\t\t\t\tconsole.log(\"fullscreen\")\n\t\t\t\tconst base = this.can.parentNode\n\t\t\t\tthis.ssize = {width:base.offsetWidth,height:base.offsetHeight}\n\t\t\t\tdocument.addEventListener(\"webkitfullscreenchange\",(ev)=>{\n\t\t\t\t\tif( document.webkitFullscreenElement) {\n\t\t\t\t\t\tbase.style.width = window.innerWidth + \"px\"\n\t\t\t\t\t\tbase.style.height = window.innerHeight + \"px\"\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbase.style.width = this.ssize.width + \"px\"\n\t\t\t\t\t\tbase.style.height = this.ssize.height + \"px\"\t\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tbase.webkitRequestFullscreen()\n\t\t\t} else ret = false \n\t\t\treturn ret \n\t\t}\n\t\texitVR() {\n\t\t\tif(POXPDevice.VRReady) {\n\t\t\t\tPOXPDevice.closeVR(this)\n\t\t\t}\n\t\t}\n\t\tsetEvent() {\n\t\t\t// mouse and key intaraction\n\t\t\tlet dragging = false ;\n\t\t\tconst Param = this.param ;\n\t\t\tconst can = this.can ;\n\n\t\t\t//mouse intraction\n\t\t\tconst m = new Pointer(can,{\n\t\t\t\tdown:(d)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"down\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,sx:d.sx*this.pixRatio,sy:d.sy*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"down\",d)\n\t\t\t\t\tdragging = true ;\n\t\t\t\t\tif(this.ccam.cam.camMode==\"walk\") this.keyElelment.focus() ;\n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tmove:(d)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"move\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,ox:d.ox*this.pixRatio,oy:d.oy*this.pixRatio,dx:d.dx*this.pixRatio,dy:d.dy*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"move\",d) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tup:(d)=> {\n\t\t\t\t\tif(!this.ccam) return true ;\n\t\t\t\t\tdragging = false ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"up\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,dx:d.dx*this.pixRatio,dy:d.dy*this.pixRatio,ex:d.ex*this.pixRatio,ey:d.ey*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"up\",d)\n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tout:(d)=> {\n\t\t\t\t\tif(!this.ccam) return true ;\n\t\t\t\t\tdragging = false ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"out\",{x:d.x*this.pixRatio,y:d.y*this.pixRatio,dx:d.dx*this.pixRatio,dy:d.dy*this.pixRatio}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"out\",d) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\twheel:(d)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"wheel\",d) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"wheel\",d) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tgesture:(z,r)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause) return true;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"gesture\",{z:z,r:r}) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"gesture\",{z:z,r:r}) \n\t\t\t\t\treturn false ;\n\t\t\t\t},\n\t\t\t\tgyro:(ev)=> {\n\t\t\t\t\tif(!this.ccam || Param.pause || POXPDevice.VRReady ) return true;\n\t\t\t\t\tif(dragging) return true ;\n\t\t\t\t\tlet ret = true ;\n\t\t\t\t\tret = this.callEvent(\"gyro\",ev) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"gyro\",ev) \n\t\t\t\t\treturn false ;\n\t\t\t\t}\n\t\t\t})\n\t\t\tWBind.addev(this.keyElelment,\"keydown\", (ev)=>{\n\t\t//\t\tconsole.log(\"key:\"+ev.key);\n\t\t\t\tif( Param.pause) return true ;\n\t\t\t\tif(this.pox.event) {\n\t\t\t\t\tif(!this.callEvent(\"keydown\",ev)) return true ;\n\t\t\t\t}\n\t\t\t\tif(this.ccam) this.ccam.event(\"keydown\",ev) \n\t\t\t\treturn false ;\n\t\t\t})\n\t\t\tWBind.addev(this.keyElelment,\"keyup\", (ev)=>{\n\t\t//\t\tconsole.log(\"key up:\"+ev.key);\n\t\t\t\tif(Param.pause) return true ;\n\t\t\t\tif(this.pox.event) {\n\t\t\t\t\tif(!this.callEvent(\"keyup\",ev)) return true ;\n\t\t\t\t}\n\t\t\t\tif(this.ccam) this.ccam.event(\"keyup\",ev)\n\t\t\t\treturn false ;\n\t\t\t})\t\t\n\t\t\tdocument.querySelectorAll(\"#bc button\").forEach((o)=>{\n\t\t\t\to.addEventListener(\"mousedown\", (ev)=>{\n\t\t\t\t\tthis.callEvent(\"btndown\",ev.target.id) ;\n\t\t\t\t\tthis.ccam.event(\"keydown\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t\to.addEventListener(\"touchstart\", (ev)=>{\n\t\t\t\t\tthis.callEvent(\"touchstart\",ev.target.id) ;\n\t\t\t\t\tthis.ccam.event(\"keydown\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t\to.addEventListener(\"mouseup\", (ev)=>{\n\t\t\t\t\tthis.callEvent(\"btnup\",ev.target.id) ;\n\t\t\t\t\tthis.ccam.event(\"keyup\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tthis.keyElelment.focus() ;\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t\to.addEventListener(\"touchend\", (ev)=>{\n\t\t\t\t\tret = true; \n\t\t\t\t\tret = this.callEvent(\"touchend\",ev.target.id) ;\n\t\t\t\t\tif(ret) this.ccam.event(\"keyup\",{key:ev.target.getAttribute(\"data-key\")})\n\t\t\t\t\tev.preventDefault()\n\t\t\t\t})\n\t\t\t})\n\n\t\t}\n\t\tresize() {\n\t\t//\tconsole.log(\"wresize:\"+document.body.offsetWidth+\" x \"+document.body.offsetHeight);\n\t\t\tif(this.can.offsetWidth < 300 || \n\t\t\t\t(POXPDevice.isPresenting)) return \n\t\t\tthis.can.width= this.can.offsetWidth*this.pixRatio*window.devicePixelRatio  ;\n\t\t\tthis.can.height = this.can.offsetHeight*this.pixRatio*window.devicePixelRatio  ;\n\t\t\tconsole.log(\"canvas:\"+this.can.width+\" x \"+this.can.height);\t\t\n\t\t}\n\t\tasync load(d) {\n\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\tif(typeof d == \"string\") {\n\t\t\t\t\tconst req = new XMLHttpRequest();\n\t\t\t\t\treq.open(\"get\",d,true) ;\n\t\t\t\t\treq.responseType = \"json\" ;\n\t\t\t\t\treq.onload = () => {\n\t\t\t\t\t\tif(req.status==200) {\n\t\t//\t\t\t\t\tconsole.log(req.response) ;\n\t\t\t\t\t\t\tresolve(req.response) ;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(\"Ajax error:\"+req.statusText) ;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treq.onerror = ()=> {\n\t\t\t\t\t\treject(\"Ajax error:\"+req.statusText)\n\t\t\t\t\t}\n\t\t\t\t\treq.send() ;\n\t\t\t\t} else resolve(d) ;\n\t\t\t})\n\t\t}\n\n\t\tloadImage(path) {\n\t\t\tif(path.match(/^https?:/)) {\n\t\t\t\treturn this.wwg.loadImageAjax(path)\n\t\t\t}else {\n\t\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\t\tconst img = new Image() ;\n\t\t\t\t\timg.onload = ()=> {\n\t\t\t\t\t\tresolve( img ) ;\n\t\t\t\t\t}\n\t\t\t\t\timg.onerror = ()=> {\n\t\t\t\t\t\treject(\"cannot load image\") ;\n\t\t\t\t\t}\n\t\t\t\t\timg.src = path ;\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\t\t\n\t\tasync set(d,param={},uidom) { \n\t\t\tconst VS = d.vs ;\n\t\t\tconst FS = d.fs ;\n\t\t\tthis.pox.src = d \n\t\t\tthis.pox.param = param \n\t\t\tconst POX = this.pox\n\n\t\t\tPOX.loadImage = this.loadImage \n\t\t\tPOX.loadAjax = this.wwg.loadAjax\n\t\t\tPOX.addEvent = (e,f) => this.addEvent(e,f)\n\t\t\tPOX.exitVR = this.exitVR \n\t\t\t\n\t\t\tPOX.V3add = function() {\n\t\t\t\tlet x=0,y=0,z=0 ;\n\t\t\t\tfor(let i=0;i<arguments.length;i++) {\n\t\t\t\t\tx += arguments[i][0] ;y += arguments[i][1] ;z += arguments[i][2] ;\n\t\t\t\t}\n\t\t\t\treturn [x,y,z] ;\n\t\t\t}\n\t\t\tPOX.V3len = function(v) {\n\t\t\t\treturn Math.hypot(v[0],v[1],v[2]) ;\n\t\t\t}\n\t\t\tPOX.V3norm = function(v,s) {\n\t\t\t\tconst l = V3len(v) ;\n\t\t\t\tif(s===undefined) s = 1 ;\n\t\t\t\treturn (l==0)?[0,0,0]:[v[0]*s/l,v[1]*s/l,v[2]*s/l] ;\n\t\t\t}\n\t\t\tPOX.V3mult = function(v,s) {\n\t\t\t\treturn [v[0]*s,v[1]*s,v[2]*s] ;\n\t\t\t}\n\t\t\tPOX.V3dot = function(v1,v2) {\n\t\t\t\treturn v1[0]*v2[0]+v1[1]*v2[1]+v1[2]*v2[2] ;\n\t\t\t}\n\t\t\tPOX.Vdistance = function(v1,v2) {\n\t\t\t\t\treturn Math.hypot(...v1.map((v,i)=>v-v2[i]))\n\t\t\t}\n\t\t\tPOX.setScene = async (scene)=> {\n\t\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\t\tthis.setScene(scene).then( () => {\n\t\t\t\t\t\tresolve() ;\n\t\t\t\t\t}).catch((err)=>\t {\n\t\t\t\t\t\tconsole.log(\"render err\"+err.stack)\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t\tPOX.log = (msg)=> {\n\t\t\t\tif(this.errCb) this.errCb(msg) ;\n\t\t\t}\n\t\t\tPOX.addModel = (model)=>{ if(this.render) return this.render.addModel(model) }\n\t\t\tPOX.removeModel = (model)=>{ if(this.render) return this.render.removeModel(model) }\n\t\t\tPOX.getModelData = (model)=>{ if(this.render) return this.render.getModelData(model) }\n\n\n\t\t//\tthis.parseJS(d.m).then((m)=> {\n\t\t\tif(typeof d.m  == \"string\") {\n\t\t\t\tconst m = await this.parseJS(d.m) ;\n\t\t\t\ttry {\n\t\t\t\t\tPOX.eval = new Function(\"POX\",'\"use strict\";'+m)\n\t\t\t\t}catch(err) {\n\t\t\t\t\tconsole.log(err)\n\t\t\t\t\tthis.emsg = (\"parse error \"+err.stack);\n\t\t//\t\t\tthrow new Error('reject!!')\n\t\t\t\t\treturn(null);\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tPOX.eval(POX)\n\n\t\t\t\t}catch(err) {\n\t\t//\t\t\tconsole.log(err.stack)\n\t\t\t\t\tthis.emsg = (\"eval error \"+err.stack);\n\t\t//\t\t\tthrow new Error('reject!!2')\n\t\t\t\t\treturn(null);\n\t\t\t\t}\n\t\t\t} else if(d.m.constructor === Function) {\n\t\t\t\ttry {\n\t\t\t\t\td.m(POX)\n\t\t\t\t}catch(err) {\n\t\t//\t\t\tconsole.log(err.stack)\n\t\t\t\t\tthis.emsg = (\"eval error \"+err.stack);\n\t\t//\t\t\tthrow new Error('reject!!2')\n\t\t\t\t\treturn(null);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(POX.setting.needWGL2 && this.wwg.version!=2) {\n\t\t\t\tthis.emsg = \"needs WebGL 2.0\"\n\t\t\t\treturn(null)\n\t\t\t}\n\n\t\t\tif(uidom) this.setParam(uidom)\n\t\t\tif(POX.init) {\n\t\t\t\ttry {\n\t\t\t\t\tawait POX.init()\n\t\t\t\t}catch(err) {\n\t\t//\t\t\t\tconsole.log(err)\n\t\t\t\t\tthis.emsg = (\"init error \"+err.stack);\n\t\t//\t\t\t\tthrow new Error('reject!!2')\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn(POX) ;\n\t\t}\n\t\tparseJS(src) {\n\n\t\t\treturn new Promise((resolve,reject) => {\n\t\t\t\tconst s = src.split(\"\\n\") ;\n\t\t\t\tconst inc = [] ;\n\t\t\t\tfor(let v of s) {\n\t\t\t\t\tif(v.match(/^\\/\\/\\@INCLUDE\\(\"(.+)\"\\)/)) {\n\t\t\t\t\t\tinc.push( this.wwg.loadAjax(RegExp.$1)) ;\n\t\t\t\t\t} \n\t\t\t\t}\n\t\t\t\tPromise.all(inc).then((res)=>{\n\t\t\t\t\tlet ret = [] ;\n\t\t\t\t\tlet c = 0 ;\n\t\t\t\t\tfor(let v of s) {\n\t\t\t\t\t\tif(v.match(/^\\/\\/\\@INCLUDE\\(\"(.+)\"\\)/)) {\n\t\t\t\t\t\t\tret = ret.concat(res[c++].split(\"\\n\"))\n\t\t\t\t\t\t} else ret.push(v) ;\n\t\t\t\t\t}\n\t\t\t\t\tresolve( ret.join(\"\\n\"))  ;\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\t\tstop() {\n\t\t\twindow.cancelAnimationFrame(this.loop) ; \n\t\t\tif(this.pox.unload) this.pox.unload() ;\n\t\t}\n\t\tcls() {\n\t\t\tif(this.render) this.render.clear() ;\n\t\t}\n\t\tsetError(err) {\n\t\t\tthis.errCb = err ;\n\t\t}\n\t\tcallEvent(kind,ev,opt) {\n\t\t\tif(typeof ev == \"object\") ev.rtime = this.rtime\n\t\t\tlet ret = true \n\t\t\tif(this.pox.event) {\n\t\t\t\ttry {\n\t\t\t\t\tret = this.pox.event(kind,ev,opt)\n\t\t\t\t} catch(err) {\n\t\t\t\t\tthis.errCb(err.stack)\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(kind==\"vrchange\") {\n\t\t\t\tthis.ccam.vrchange(ev)\n\t\t\t\tfor(let i=0;i<this.eventListener.vrchange.length;i++) {\t//attached event\n\t\t\t\t\tconst f = this.eventListener.vrchange[i]\n\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\tf.cb({vrmode:ev})\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(kind==\"gpad\") {\n\t\t\t\tif(ev.dbtn[5]==-1) POXPDevice.closeVR()\n\t\t\t\tfor(let i=0;i<this.eventListener.gpad.length;i++) {\t//attached event\n\t\t\t\t\tconst f = this.eventListener.gpad[i]\n\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\tlet p = {gpad:ev}\n\t\t\t\t\t\tif(ev.hand==\"left\") p.leftPad = ev\n\t\t\t\t\t\tif(ev.hand==\"right\") p.rightPad = ev\n\t\t\t\t\t\tif(this.pox.setting.primaryPad == ev.hand) p.primaryPad = ev\n\t\t\t\t\t\telse p.secondaryPad = ev \n\t\t\t\t\t\tf.cb(p)\n\t\t\t\t\t}\n\t\t\t\t}\t\t\n\t\t\t}\n\t\t\treturn ret \n\t\t}\n\t\tsetParam(dom) {\n\t\t\tconst param = this.pox.setting.param ;\n\t\t\tif(param===undefined) return ;\n\t\t\tthis.uparam = WBind.create()\n\t\t\tconst input = [] ;\n\t\t\tfor(let i in param) {\n\t\t\t\tconst p = param[i] ;\n\t\t\t\tconst name = (p.name)?p.name:i ;\n\t\t\t\tif(!p.type) p.type = \"range\" \n\t\t\t\tif(!p.step) p.step = 100 ;\n\t\t\t\tlet tag = `<div class=t>${name}</div> <input type=${p.type} id=\"_p_${i}\" min=0 max=${p.step} style=\"${(p.type==\"disp\")?\"display:none\":\"\"}\"  /><span id=${\"_p_d_\"+i}></span><br/>`\n\t\t\t\tinput.push(\n\t\t\t\t\ttag\n\t\t\t\t)\n\t\t\t}\n\t\t\tdom.innerHTML = input.join(\"\") \n\t\t\tfunction _tohex(v) {\n\t\t\t\tlet s = (v*255).toString(16) ;\n\t\t\t\tif(s.length==1) s = \"0\"+s ;\n\t\t\t\treturn s ;\n\t\t\t}\n\t\t\tfunction _setdisp(i,v) {\n\t\t\t\tif(param[i].type==\"color\" && v ) {\n\t\t\t\t\tdocument.getElementById('_p_d_'+i).innerHTML = v.map((v)=>v.toString().substr(0,5)) ;\n\t\t\t\t} else if(param[i].type==\"range\")  document.getElementById('_p_d_'+i).innerHTML = v.toString().substr(0,5) ;\t\n\t\t\t\telse document.getElementById('_p_d_'+i).innerHTML = v\n\t\t\t}\n\t\t\tfor(let i in param) {\n\t\t\t\tthis.uparam.bindInput(i,\"#_p_\"+i)\n\t\t\t\tthis.uparam.setFunc(i,{\n\t\t\t\t\tset:(v)=> {\n\t\t\t\t\t\tlet ret = v ;\n\t\t\t\t\t\tif(param[i].type==\"color\") {\n\t\t\t\t\t\t\tret = \"#\"+_tohex(v[0])+_tohex(v[1])+_tohex(v[2])\n\t\t\t\t\t\t} else if(param[i].type==\"range\") ret = (v - param[i].min)*(param[i].step)/(param[i].max - param[i].min)\n\t\t\t\t\t\telse ret = v ;\n\t\t//\t\t\t\tconsole.log(ret)\n\t\t\t\t\t\t_setdisp(i,v)\n\t\t\t\t\t\treturn ret \t\n\t\t\t\t\t},\n\t\t\t\t\tget:(v)=> {\n\t\t\t\t\t\tlet ret ;\n\t\t\t\t\t\tif(param[i].type==\"color\" ) {\n\t\t\t\t\t\t\tif(typeof v ==\"string\" && v.match(/#[0-9A-F]+/i)) {\n\t\t\t\t\t\t\t\tret =[parseInt(v.substr(1,2),16)/255,parseInt(v.substr(3,2),16)/255,parseInt(v.substr(5,2),16)/255] ;\n\t\t\t\t\t\t\t} else ret = v ;\n\t\t\t\t\t\t} else if(param[i].type==\"range\" ) ret = v*(param[i].max-param[i].min)/(param[i].step)+param[i].min\t\n\t\t\t\t\t\telse ret = v ;\t\t\n\t\t\t\t\t\treturn ret ;\n\t\t\t\t\t},\n\t\t\t\t\tinput:(v)=>{\n\t\t\t\t\t\t_setdisp(i,this.uparam[i])\n\t\t//\t\t\t\tthis.keyElelment.focus()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.uparam[i] = param[i].value ;\n\t\t\t}\n\t\t\tthis.pox.param = this.uparam ;\n\t\t}\n\n\n\t\tsetScene(sc) {\n\t\t//\tconsole.log(sc) ;\n\n\t\t\tconst wwg = this.wwg ;\n\t\t\tconst pox = this.pox ;\n\t\t\tconst can = this.can ;\n\n\t\t\tconst pixRatio = this.pixRatio\n\t\t\tconst Param = this.param ;\n\t\t\tconst sset = pox.setting || {} ;\n\t\t\tif(!sset.scale) sset.scale = 1.0 ;\n\t\t\tif(!sset.primaryPad) sset.primaryPad = \"right\";\n\t\t\t\n\t\t\tsc.vshader = {text:pox.src.vs} ;\n\t\t\tsc.fshader = {text:pox.src.fs} ;\n\t\t\tpox.scene = sc ;\n\n\t\t\t//create render unit\n\t\t\tconst r = wwg.createRender() ;\n\t\t\tthis.render = r ;\n\t\t\tpox.render = r ;\n\n\t\t\tlet ccam = this.ccam\n\t\t\t\n\t\t\tthis.isVR = false \n\t\t\tconst self = this \n\t\t\tconst bm = new CanvasMatrix4()\n\t\t\tconst mMtx = []\n\t\t\tconst vMtx = []\n\t\t\tconst mvMtx = []\n\t\t\tconst vpMtx = []\n\t\t\tconst iMtx = []\n\t\t\tconst miMtx = []\t\n\t\t\treturn new Promise((resolve,reject) => {\n\t\t\tr.setRender(sc).then(()=> {\t\n\t\t\t\tif(this.errCb) this.errCb(\"scene set ok\") ;\n\t\t\t\tif(this.renderStart) this.renderStart() ;\n\n\t\t\t\tif(pox.setting && pox.setting.pixRatio) { \n\t\t\t\t\tthis.pixRatio = pox.setting.pixRatio ;\n\t\t\t\t} else {\n\t\t\t\t\tthis.pixRatio = 1 ;\n\t\t\t\t}\n\t\t\t\tthis.resize();\n\t\t\t\t\n\t\t\t\tif(pox.setting.cam) this.cam1.setCam(pox.setting.cam)\n\t\t//\t\tif(ccam.cam.camMode==\"walk\") this.keyElelment.focus() ;\n\t\t\t\tthis.keyElelment.value = \"\" ;\n\t\t\t\tthis.clearEvent()\n\t\t\t\t\n\t\t\t\tresolve()\n\t\t\t\t//draw loop\n\t\t\t\tlet st = new Date().getTime() ;\n\t\t\t\tthis.ctime = st \n\t\t\t\tthis.ltime = st \n\t\t\t\tlet tt = 0 ;\n\t\t\t\tlet rt = 0 ;\n\t\t\t\tlet ft = st ;\n\t\t\t\tlet fc = 0 ;\n\t\t\t\tlet gpad \n\t\t\t\tconst loopf = (timestamp,frame) => {\n\t\t//\t\t\tconsole.log(\"************loop\")\n\t\t\t\t\tPOXPDevice.animationFrame(this,loopf,frame)\n\n\t\t\t\t\tconst ct = new Date().getTime() ;\n\t\t\t\t\tthis.ctime = ct \n\t\t\t\t\tif(Param.pause) {\n\t\t\t\t\t\tParam.fps=0;\n\t\t\t\t\t\ttt = rt ;\n\t\t\t\t\t\tst = ct ;\n\t\t\t\t\t\treturn ;\n\t\t\t\t\t}\n\t\t\t\t\trt = tt + ct-st ;\n\t\t\t\t\tfc++ ;\n\t\t\t\t\tif(ct-ft>=500) {\n\t\t//\t\t\t\tif(this.isVR) console.log(fc)\n\t\t\t\t\t\tParam.fps = Math.floor(fc*1000/(ct-ft)+0.5) ;\n\t\t\t\t\t\tfc = 0 ;\n\t\t\t\t\t\tft = ct ; \n\t\t\t\t\t}\n\t\t\t\t\tthis.ccam = (Param.camselect)?this.cam0:this.cam1\n\t\t\t\t\tccam = this.ccam \n\t\t\t\t\tpox.cam = ccam.cam ;\n\n\t\t\t\t\tif(Param.autorot) ccam.setCam({camRY:(rt/100)%360}) ;\n\t\t\t\t\tlet rp=null,lp=null,pp=null,sp=null\n\t\t\t\t\tif(pox.gPad) {\n\t\t\t\t\t\tlet p1 = pox.gPad.get()\n\t\t\t\t\t\tlet p2 = pox.gPad2.get() \n\t\t\t\t\t\tif(this.isVR) {\n\t\t\t\t\t\t\tif(!p1.emu && p1.hand == \"right\") rp = p1 ;\n\t\t\t\t\t\t\tif(!p1.emu && p1.hand == \"left\") lp = p1 ;\n\t\t\t\t\t\t\tif(!p2.emu && p2.hand == \"right\") rp = p2 ;\n\t\t\t\t\t\t\tif(!p2.emu && p2.hand == \"left\") lp = p2 \n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(p1.hand == \"right\" ) rp = p1\n\t\t\t\t\t\t\tif(p2.hand == \"right\" ) rp = p2\t\t\t\t\n\t\t\t\t\t\t\tif(p1.hand == \"left\" ) lp = p1\n\t\t\t\t\t\t\tif(p2.hand == \"left\" ) lp = p2\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(sset.primaryPad==\"left\") pp = lp,sp = rp\n\t\t\t\t\t\telse pp=rp,sp=lp\n\t\t\t\t\t\tif(!pp || !pp.conn) pp = sp, sp = null \n\t\t//\t\t\t\tconsole.log(pp)\n\t\t//\t\t\t\tconsole.log(sp)\n\t\t\t\t\t\tif(ccam.cam.gPad) ccam.setPad(pp,sp)\n\t\t\t\t\t}\n\t\t\t\t\tccam.update()\t// camera update\n\t\t\t\t\tlet camm = ccam.getMtx(sset.scale,(Param.isStereo || self.isVR)?1:0) ;\n\t\t\t\t\t\n\t\t\t\t\tfor(let i=0;i<this.eventListener.frame.length;i++) {\t//attached event\n\t\t\t\t\t\tconst f = this.eventListener.frame[i]\n\t\t\t\t\t\tif(f.active) {\n\t\t\t\t\t\t\tf.cb({render:r,pox:pox,ccam:ccam,cam:ccam.cam,rtime:rt,\n\t\t\t\t\t\t\t\trightPad:rp,leftPad:lp,primaryPad:pp,secondaryPad:sp})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet upd = {}\n\t\t\t\t\tif(pox.update)  upd = pox.update(r,ccam.cam,rt,-1)\n\t\t\t\t\tParam.updateTimer() ;\n\t\t\t\t\tupdate(r,pox,camm,rt,upd) ; // scene update \n\t\t\t\t\tPOXPDevice.submitFrame(this)\n\t\t\t\t\tthis.ltime = ct \n\t\t\t\t\tthis.rtime = rt \n\t\t\t\t}\n\t\t\t\tloopf() ;\t\t\n\t\t\t}).catch((err)=>{\n\t\t\t\tconsole.log(err) ;\n\t\t\t\tif(this.errCb) this.errCb(err.stack?err.stack:err) ;\n\t\t\t\treject(err) \n\t\t\t})\n\t\t\t}) // promise\n\t\t\t\n\t\t\tfunction getParentMtx(render,parent) {\n\t\t\t\tlet p = render.getModelData(parent) \n\t\t\t\tif(!p) return new Mat4() \n\t\t\t\tlet mm = new Mat4(p.bm)\n\t\t\t\tif(!mm) mm = new Mat4() \n\t\t\t\tif(p.mm) mm.multRight(p.mm)\n\t\t\t\tif(p.parent!==undefined) {\n\t\t\t\t\tmm.multRight( getParentMtx(render,p.parent)) \n\t\t\t\t} \n\t\t\t\treturn mm \n\t\t\t}\n\t\t\t// calc model matrix\n\t\t\tfunction modelMtx2(render,camm) {\n\n\t\t\t\t// calc each mvp matrix and invert matrix\n\t\t\t\tconst mod = [[],[]] ;\t\n\t\t\t\tconst models = render.data.model \t\n\t\t\t\tfor(let i=0;i<models.length;i++) {\n\t\t\t\t\tlet d = models[i] ;\n\t\t\t\t\tif(!d) continue \n\t\t\t\t\tbm.load(d.bm)\n\t\t\t\t\tif(d.mm) bm.multRight(d.mm) ;\n\t\t\t\t\tif(d.parent!==undefined) {\n\t\t\t\t\t\tbm.multRight( getParentMtx(render,d.parent ))\n\t\t\t\t\t}\n\t\t\t\t\tif(render.data.group) {\n\t\t\t\t\t\tlet g = render.data.group ;\n\t\t\t\t\t\tfor(let gi = 0 ;gi < g.length;gi++) {\n\t\t\t\t\t\t\tlet gg = g[gi] ;\n\t\t\t\t\t\t\tif(!gg.bm) continue ;\n\t\t\t\t\t\t\tfor(let ggi=0;ggi<gg.model.length;ggi++) {\n\t\t\t\t\t\t\t\tif(render.getModelIdx(gg.model[ggi])==i) bm.multRight(gg.bm) ;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(!mMtx[i]) mMtx[i] = new CanvasMatrix4()\n\t\t\t\t\tif(!iMtx[i]) iMtx[i] = new CanvasMatrix4()\n\t\t\t\t\tif(!miMtx[i]) miMtx[i] = new CanvasMatrix4()\n\t\t\t\t\tif(!mvMtx[i]) mvMtx[i] = [new CanvasMatrix4(),new CanvasMatrix4()]\t\t\t\n\t\t\t\t\tif(!vpMtx[i]) vpMtx[i] = [new CanvasMatrix4(),new CanvasMatrix4()]\t\t\t\n\n\t\t\t\t\tconst uni0 = {\n\t\t\t\t\t\tvs_uni:{\n\t\t\t\t\t\t\tmodelMatrix:mMtx[i].load(bm).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tvpMatrix:vpMtx[i][0].load((d.camFix)?camm[0].camP:camm[0].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tmvpMatrix:mvMtx[i][0].load(bm).multRight( (d.camFix)?camm[0].camP:camm[0].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tinvMatrix:iMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().transpose().getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tminvMatrix:miMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().getAsWebGLFloatArray()}\n\t\t\t\t\t}\n\t\t\t\t\tconst uni1 = {\n\t\t\t\t\t\tvs_uni:{\n\t\t\t\t\t\t\tmodelMatrix:mMtx[i].load(bm).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tvpMatrix:vpMtx[i][1].load((d.camFix)?camm[1].camP:camm[1].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tmvpMatrix:mvMtx[i][1].load(bm).multRight( (d.camFix)?camm[1].camP:camm[1].camVP).getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tinvMatrix:iMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().transpose().getAsWebGLFloatArray(),\n\t\t\t\t\t\t\tminvMatrix:miMtx[i].load(bm).\n\t\t\t\t\t\t\t\tinvert().getAsWebGLFloatArray()}\n\t\t\t\t\t}\n\t\t\t\t\tuni0.fs_uni = uni0.vs_uni\n\t\t\t\t\tuni1.fs_uni = uni1.vs_uni\n\t\t\t\t\tuni0.fs_uni.vpMatrix_l = uni0.fs_uni.vpMatrix \n\t\t\t\t\tuni0.fs_uni.vpMatrix_r = uni1.fs_uni.vpMatrix \n\t\t\t\t\tuni1.fs_uni.vpMatrix_l = uni0.fs_uni.vpMatrix \n\t\t\t\t\tuni1.fs_uni.vpMatrix_r = uni1.fs_uni.vpMatrix \t\t\t\n\t\t\t\t\tmod[0][i] = uni0 \n\t\t\t\t\tmod[1][i] = uni1 \n\t\t\t\t}\n\t\t\t\tlet up = [{model:mod[0],fs_uni:{},vs_uni:{}},\n\t\t\t\t\t{model:mod[1],fs_uni:{},vs_uni:{}}]\n\n\t\t\t\tup[0].fs_uni.stereo = 1 ;\n\t\t\t\tup[0].fs_uni.resolution = [can.width,can.height]\n\t\t\t\tup[0].fs_uni.camMatirx = camm[0].camV.getAsWebGLFloatArray()\n\t\t\t\tup[0].fs_uni.eyevec = [camm[0].camX,camm[0].camY,camm[0].camZ]\n\t\t\t\tup[0].vs_uni.stereo = 1 ;\n\t\t\t\tup[0].vs_uni.camMatirx = up[0].fs_uni.camMatirx\n\t\t\t\tup[0].vs_uni.eyevec = up[0].fs_uni.eyevec \n\t\t\t\n\t\t\t\tup[1].fs_uni.stereo = 2  ;\n\t\t\t\tup[1].fs_uni.resolution = up[0].fs_uni.resolution\n\t\t\t\tup[1].fs_uni.camMatirx = camm[1].camV.getAsWebGLFloatArray()\n\t\t\t\tup[1].fs_uni.eyevec = [camm[1].camX,camm[1].camY,camm[1].camZ]\n\t\t\t\tup[1].vs_uni.stereo = 2  ;\t\n\t\t\t\tup[1].vs_uni.camMatirx = up[1].fs_uni.camMatirx\n\t\t\t\tup[1].vs_uni.eyevec = up[1].fs_uni.eyevec \t\n\t\t\t\treturn up ;\t\t\n\t\t\t}\n\t\t\t// update scene\n\n\t\t\tfunction update(render,pox,camm,time,update) {\n\t\t\t\t// draw call \n\n\t\t\t\trender.data.model.sort((a,b)=>{\n\t\t\t\t\tif(a===null) return -1\n\t\t\t\t\tif(b===null) return 1\n\t\t\t\t\tlet al = a.layer, bl = b.layer \n\t\t\t\t\tif(al===undefined) al = 0 \n\t\t\t\t\tif(bl===undefined) bl = 0 \n\t\t\t\t\treturn al- bl  \n\t\t\t\t}) \n\n\t\t\t\tif(Param.isStereo || self.isVR) {\n\t\t\t\t\tlet vp = POXPDevice.getViewport(can)\n\t\t\t\t\tif(POXPDevice.WebXR && POXPDevice.isPresenting) {\n\t\t//\t\t\t\tconsole.log(\"fbs\")\n\t\t\t\t\t\trender.gl.bindFramebuffer(render.gl.FRAMEBUFFER, \n\t\t\t\t\t\t\tPOXPDevice.webGLLayer.framebuffer)\n\t\t\t\t\t}\n\t\t\t\t\tlet mtx2 = modelMtx2(render,camm) ;\n\t\t\t\t\tif(update.vs_uni===undefined) update.vs_uni = {} ;\n\t\t\t\t\tif(update.fs_uni===undefined) update.fs_uni = {} ;\n\t\t\t\t\tupdate.fs_uni.time = time/1000 ;\n\t\t\t\t\tupdate.vs_uni.time = time/1000 ;\t\t\t\n\t\t\t\t\trender.gl.viewport(vp.leftViewport.x,vp.leftViewport.y, vp.leftViewport.width,vp.leftViewport.height) ;\n\t\t\t\t\trender.draw([update,mtx2[0]],false) ;\n\t\t\t\t\trender.gl.viewport(vp.rightViewport.x,vp.rightViewport.y, vp.rightViewport.width,vp.rightViewport.height) ;\n\t\t\t\t\trender.draw([update,mtx2[1]],true) ;\n\t\t\t\t\tif(POXPDevice.WebXR && POXPDevice.isPresenting) {\n\t\t//\t\t\t\tconsole.log(\"fbe\")\n\t\t\t\t\t\trender.gl.bindFramebuffer(render.gl.FRAMEBUFFER,null)\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet mtx2 = modelMtx2(render,camm) ;\n\t\t\t\t\tif(update.vs_uni===undefined) update.vs_uni = {} ;\n\t\t\t\t\tif(update.fs_uni===undefined) update.fs_uni = {} ;\n\t\t\t\t\tmtx2[0].vs_uni.stereo = 0 ;\n\t\t\t\t\tupdate.fs_uni.time = time/1000 ;\n\t\t\t\t\tupdate.vs_uni.time = time/1000 ;\t\n\t\t\t\t\trender.gl.viewport(0,0,can.width,can.height) ;\n\t\t\t\t\trender.draw([update,mtx2[0]],false) ;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t} //class Player\n\n\t// poxplayercamera object\n\tPlayer.prototype.createCamera = function(cam) {\n\t\treturn new this.Camera(this,cam) ;\n\t}\n\tPlayer.prototype.Camera = PoxCamera;\n\n\n\treturn pox.Player = Player;\n});\n\n"]}